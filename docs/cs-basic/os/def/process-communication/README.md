---
# 这是页面的图标
icon: page

# 这是文章的标题
title: 进程间通信

# 设置作者
author: lllllan

# 设置写作时间
# time: 2020-01-20

# 一个页面只能有一个分类
category: 

# 一个页面可以有多个标签
tag:

# 此页面会在文章列表置顶
# sticky: true

# 此页面会出现在首页的文章板块中
star: true

# 你可以自定义页脚
# footer: 

---



::: warning 转载声明

- [进程间通信IPC (InterProcess Communication)](https://www.jianshu.com/p/c1015f5ffa74)
- [进程间的五种通信方式介绍 - moon-zhu](https://www.cnblogs.com/zgq0/p/8780893.html)

:::



::: info 共享内存是最快的一种 IPC，因为进程是直接对内存进行存取

:::



## 一、管道/匿名管道

**用于具有亲缘关系的父子进程间或者兄弟进程之间的通信。**

> 管道的实质是一个内核缓冲区，进程以先进先出的方式从缓冲区存取数据，管道一端的进程顺序的将数据写入缓冲区，另一端的进程则顺序的读出数据。
> 该缓冲区可以看做是一个循环队列，读和写的位置都是自动增长的，不能随意改变，一个数据只能被读一次，读出来以后在缓冲区就不复存在了。
> 当缓冲区读空或者写满时，有一定的规则控制相应的读进程或者写进程进入等待队列，当空的缓冲区有新数据写入或者满的缓冲区有数据读出来时，就唤醒等待队列中的进程继续读写。

特点和局限：

- 只支持单向数据流
- 只能用于具有亲缘关系的进程之间
- 没有名字
- 管道的缓冲区是有限的（管道只 ==存在于内存中== ，在管道创建时，为缓冲区分配一个页面大小）
- 管道所传送的是无格式字节流，这就要求管道的读出方和写入方必须事先约定好数据的格式，比如多少字节算作一个消息（或命令、或记录）等等；



源码看 [linux进程间通信之管道通信底层实现源码分析_胡说嵌入式](https://blog.csdn.net/KUNPLAYBOY/article/details/123262361)

## 二、有名管道 FIFO

==有名管道以磁盘文件的方式存在，可以实现本机任意两个进程通信。==

> 有名管道不同于匿名管道之处在于它提供了一个路径名与之关联，**以有名管道的文件形式存在于文件系统中**，这样，**即使与有名管道的创建进程不存在亲缘关系的进程，只要可以访问该路径，就能够彼此通过有名管道相互通信**，因此，通过有名管道不相关的进程也能交换数据。值的注意的是，有名管道严格遵循**先进先出(first in first out)**,对匿名管道及有名管道的读总是从开始处返回数据，对它们的写则把数据添加到末尾。它们不支持诸如lseek()等文件定位操作。有名管道的名字存在于文件系统中，内容存放在内存中。

管道总结：

- 管道是特殊类型的文件，在满足**先入先出**的原则条件下可以进行读写，但不能进行定位读写。
- 管道都是单向的。其中匿名管道只能在有亲缘关系的进程间通信；有名管道以磁盘文件的方式存在，可以实现本机任意两个进程通信。
- **匿名管道阻塞问题：** 匿名管道无需显示打开，创建时直接返回文件描述符，在读写时需要确定对方的存在，否则将退出。如果当前进程向无名管道的一端写数据，必须确定另一端有某一进程。如果写入无名管道的数据超过其最大值，写操作将阻塞，如果管道中没有数据，读操作将阻塞，如果管道发现另一端断开，将自动退出。
- **有名管道阻塞问题：** 有名管道在打开时需要确实对方的存在，否则将阻塞。即以读方式打开某管道，在此之前必须一个进程以写方式打开管道，否则阻塞。此外，可以以读写（O_RDWR）模式打开有名管道，即当前进程读，当前进程写，不会阻塞。



## 三、信号

**信号是一种比较复杂的通信方式，用于通知接收进程某个事件已经发生**

- 信号是Linux系统中用于进程间互相通信或者操作的一种机制，信号可以在任何时候发给某一进程，而无需知道该进程的状态。
- 如果该进程当前并未处于执行状态，则该信号就有内核保存起来，知道该进程回复执行并传递给它为止。
- 如果一个信号被进程设置为阻塞，则该信号的传递被延迟，直到其阻塞被取消是才被传递给进程。

![img](README.assets/webp-16430301339574.png)



::: info Linux系统中常用信号
（1）**SIGHUP**：用户从终端注销，所有已启动进程都将收到该进程。系统缺省状态下对该信号的处理是终止进程。

（2）**SIGINT**：程序终止信号。程序运行过程中，按`Ctrl+C`键将产生该信号。

（3）**SIGQUIT**：程序退出信号。程序运行过程中，按`Ctrl+\\`键将产生该信号。

（4）**SIGBUS和SIGSEGV**：进程访问非法地址。

（5）**SIGFPE**：运算中出现致命错误，如除零操作、数据溢出等。

（6）**SIGKILL**：用户终止进程执行信号。shell下执行`kill -9`发送该信号。

（7）**SIGTERM**：结束进程信号。shell下执行`kill 进程pid`发送该信号。

（8）**SIGALRM**：定时器信号。

（9）**SIGCLD**：子进程退出信号。如果其父进程没有忽略该信号也没有处理该信号，则子进程退出后将形成僵尸进程。

:::

## 四、消息队列

**消息队列是消息的链表，具有特定的格式，存放在 ==内存== 中并由消息队列标识符标识。**

特点总结：

- 消息队列是消息的链表，具有特定的格式，存放在内存中并由消息队列标识符标识
- 消息队列允许一个或多个进程向它写入与读取消息
- 管道和消息队列的通信数据都是先进先出的原则
- 消息队列可以实现消息的随机查询，消息不一定要以先进先出的次序读取，也可以按消息的类型读取比FIFO更有优势
- 消息队列克服了信号承载信息量少，管道只能承载无格式字节流以及缓冲区大小受限等缺
- 目前主要有两种类型的消息队列：POSIX 消息队列以及 System V 消息队列，系统 V 消息队列目前被大量使用。系统V消息队列是随内核持续的，只有在内核重起或者人工删除时，该消息队列才会被删除。



## 五、共享内存和信号量

在通信的进程之间存在一块可直接访问的共享空间，通过对这片共享空间进行写/读操作实现进程之间的信息交换。在对共享空间进行写/读操作时，需要使用同步互斥工具（信号量），对共享空间的写/读进行控制。



::: tip 特点

1. ==共享内存是最快的一种 IPC，因为进程是直接对内存进行存取。==
2. 因为多个进程可以同时操作，所以需要进行同步。
3. 信号量 + 共享内存通常结合在一起使用，信号量用来同步对共享内存的访问。

:::



操作系统只负责为通信进程提供可共享使用的存储空间和同步互斥工具，而数据交换则由用户自己安排读/写指令完成。注意，进程空间一般都是独立的，进程运行期间一般不能访问其他进程的空间，想让两个进程共享空间，**必须通过特殊的系统调用实现**，而进程内的线程是自然共享进程空间的。

![preview](README.assets/v2-195b0cf5f101ed8c11910fea9b77559e_r.jpg)

## 六、套接字

**主要用于在客户端和服务器之间通过网络进行通信**

> 套接字是一种通信机制，凭借这种机制，客户/服务器（即要进行通信的进程）系统的开发工作既可以在本地单机上进行，也可以跨网络进行。也就是说它可以让不在同一台计算机但通过网络连接计算机上的进程进行通信。
>
> 套接字是支持TCP/IP的网络通信的基本操作单元，可以看做是不同主机之间的进程进行双向通信的端点，简单的说就是通信的两方的一种约定，用套接字中的相关函数来完成通信过程。
