---
# 这是页面的图标
icon: page

# 这是文章的标题
title: 第一章、进程与线程的基本概念

# 设置作者
author: lllllan

# 设置写作时间
# time: 2020-01-20

# 一个页面只能有一个分类
category: Java

# 一个页面可以有多个标签
tag:
- Java 多线程
- 深入浅出多线程

# 此页面会在文章列表置顶
# sticky: true

# 此页面会出现在首页的文章板块中
star: true

# 你可以自定义页脚
# footer: 
---



::: warning 转载声明

- [深入浅出多线程 - 第一章 - GitHub](https://github.com/RedSpider1/concurrent/blob/develop/article/01/1.md)
- [进程和线程的由来与区别](https://blog.csdn.net/whl_program/article/details/70217354)
- [线程的几种状态转换](https://www.cnblogs.com/jijijiefang/articles/7222955.html)

:::



## 一、进程的由来



### 1.1 操作系统

人力计算（成本大、错误多） → 计算机计算（一条指令一个操作）

当用户在思考或者输入时，计算机就在等待。显然这样**效率低下，在很多时候，计算机都处在等待状态**。



### 1.2 批处理操作体统

→ 批处理操作系统（指令清单，逐条执行）

但是由于批处理操作系统的 **指令运行方式仍然是串行的，内存中始终只有一个程序在运行**，后面的程序需要等待前面的程序执行完成后才能开始执行，而前面的程序有时会由于I/O操作、网络等 原因阻塞，所以**批处理操作效率也不高**

> 假如有两个任务A和B,需要读取大量的数据输入（I/O操作），而其实CPU只能处在等待状态，等任务A读取完数据再能继续进行，这样就白白浪费了CPU资源。



### 1.3 进程

这时候，人们就发明了进程，用进程来对应一个程序，每个进程来对应一定的内存地址空间。此时，CPU采用时间片轮转的方式运行进程：CPU为每个进程分配一个时间段，称作它的时间片。如果在时间片结束时进程还在运行，则暂停这个进程的运行，并且 CPU分配给另一个进程（这个过程叫做 **上下文切换**）。如果进程在时间片结束前阻塞或结束，则CPU立即进行切换，不用等待时间片用完。

::: info 进程

进程就是应用程序在内存中分配的空间，也就是正在运行的程序，各个进程之间互不干扰

:::





## 二、线程的由来

进程：一段时间只能做一件事情，效率低下

> 比如当你使用杀毒软件中的扫描病毒功能时，在扫描病毒结束之前，无法使用杀毒软件中清理垃圾的功能，这显然无法满足人们的要求。

于是人们又提出了线程的概念，让一个线程执行一个子任务，这样一个进程就包含了多个线程，每个线程负责一个单独的子任 务。

> 使用线程之后，事情就变得简单多了。当用户使用扫描病毒功能时，就让扫描病毒这个线程去执行。同时，如果用户又使用清理垃圾功能，那么可以先暂停扫描病毒线程，先响应用户的清理垃圾的操作，让清理垃圾这个线程去执行。响应完后再切换回来，接着执行扫描病毒线程。



## 三、进程和线程的区别

进程是一个独立的运行环境，而线程是在进程中执行的一个任务。他们两个本质的区别是 ==是否单独占有内存地址空间及其它系统资源（比如I/O）==

- 进程单独占有一定的内存地址空间，所以进程间存在内存隔离，数据是分开的，**数据共享复杂但是同步简单**，各个进程之间互不干扰；而线程共享所属进 程占有的内存地址空间和资源，数据共享简单，但是同步复杂。
- 进程单独占有一定的内存地址空间，一个进程出现问题不会影响其他进程，不影响主程序的稳定性，**可靠性高**；一个线程崩溃可能影响整个程序的稳定性， 可靠性较低。
- 进程单独占有一定的内存地址空间，进程的创建和销毁不仅需要保存寄存器和栈信息，还需要资源的分配回收以及页调度，**开销较大**；线程只需要保存寄存 器和栈信息，开销较小

另外一个重要区别是，==进程是操作系统进行资源分配的基本单位，而线程是操作系统进行调度的基本单位==，即CPU分配时间的单位 。



## 四、多进程和多线程

多进程方式确实可以实现并发，但使用多线程，有以下几个好处： 

- 进程间的通信比较复杂，而线程间的 **通信比较简单**，通常情况下，我们需要使用共享资源，这些资源在线程间的通信比较容易。 
- 进程是重量级的，而线程是轻量级的，故多线程方式的 **系统开销更小**。



## 五、上下文切换



::: info 上下文切换

（有时也称做进程切换或任务切换）是指 CPU 从一个进程（或线程） 切换到另一个进程（或线程）。上下文是指某一时间点 CPU 寄存器和程序计数器的内容

:::



CPU通过为每个线程分配CPU时间片来实现多线程机制。CPU通过时间片分配算法来循环执行任务，当前任务执行一个时间片后会切换到下一个任务。 但是，在切换前会保存上一个任务的状态，以便下次切换回这个任务时，可以再加 载这个任务的状态。所以任务从保存到再加载的过程就是一次上下文切换。 上下文切换通常是计算密集型的，意味着此操作会 **消耗大量的 CPU 时间，故线程也不是越多越好**。如何减少系统中上下文切换次数，是提升多线程性能的一个重点课题。
