<!DOCTYPE html>
<html lang="zh">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>第七章、重排序与happens-before | lllllan</title>
    <meta name="generator" content="VuePress 1.9.7">
    <script src="https://cdn.jsdelivr.net/npm/react/umd/react.production.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/react-dom/umd/react-dom.production.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/vue/dist/vue.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@babel/standalone/babel.min.js"></script>
    <link rel="alternate" type="application/atom+xml" href="https://notes.lllllan.cn/atom.xml" title="lllllan Atom Feed">
    <link rel="alternate" type="application/json" href="https://notes.lllllan.cn/feed.json" title="lllllan JSON Feed">
    <link rel="alternate" type="application/rss+xml" href="https://notes.lllllan.cn/rss.xml" title="lllllan RSS Feed">
    <link rel="icon" href="/logo.png">
    <link rel="icon" href="/logo.png" type="image/png" sizes="512x512">
    <link rel="icon" href="/logo.png" type="image/png" sizes="192x192">
    <link rel="icon" href="/logo.png" type="image/png" sizes="512x512">
    <link rel="icon" href="/logo.png" type="image/png" sizes="192x192">
    <link rel="manifest" href="/manifest.webmanifest" crossorigin="use-credentials">
    <link rel="apple-touch-icon" href="/logo.png">
    <meta name="description" content="">
    <meta property="og:url" content="/java/concurrent/2/7/">
    <meta property="og:site_name" content="lllllan">
    <meta property="og:title" content="第七章、重排序与happens-before">
    <meta property="og:description" content="转载声明深入浅出多线程 - 第七章 - GitHub; 一、什么是重排序 计算机在执行程序时，为了提高性能，编译器和处理器常常会对指令做重排。 1.1 为什么指令重排序可以提高性能？ 简单地说，每一个指令都会包含多个步骤，每个步骤可能使用不同的硬件。因此，流水线技术产生了，它的原理是指令 1 还没有执行完，就可以开始执行指令 2，而不用等到指令 1 执行结">
    <meta property="og:type" content="article">
    <meta property="og:locale" content="zh">
    <meta property="og:locale:alternate" content="en-US">
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:image:alt" content="lllllan">
    <meta property="article:author" content="lllllan">
    <meta property="article:tag" content="Java 多线程">
    <meta name="theme-color" content="#46bd87">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="msapplication-TileImage" content="/logo.png">
    <meta name="msapplication-TileColor" content="#ffffff">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
    
    <link rel="preload" href="/assets/css/0.styles.8357e793.css" as="style"><link rel="preload" href="/assets/js/app.3cfaf037.js" as="script"><link rel="preload" href="/assets/js/vendors~layout-Layout.57f7cf63.js" as="script"><link rel="preload" href="/assets/js/vendors~layout-Blog~layout-Layout~layout-NotFound.b5e5e957.js" as="script"><link rel="preload" href="/assets/js/page-第七章、重排序与happens-before.f397aa11.js" as="script"><link rel="preload" href="/assets/js/vendors~layout-Blog~layout-Layout.3d94df6c.js" as="script"><link rel="prefetch" href="/assets/js/146.8ecf0fcc.js"><link rel="prefetch" href="/assets/js/147.7277abfe.js"><link rel="prefetch" href="/assets/js/148.72b87788.js"><link rel="prefetch" href="/assets/js/149.5b1c78b5.js"><link rel="prefetch" href="/assets/js/150.9f3c442c.js"><link rel="prefetch" href="/assets/js/151.397eb6c6.js"><link rel="prefetch" href="/assets/js/152.946d1bed.js"><link rel="prefetch" href="/assets/js/layout-Blog.f99d2bb8.js"><link rel="prefetch" href="/assets/js/layout-Layout.54f62305.js"><link rel="prefetch" href="/assets/js/layout-NotFound.d261f6b6.js"><link rel="prefetch" href="/assets/js/layout-Slide.ea59fbea.js"><link rel="prefetch" href="/assets/js/page--07c97f1e.9682816c.js"><link rel="prefetch" href="/assets/js/page-ArrayList源码解读.ac617910.js"><link rel="prefetch" href="/assets/js/page-CPU缓存.b1450893.js"><link rel="prefetch" href="/assets/js/page-Class类文件的结构.fff783c4.js"><link rel="prefetch" href="/assets/js/page-ConcurrentHashMap源码解读.7d274ff4.js"><link rel="prefetch" href="/assets/js/page-HTTP传输大文件.d069f78c.js"><link rel="prefetch" href="/assets/js/page-HTTP各版本.0f54efa8.js"><link rel="prefetch" href="/assets/js/page-HTTP和HTTPS.a307440d.js"><link rel="prefetch" href="/assets/js/page-HTTP常见面试题.02cfb7ad.js"><link rel="prefetch" href="/assets/js/page-HashMap源码解读.e4b0b293.js"><link rel="prefetch" href="/assets/js/page-HashTable源码解读.8dfd411b.js"><link rel="prefetch" href="/assets/js/page-HotSpot的算法实现细节.b3692516.js"><link rel="prefetch" href="/assets/js/page-HotSpot虚拟机中的对象.d8064812.js"><link rel="prefetch" href="/assets/js/page-IO多路复用.ea148810.js"><link rel="prefetch" href="/assets/js/page-IO管理概述.db862336.js"><link rel="prefetch" href="/assets/js/page-JVM常见问题.e2418f44.js"><link rel="prefetch" href="/assets/js/page-Java-IO.6369db6e.js"><link rel="prefetch" href="/assets/js/page-Java-反射.67f807aa.js"><link rel="prefetch" href="/assets/js/page-Java-基本概念与常识.ee6063ec.js"><link rel="prefetch" href="/assets/js/page-Java-基础语法.bdad3a89.js"><link rel="prefetch" href="/assets/js/page-Java-异常.9839f810.js"><link rel="prefetch" href="/assets/js/page-Java-数据类型.94028146.js"><link rel="prefetch" href="/assets/js/page-Java-注解.e0de1c52.js"><link rel="prefetch" href="/assets/js/page-Java-面向对象.0cb9a8a8.js"><link rel="prefetch" href="/assets/js/page-Java集合框架基础知识.5041ae0e.js"><link rel="prefetch" href="/assets/js/page-MVCC.d3753661.js"><link rel="prefetch" href="/assets/js/page-MySQL基础架构.9323b9b1.js"><link rel="prefetch" href="/assets/js/page-MySQL日志系统.8c5ad6eb.js"><link rel="prefetch" href="/assets/js/page-MySQL面试题合集.79f4bdf0.js"><link rel="prefetch" href="/assets/js/page-OSI和TCPIP网络分层模型详解.9a83baa3.js"><link rel="prefetch" href="/assets/js/page-TCP可靠传输.dbf4f132.js"><link rel="prefetch" href="/assets/js/page-TCP常见面试题.17d88d75.js"><link rel="prefetch" href="/assets/js/page-Vector源码解读.1f7882ef.js"><link rel="prefetch" href="/assets/js/page-keep-alive.660d6377.js"><link rel="prefetch" href="/assets/js/page-next-key锁.1c1605b7.js"><link rel="prefetch" href="/assets/js/page-三次握手.eeca79bd.js"><link rel="prefetch" href="/assets/js/page-不稳定的快速排序.847b1f67.js"><link rel="prefetch" href="/assets/js/page-事务.7fd522ac.js"><link rel="prefetch" href="/assets/js/page-二叉搜索树代码实现.ba59d2ea.js"><link rel="prefetch" href="/assets/js/page-代理模式.33e7d015.js"><link rel="prefetch" href="/assets/js/page-低延迟垃圾收集器.5957b38b.js"><link rel="prefetch" href="/assets/js/page-内存分配与回收策略.fa1beb18.js"><link rel="prefetch" href="/assets/js/page-内存管理.21c2b061.js"><link rel="prefetch" href="/assets/js/page-内存管理概念.fd14d2bf.js"><link rel="prefetch" href="/assets/js/page-动态类型语言支持.cc325dab.js"><link rel="prefetch" href="/assets/js/page-同步与互斥.e0216efd.js"><link rel="prefetch" href="/assets/js/page-四次挥手.5f9bf01e.js"><link rel="prefetch" href="/assets/js/page-垃圾收集算法.4ffb0014.js"><link rel="prefetch" href="/assets/js/page-处理机调度.206354d1.js"><link rel="prefetch" href="/assets/js/page-字节后端实习.5f806ee8.js"><link rel="prefetch" href="/assets/js/page-字节后端日常实习.682f997d.js"><link rel="prefetch" href="/assets/js/page-字节客户端春招.5da03438.js"><link rel="prefetch" href="/assets/js/page-字节抖音直播支付日常实习.70b08b50.js"><link rel="prefetch" href="/assets/js/page-字节番茄后端实习.d08dd9b5.js"><link rel="prefetch" href="/assets/js/page-字节码指令简介.28f93755.js"><link rel="prefetch" href="/assets/js/page-字节码解释执行引擎.2e2e8d2c.js"><link rel="prefetch" href="/assets/js/page-字节飞书后端春招.a8861f6e.js"><link rel="prefetch" href="/assets/js/page-对象已死.81214d58.js"><link rel="prefetch" href="/assets/js/page-常见面试题.d9eb79ea.js"><link rel="prefetch" href="/assets/js/page-平衡搜索树.01472381.js"><link rel="prefetch" href="/assets/js/page-排序算法.0fc7cd5e.js"><link rel="prefetch" href="/assets/js/page-操作系统.bcbaa656.js"><link rel="prefetch" href="/assets/js/page-操作系统发展历程.1643b450.js"><link rel="prefetch" href="/assets/js/page-操作系统的基本概念.0d693799.js"><link rel="prefetch" href="/assets/js/page-操作系统结构.e665da9b.js"><link rel="prefetch" href="/assets/js/page-操作系统运行环境.fd564f64.js"><link rel="prefetch" href="/assets/js/page-数据结构.7bcfc44f.js"><link rel="prefetch" href="/assets/js/page-数据结构和算法.fd8d96d6.js"><link rel="prefetch" href="/assets/js/page-文件管理.17c3170b.js"><link rel="prefetch" href="/assets/js/page-文件系统.2119f002.js"><link rel="prefetch" href="/assets/js/page-方法调用.7c89d00f.js"><link rel="prefetch" href="/assets/js/page-无关性的基石.f9392463.js"><link rel="prefetch" href="/assets/js/page-框架技术概览.040752f8.js"><link rel="prefetch" href="/assets/js/page-概述.83749280.js"><link rel="prefetch" href="/assets/js/page-死锁.02c94d20.js"><link rel="prefetch" href="/assets/js/page-目录.18627bc0.js"><link rel="prefetch" href="/assets/js/page-磁盘和固态硬盘.ae5b6830.js"><link rel="prefetch" href="/assets/js/page-第一章、Web及网络基础.bd9f2488.js"><link rel="prefetch" href="/assets/js/page-第一章、浏览器生成消息.8487d4c1.js"><link rel="prefetch" href="/assets/js/page-第一章、进程与线程的基本概念.61ff5e39.js"><link rel="prefetch" href="/assets/js/page-第七章、HTTPS.705f7cf3.js"><link rel="prefetch" href="/assets/js/page-第三章、HTTP报文.cd78f9a3.js"><link rel="prefetch" href="/assets/js/page-第三章、从网线到网络设备.ee12068c.js"><link rel="prefetch" href="/assets/js/page-第三章、线程组和线程优先级.eb5780ec.js"><link rel="prefetch" href="/assets/js/page-第九章、synchronized与锁.545db104.js"><link rel="prefetch" href="/assets/js/page-第九章、追加协议.4c3565e9.js"><link rel="prefetch" href="/assets/js/page-第二十章、计划任务.db158ba5.js"><link rel="prefetch" href="/assets/js/page-第二章、Java多线程入门类和接口.d67fade0.js"><link rel="prefetch" href="/assets/js/page-第二章、用电信号传输TCPIP数据.6ca26d3f.js"><link rel="prefetch" href="/assets/js/page-第二章、简单的HTTP协议.482c12da.js"><link rel="prefetch" href="/assets/js/page-第五章、Java线程间的通信.87783899.js"><link rel="prefetch" href="/assets/js/page-第五章、Web服务器.a3458c74.js"><link rel="prefetch" href="/assets/js/page-第八章、volatile.79caedc9.js"><link rel="prefetch" href="/assets/js/page-第八章、确认用户身份.d1254733.js"><link rel="prefetch" href="/assets/js/page-第六章、Http首部.4e518637.js"><link rel="prefetch" href="/assets/js/page-第六章、Java内存模型基础知识.c6da8868.js"><link rel="prefetch" href="/assets/js/page-第十一章、AQS（不懂）.511d4d29.js"><link rel="prefetch" href="/assets/js/page-第十一章、Web的攻击技术.fbf36423.js"><link rel="prefetch" href="/assets/js/page-第十七章、通信工具类.0fb368b3.js"><link rel="prefetch" href="/assets/js/page-第十三章、阻塞队列.208bddeb.js"><link rel="prefetch" href="/assets/js/page-第十九章、Stream并行计算原理（不懂）.e5a43d6c.js"><link rel="prefetch" href="/assets/js/page-第十二章、线程池原理.3278632a.js"><link rel="prefetch" href="/assets/js/page-第十五章、并发容器集合.41631d72.js"><link rel="prefetch" href="/assets/js/page-第十八章、ForkJoin框架.1b5c300c.js"><link rel="prefetch" href="/assets/js/page-第十六章、CopyOnWrite容器.704da6e8.js"><link rel="prefetch" href="/assets/js/page-第十四章、锁接口和类.193cf6db.js"><link rel="prefetch" href="/assets/js/page-第十章、CAS与原子操作.c70c1f56.js"><link rel="prefetch" href="/assets/js/page-第十章、构建Web内容的技术.0700ec3d.js"><link rel="prefetch" href="/assets/js/page-第四章、Http状态码.bf7c2706.js"><link rel="prefetch" href="/assets/js/page-第四章、Java线程的状态及主要转化方法.fac7b947.js"><link rel="prefetch" href="/assets/js/page-算法.87f91ecc.js"><link rel="prefetch" href="/assets/js/page-类加载器.0e8812ee.js"><link rel="prefetch" href="/assets/js/page-类加载的时机.8807ba03.js"><link rel="prefetch" href="/assets/js/page-类加载的过程.775f3dea.js"><link rel="prefetch" href="/assets/js/page-索引.efcf3576.js"><link rel="prefetch" href="/assets/js/page-经典垃圾收集器.58be1e98.js"><link rel="prefetch" href="/assets/js/page-虚拟内存管理.544e96eb.js"><link rel="prefetch" href="/assets/js/page-虚拟机.6023f0a9.js"><link rel="prefetch" href="/assets/js/page-计算机基础.61f3ffaa.js"><link rel="prefetch" href="/assets/js/page-计算机网络-常见面试题.9082da64.js"><link rel="prefetch" href="/assets/js/page-设备独立性软件.7a800410.js"><link rel="prefetch" href="/assets/js/page-设计模式.e243f235.js"><link rel="prefetch" href="/assets/js/page-路由器和交换机.378394d6.js"><link rel="prefetch" href="/assets/js/page-输入url网址到页面显示.43f78fb6.js"><link rel="prefetch" href="/assets/js/page-运行时数据区域.4455e38d.js"><link rel="prefetch" href="/assets/js/page-运行时栈帧结构.e6b9f372.js"><link rel="prefetch" href="/assets/js/page-进程与线程.912285b0.js"><link rel="prefetch" href="/assets/js/page-进程和线程.2f7d4f3c.js"><link rel="prefetch" href="/assets/js/page-进程间通信.1fec56ad.js"><link rel="prefetch" href="/assets/js/page-选择合适的垃圾收集器.d5134ff8.js"><link rel="prefetch" href="/assets/js/page-项目主页.efb34bec.js"><link rel="prefetch" href="/assets/js/page-顺序一致性.ff3e582e.js"><link rel="prefetch" href="/assets/js/vendors~flowchart.8857f3dd.js"><link rel="prefetch" href="/assets/js/vendors~mermaid.20000af9.js"><link rel="prefetch" href="/assets/js/vendors~photo-swipe.e38cb1a8.js"><link rel="prefetch" href="/assets/js/vendors~reveal.bec24043.js">
    <link rel="stylesheet" href="/assets/css/0.styles.8357e793.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container has-navbar has-sidebar has-anchor"><header class="navbar"><!----> <div class="content__navbar-start"></div> <button title="Sidebar Button" class="sidebar-button"><span class="icon"></span></button> <a href="/" class="home-link router-link-active"><img src="/logo.png" alt="lllllan" class="logo"> <!----> <span class="site-name can-hide">lllllan</span></a> <!----> <div class="content__navbar-center"></div> <div class="links"><button tabindex="-1" aria-hidden="true" class="color-button"><svg viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" class="skin-icon"><path d="M224 800c0 9.6 3.2 44.8 6.4 54.4 6.4 48-48 76.8-48 76.8s80 41.6 147.2 0 134.4-134.4
        38.4-195.2c-22.4-12.8-41.6-19.2-57.6-19.2C259.2 716.8 227.2 761.6 224 800zM560 675.2l-32
        51.2c-51.2 51.2-83.2 32-83.2 32 25.6 67.2 0 112-12.8 128 25.6 6.4 51.2 9.6 80 9.6 54.4 0
        102.4-9.6 150.4-32l0 0c3.2 0 3.2-3.2 3.2-3.2 22.4-16 12.8-35.2
        6.4-44.8-9.6-12.8-12.8-25.6-12.8-41.6 0-54.4 60.8-99.2 137.6-99.2 6.4 0 12.8 0 22.4
        0 12.8 0 38.4 9.6 48-25.6 0-3.2 0-3.2 3.2-6.4 0-3.2 3.2-6.4 3.2-6.4 6.4-16 6.4-16 6.4-19.2
        9.6-35.2 16-73.6 16-115.2 0-105.6-41.6-198.4-108.8-268.8C704 396.8 560 675.2 560 675.2zM224
        419.2c0-28.8 22.4-51.2 51.2-51.2 28.8 0 51.2 22.4 51.2 51.2 0 28.8-22.4 51.2-51.2 51.2C246.4
        470.4 224 448 224 419.2zM320 284.8c0-22.4 19.2-41.6 41.6-41.6 22.4 0 41.6 19.2 41.6 41.6 0
        22.4-19.2 41.6-41.6 41.6C339.2 326.4 320 307.2 320 284.8zM457.6 208c0-12.8 12.8-25.6 25.6-25.6
        12.8 0 25.6 12.8 25.6 25.6 0 12.8-12.8 25.6-25.6 25.6C470.4 233.6 457.6 220.8 457.6 208zM128
        505.6C128 592 153.6 672 201.6 736c28.8-60.8 112-60.8 124.8-60.8-16-51.2 16-99.2
        16-99.2l316.8-422.4c-48-19.2-99.2-32-150.4-32C297.6 118.4 128 291.2 128 505.6zM764.8
        86.4c-22.4 19.2-390.4 518.4-390.4 518.4-22.4 28.8-12.8 76.8 22.4 99.2l9.6 6.4c35.2 22.4
        80 12.8 99.2-25.6 0 0 6.4-12.8 9.6-19.2 54.4-105.6 275.2-524.8 288-553.6
        6.4-19.2-3.2-32-19.2-32C777.6 76.8 771.2 80 764.8 86.4z"></path></svg> <div class="color-picker-menu" style="display:none;"><div class="theme-options"><ul class="themecolor-select"><label for="themecolor-select">Theme Color:</label> <li><span class="default-theme"></span></li> </ul> <div class="darkmode-toggle"><label for="darkmode-toggle" class="desc">Theme Mode:</label> <div class="darkmode-switch"><div class="item day"><svg viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" class="icon light-icon"><path d="M512 256a42.667 42.667 0 0 0 42.667-42.667V128a42.667 42.667 0 0 0-85.334 0v85.333A42.667 42.667 0 0 0 512 256zm384 213.333h-85.333a42.667 42.667 0 0 0 0 85.334H896a42.667 42.667 0 0 0 0-85.334zM256 512a42.667 42.667 0 0 0-42.667-42.667H128a42.667 42.667 0 0 0 0 85.334h85.333A42.667 42.667 0 0 0 256 512zm9.387-298.667a42.667 42.667 0 0 0-59.307 62.72l61.44 59.307a42.667 42.667 0 0 0 31.147 11.947 42.667 42.667 0 0 0 30.72-13.227 42.667 42.667 0 0 0 0-60.16zm459.946 133.974a42.667 42.667 0 0 0 29.44-11.947l61.44-59.307a42.667 42.667 0 0 0-57.6-62.72l-61.44 60.587a42.667 42.667 0 0 0 0 60.16 42.667 42.667 0 0 0 28.16 13.227zM512 768a42.667 42.667 0 0 0-42.667 42.667V896a42.667 42.667 0 0 0 85.334 0v-85.333A42.667 42.667 0 0 0 512 768zm244.48-79.36a42.667 42.667 0 0 0-59.307 61.44l61.44 60.587a42.667 42.667 0 0 0 29.44 11.946 42.667 42.667 0 0 0 30.72-12.8 42.667 42.667 0 0 0 0-60.586zm-488.96 0-61.44 59.307a42.667 42.667 0 0 0 0 60.586 42.667 42.667 0 0 0 30.72 12.8 42.667 42.667 0 0 0 28.587-10.666l61.44-59.307a42.667 42.667 0 0 0-59.307-61.44zM512 341.333A170.667 170.667 0 1 0 682.667 512 170.667 170.667 0 0 0 512 341.333z" fill="currentColor"></path></svg></div> <div class="item auto active"><svg viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" class="icon auto-icon"><path d="M460.864 539.072H564.8L510.592 376l-49.728 163.072zM872 362.368V149.504H659.648L510.528 0l-149.12 149.504H149.12v212.928L0 511.872l149.12 149.504v212.928h212.352l149.12 149.504 149.12-149.504h212.352V661.376l149.12-149.504L872 362.368zM614.464 693.12l-31.616-90.624H438.272l-31.616 90.624h-85.888l144.576-407.68h90.368l144.576 407.68h-85.824zm0 0" fill="currentColor"></path></svg></div> <div class="item night"><svg viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" class="icon dark-icon"><path d="M935.539 630.402c-11.43-11.432-28.674-14.739-43.531-8.354-46.734 20.103-96.363 30.297-147.508 30.297-99.59 0-193.221-38.784-263.64-109.203-108.637-108.637-139.61-270.022-78.908-411.148a39.497 39.497 0 0 0-51.886-51.887c-52.637 22.64-100.017 54.81-140.826 95.616-85.346 85.346-132.346 198.821-132.346 319.52 0 120.7 47.001 234.172 132.347 319.519S408.063 947.11 528.76 947.11c120.7 0 234.172-47.003 319.52-132.351 40.809-40.81 72.978-88.19 95.616-140.826a39.497 39.497 0 0 0-8.356-43.532z" fill="currentColor"></path></svg></div></div> <!----></div></div></div></button> <div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link router-link-active"><i class="iconfont icon-home"></i>
  Blog Home
</a></div><div class="nav-item"><a href="/java/basic/" class="nav-link"><!---->
  Java
</a></div><div class="nav-item"><a href="/cs-basic/network/" class="nav-link"><!---->
  计算机网络
</a></div><div class="nav-item"><a href="/cs-basic/os/" class="nav-link"><!---->
  操作系统
</a></div><div class="nav-item"><a href="/mysql/" class="nav-link"><!---->
  MySQL
</a></div></nav> <!----> <a rel="noopener noreferrer" href="https://github.com/lllllan-fv/notes" target="_blank" class="repo-link can-hide">
  GitHub
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> <!----> <div class="content__navbar-end"></div></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><!----> <!----> <div class="content__sidebar-top"></div> <nav class="sidebar-nav-links"><div class="nav-item"><a href="/" class="nav-link router-link-active"><i class="iconfont icon-home"></i>
  Blog Home
</a></div><div class="nav-item"><a href="/java/basic/" class="nav-link"><!---->
  Java
</a></div><div class="nav-item"><a href="/cs-basic/network/" class="nav-link"><!---->
  计算机网络
</a></div><div class="nav-item"><a href="/cs-basic/os/" class="nav-link"><!---->
  操作系统
</a></div><div class="nav-item"><a href="/mysql/" class="nav-link"><!---->
  MySQL
</a></div> <a rel="noopener noreferrer" href="https://github.com/lllllan-fv/notes" target="_blank" class="repo-link">
  GitHub
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav> <!----> <div class="content__sidebar-center"></div> <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading clickable"><!----> <span class="title">Java 基础</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading clickable"><!----> <span class="title">Java 容器</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading clickable open"><!----> <span class="title">Java 多线程</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/java/concurrent/" aria-current="page" class="sidebar-link"><i class="iconfont icon-page"></i>常见面试题</a></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading clickable"><!----> <span class="title">深入浅出多线程 - 基础篇</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading clickable open"><!----> <span class="title">深入浅出多线程 - 原理篇</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/java/concurrent/2/6/" class="sidebar-link"><i class="iconfont icon-page"></i>第六章、Java内存模型基础知识</a></li><li><a href="/java/concurrent/2/7/" aria-current="page" class="active sidebar-link"><i class="iconfont icon-page"></i>第七章、重排序与happens-before</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/java/concurrent/2/7/#一、什么是重排序" class="sidebar-link">一、什么是重排序</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/java/concurrent/2/7/#_1-1-为什么指令重排序可以提高性能" class="sidebar-link heading3">1.1 为什么指令重排序可以提高性能？</a></li><li class="sidebar-sub-header"><a href="/java/concurrent/2/7/#_1-2-指令重排" class="sidebar-link heading3">1.2 指令重排</a></li></ul></li><li class="sidebar-sub-header"><a href="/java/concurrent/2/7/#二、顺序一致性模型与jmm的保证" class="sidebar-link">二、顺序一致性模型与JMM的保证</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/java/concurrent/2/7/#_2-1-数据竞争与顺序一致性" class="sidebar-link heading3">2.1 数据竞争与顺序一致性</a></li><li class="sidebar-sub-header"><a href="/java/concurrent/2/7/#_2-2-顺序一致性模型" class="sidebar-link heading3">2.2 顺序一致性模型</a></li><li class="sidebar-sub-header"><a href="/java/concurrent/2/7/#_2-3-jmm中同步程序的顺序一致性效果" class="sidebar-link heading3">2.3 JMM中同步程序的顺序一致性效果</a></li><li class="sidebar-sub-header"><a href="/java/concurrent/2/7/#_2-4-jmm中未同步程序的顺序一致性效果" class="sidebar-link heading3">2.4 JMM中未同步程序的顺序一致性效果</a></li></ul></li><li class="sidebar-sub-header"><a href="/java/concurrent/2/7/#三、happens-before" class="sidebar-link">三、happens-before</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/java/concurrent/2/7/#_3-1-什么是-happens-before" class="sidebar-link heading3">3.1 什么是 happens-before</a></li><li class="sidebar-sub-header"><a href="/java/concurrent/2/7/#_3-2-天然的happens-before关系" class="sidebar-link heading3">3.2 天然的happens-before关系</a></li></ul></li></ul></li><li><a href="/java/concurrent/2/8/" class="sidebar-link"><i class="iconfont icon-page"></i>第八章、volatile</a></li><li><a href="/java/concurrent/2/9/" class="sidebar-link"><i class="iconfont icon-page"></i>第九章、synchronized与锁</a></li><li><a href="/java/concurrent/2/10/" class="sidebar-link"><i class="iconfont icon-page"></i>第十章、CAS与原子操作</a></li><li><a href="/java/concurrent/2/11/" class="sidebar-link"><i class="iconfont icon-page"></i>第十一章、AQS（不懂）</a></li></ul></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading clickable"><!----> <span class="title">深入浅出多线程 - 工具篇</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading clickable"><!----> <span class="title">补充</span> <span class="arrow right"></span></p> <!----></section></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading clickable"><!----> <span class="title">Java 虚拟机</span> <span class="arrow right"></span></p> <!----></section></li></ul> <!----> <div class="content__sidebar-bottom"></div> <!----></aside> <main class="page"><nav class="breadcrumb"><ol vocab="https://schema.org/" typeof="BreadcrumbList"><li property="itemListElement" typeof="ListItem"><a href="/java/concurrent/" property="item" typeof="WebPage" class="router-link-active"><i class="iconfont icon-page"></i> <span property="name">常见面试题</span></a> <meta property="position" content="1"></li><li property="itemListElement" typeof="ListItem" class="is-active"><a href="/java/concurrent/2/7/" aria-current="page" property="item" typeof="WebPage" class="router-link-exact-active router-link-active"><i class="iconfont icon-page"></i> <span property="name">第七章、重排序与happens-before</span></a> <meta property="position" content="2"></li></ol></nav> <!----> <div class="content__page-top"></div> <div vocab="https://schema.org/" typeof="Article" class="page-title"><h1><i class="iconfont icon-page"></i> <span property="headline">第七章、重排序与happens-before</span></h1> <div class="page-info"><!----> <span aria-label="Author🖊" data-balloon-pos="down" categoryPath="/category/$category/" tagPath="/tag/$tag/"><svg viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" class="icon author-icon"><path d="M649.6 633.6c86.4-48 147.2-144 147.2-249.6 0-160-128-288-288-288s-288 128-288 288c0 108.8 57.6 201.6 147.2 249.6-121.6 48-214.4 153.6-240 288-3.2 9.6 0 19.2 6.4 25.6 3.2 9.6 12.8 12.8 22.4 12.8h704c9.6 0 19.2-3.2 25.6-12.8 6.4-6.4 9.6-16 6.4-25.6-25.6-134.4-121.6-240-243.2-288z" fill="currentColor"></path></svg> <span property="author">lllllan</span></span><span aria-label="Page views🔢" data-balloon-pos="down" defaultAuthor="lllllan" categoryPath="/category/$category/" tagPath="/tag/$tag/" class="visitor-info"><svg viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" class="icon eye-icon"><path d="M992 512.096c0-5.76-.992-10.592-1.28-11.136-.192-2.88-1.152-8.064-2.08-10.816-.256-.672-.544-1.376-.832-2.08-.48-1.568-1.024-3.104-1.6-4.32C897.664 290.112 707.104 160 512 160c-195.072 0-385.632 130.016-473.76 322.592-1.056 2.112-1.792 4.096-2.272 5.856a55.512 55.512 0 0 0-.64 1.6c-1.76 5.088-1.792 8.64-1.632 7.744-.832 3.744-1.568 11.168-1.568 11.168-.224 2.272-.224 4.032.032 6.304 0 0 .736 6.464 1.088 7.808.128 1.824.576 4.512 1.12 6.976h-.032c.448 2.08 1.12 4.096 1.984 6.08.48 1.536.992 2.976 1.472 4.032C126.432 733.856 316.992 864 512 864c195.136 0 385.696-130.048 473.216-321.696 1.376-2.496 2.24-4.832 2.848-6.912.256-.608.48-1.184.672-1.728 1.536-4.48 1.856-8.32 1.728-8.32l-.032.032c.608-3.104 1.568-7.744 1.568-13.28zM512 672c-88.224 0-160-71.776-160-160s71.776-160 160-160 160 71.776 160 160-71.776 160-160 160z" fill="currentColor"></path></svg> <span id="/java/concurrent/2/7/" data-flag-title="第七章、重排序与happens-before" class="leancloud_visitors waline-visitor-count"><span class="leancloud-visitors-count">...</span></span></span><span aria-label="Writing Date📅" data-balloon-pos="down" defaultAuthor="lllllan" categoryPath="/category/$category/" tagPath="/tag/$tag/" class="time-info"><svg viewBox="0 0 1030 1024" xmlns="http://www.w3.org/2000/svg" class="icon calendar-icon"><path d="M716.4 110.137c0-18.753-14.72-33.473-33.472-33.473-18.753 0-33.473 14.72-33.473 33.473v33.473h66.993v-33.473zm-334.87 0c0-18.753-14.72-33.473-33.473-33.473s-33.52 14.72-33.52 33.473v33.473h66.993v-33.473zm468.81 33.52H716.4v100.465c0 18.753-14.72 33.473-33.472 33.473a33.145 33.145 0 0 1-33.473-33.473V143.657H381.53v100.465c0 18.753-14.72 33.473-33.473 33.473a33.145 33.145 0 0 1-33.473-33.473V143.657H180.6A134.314 134.314 0 0 0 46.66 277.595v535.756A134.314 134.314 0 0 0 180.6 947.289h669.74a134.36 134.36 0 0 0 133.94-133.938V277.595a134.314 134.314 0 0 0-133.94-133.938zm33.473 267.877H147.126a33.145 33.145 0 0 1-33.473-33.473c0-18.752 14.72-33.473 33.473-33.473h736.687c18.752 0 33.472 14.72 33.472 33.473a33.145 33.145 0 0 1-33.472 33.473z" fill="currentColor"></path></svg> <span property="datePublished">2022-3-18</span></span><span role="navigation" aria-label="Category🌈" data-balloon-pos="down" defaultAuthor="lllllan" tagPath="/tag/$tag/" class="category-info enable"><svg viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" class="icon category-icon"><path d="M148.41 106.992h282.176c22.263 0 40.31 18.048 40.31 40.31V429.48c0 22.263-18.047 40.31-40.31 40.31H148.41c-22.263 0-40.311-18.047-40.311-40.31V147.302c0-22.263 18.048-40.31 40.311-40.31zm-.854 446.486H429.73c22.263 0 40.311 18.048 40.311 40.31v282.176c0 22.263-18.048 40.312-40.31 40.312H147.555c-22.263 0-40.311-18.049-40.311-40.312V593.79c0-22.263 18.048-40.311 40.31-40.311zm446.371-446.486h282.176c22.263 0 40.31 18.048 40.31 40.31V429.48c0 22.263-18.047 40.31-40.31 40.31H593.927c-22.263 0-40.311-18.047-40.311-40.31V147.302c0-22.263 18.048-40.31 40.31-40.31zm136.293 813.51H623.926c-40.925 0-74.22-33.388-74.22-74.425V623.992c0-41.038 33.387-74.424 74.425-74.424h222.085c41.038 0 74.424 33.226 74.424 74.067v114.233c0 10.244-8.304 18.548-18.547 18.548s-18.548-8.304-18.548-18.548V623.635c0-20.388-16.746-36.974-37.33-36.974H624.13c-20.585 0-37.331 16.747-37.331 37.33v222.086c0 20.585 16.654 37.331 37.126 37.331H730.22c10.243 0 18.547 8.304 18.547 18.547 0 10.244-8.304 18.547-18.547 18.547z" fill="currentColor"></path></svg> <span property="articleSection">Java</span></span><span aria-label="Tags🏷" data-balloon-pos="down" defaultAuthor="lllllan" categoryPath="/category/$category/"><svg viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" class="icon tag-icon"><path d="M939.902 458.563 910.17 144.567c-1.507-16.272-14.465-29.13-30.737-30.737L565.438 84.098h-.402c-3.215 0-5.726 1.005-7.634 2.913l-470.39 470.39a10.004 10.004 0 0 0 0 14.164l365.423 365.424c1.909 1.908 4.42 2.913 7.132 2.913s5.223-1.005 7.132-2.913l470.39-470.39c2.01-2.11 3.014-5.023 2.813-8.036zm-240.067-72.121c-35.458 0-64.286-28.828-64.286-64.286s28.828-64.285 64.286-64.285 64.286 28.828 64.286 64.285-28.829 64.286-64.286 64.286z" fill="currentColor"></path></svg> <ul class="tags-wrapper"><li class="tag clickable tag0"><span role="navigation">Java 多线程</span></li><li class="tag clickable tag1"><span role="navigation">深入浅出多线程</span></li></ul> <meta property="keywords" content="Java 多线程,深入浅出多线程"></span><span aria-label="Reading Time⌛" data-balloon-pos="down" defaultAuthor="lllllan" categoryPath="/category/$category/" tagPath="/tag/$tag/" class="reading-time-info"><svg viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" class="icon timer-icon"><path d="M799.387 122.15c4.402-2.978 7.38-7.897 7.38-13.463v-1.165c0-8.933-7.38-16.312-16.312-16.312H256.33c-8.933 0-16.311 7.38-16.311 16.312v1.165c0 5.825 2.977 10.874 7.637 13.592 4.143 194.44 97.22 354.963 220.201 392.763-122.204 37.542-214.893 196.511-220.2 389.397-4.661 5.049-7.638 11.651-7.638 19.03v5.825h566.49v-5.825c0-7.379-2.849-13.981-7.509-18.9-5.049-193.016-97.867-351.985-220.2-389.527 123.24-37.67 216.446-198.453 220.588-392.892zM531.16 450.445v352.632c117.674 1.553 211.787 40.778 211.787 88.676H304.097c0-48.286 95.149-87.382 213.728-88.676V450.445c-93.077-3.107-167.901-81.297-167.901-177.093 0-8.803 6.99-15.793 15.793-15.793 8.803 0 15.794 6.99 15.794 15.793 0 80.261 63.69 145.635 142.01 145.635s142.011-65.374 142.011-145.635c0-8.803 6.99-15.793 15.794-15.793s15.793 6.99 15.793 15.793c0 95.019-73.789 172.82-165.96 177.093z" fill="currentColor"></path></svg> <span>About 11 min</span> <meta property="timeRequired" content="PT11M"></span></div> <!----> <hr></div> <div class="anchor-place-holder"><aside id="anchor"><div class="anchor-wrapper"><ul class="anchor-list"><li class="anchor"><a href="/java/concurrent/2/7/#一、什么是重排序" class="anchor-link heading2"><div>一、什么是重排序</div></a></li><li class="anchor"><a href="/java/concurrent/2/7/#_1-1-为什么指令重排序可以提高性能" class="anchor-link heading3"><div>1.1 为什么指令重排序可以提高性能？</div></a></li><li class="anchor"><a href="/java/concurrent/2/7/#_1-2-指令重排" class="anchor-link heading3"><div>1.2 指令重排</div></a></li><li class="anchor"><a href="/java/concurrent/2/7/#二、顺序一致性模型与jmm的保证" class="anchor-link heading2"><div>二、顺序一致性模型与JMM的保证</div></a></li><li class="anchor"><a href="/java/concurrent/2/7/#_2-1-数据竞争与顺序一致性" class="anchor-link heading3"><div>2.1 数据竞争与顺序一致性</div></a></li><li class="anchor"><a href="/java/concurrent/2/7/#_2-2-顺序一致性模型" class="anchor-link heading3"><div>2.2 顺序一致性模型</div></a></li><li class="anchor"><a href="/java/concurrent/2/7/#_2-3-jmm中同步程序的顺序一致性效果" class="anchor-link heading3"><div>2.3 JMM中同步程序的顺序一致性效果</div></a></li><li class="anchor"><a href="/java/concurrent/2/7/#_2-4-jmm中未同步程序的顺序一致性效果" class="anchor-link heading3"><div>2.4 JMM中未同步程序的顺序一致性效果</div></a></li><li class="anchor"><a href="/java/concurrent/2/7/#三、happens-before" class="anchor-link heading2"><div>三、happens-before</div></a></li><li class="anchor"><a href="/java/concurrent/2/7/#_3-1-什么是-happens-before" class="anchor-link heading3"><div>3.1 什么是 happens-before</div></a></li><li class="anchor"><a href="/java/concurrent/2/7/#_3-2-天然的happens-before关系" class="anchor-link heading3"><div>3.2 天然的happens-before关系</div></a></li></ul></div></aside></div> <!----> <div class="content__content-top"></div> <div class="theme-default-content content__default"><div class="custom-block warning"><p class="custom-block-title">转载声明</p> <ul><li><a href="https://github.com/RedSpider1/concurrent/tree/develop/article/02/7.md" target="_blank" rel="noopener noreferrer">深入浅出多线程 - 第七章 - GitHub<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div> <h2 id="一、什么是重排序"><a href="#一、什么是重排序" class="header-anchor">#</a> 一、什么是重排序</h2> <p>计算机在执行程序时，为了提高性能，编译器和处理器常常会对指令做重排。</p> <h3 id="_1-1-为什么指令重排序可以提高性能"><a href="#_1-1-为什么指令重排序可以提高性能" class="header-anchor">#</a> 1.1 为什么指令重排序可以提高性能？</h3> <p>简单地说，每一个指令都会包含多个步骤，每个步骤可能使用不同的硬件。因此，<strong>流水线技术</strong>产生了，它的原理是指令 1 还没有执行完，就可以开始执行指令 2，而不用等到指令 1 执行结束之后再执行指令 2，这样就大大提高了效率。</p> <p>但是，流水线技术最害怕 <strong>中断</strong>，恢复中断的代价是比较大的，所以我们要想尽办法不让流水线中断。指令重排就是减少中断的一种技术。</p> <p>我们分析一下下面这个代码的执行情况：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>a = b + c;
d = e - f ;
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>先加载 b、c（<strong>注意，即有可能先加载b，也有可能先加载c</strong>），但是在执行 add(b, c) 的时候，需要等待 b、c 装载结束才能继续执行，也就是增加了停顿，那么后面的指令也会依次有停顿,这降低了计算机的执行效率。</p> <p>为了减少这个停顿，我们可以先加载 e 和 f，然后再去加载 add(b, c)，这样做对程序（串行）是没有影响的，但却减少了停顿。既然 add(b, c) 需要停顿，那还不如去做一些有意义的事情。</p> <p>综上所述，<strong>指令重排对于提高CPU处理性能十分必要。虽然由此带来了乱序的问题，但是这点牺牲是值得的。</strong></p> <h3 id="_1-2-指令重排"><a href="#_1-2-指令重排" class="header-anchor">#</a> 1.2 指令重排</h3> <ul><li><p><strong>编译器优化重排</strong></p> <p>编译器在 <strong>不改变单线程程序语义</strong> 的前提下，可以重新安排语句的执行顺序。</p></li> <li><p><strong>指令并行重排</strong></p> <p>现代处理器采用了指令级并行技术来将多条指令重叠执行。如果 <strong>不存在数据依赖性</strong> （即后一个执行的语句无需依赖前面执行的语句的结果），处理器可以改变语句对应的机器指令的执行顺序。</p></li> <li><p><strong>内存系统重排</strong></p> <p>由于处理器使用缓存和读写缓存冲区，这使得加载(load)和存储(store)操作看上去可能是在乱序执行，因为三级缓存的存在，导致内存与缓存的数据同步存在时间差。</p></li></ul> <p><strong>指令重排可以保证串行语义一致，但是没有义务保证多线程间的语义也一致</strong>。所以在多线程下，指令重排序可能会导致一些问题。</p> <h2 id="二、顺序一致性模型与jmm的保证"><a href="#二、顺序一致性模型与jmm的保证" class="header-anchor">#</a> 二、顺序一致性模型与JMM的保证</h2> <p>顺序一致性模型是一个 <strong>理论参考模型</strong>，内存模型在设计的时候都会以顺序一致性内存模型作为参考。</p> <h3 id="_2-1-数据竞争与顺序一致性"><a href="#_2-1-数据竞争与顺序一致性" class="header-anchor">#</a> 2.1 数据竞争与顺序一致性</h3> <p>当程序未正确同步的时候，就可能存在数据竞争。</p> <div class="custom-block info"><p class="custom-block-title">数据竞争</p> <p>在一个线程中写一个变量，在另一个线程读同一个变量，并且写和读没有通过同步来排序。</p></div> <p>如果程序中包含了数据竞争，那么运行的结果往往充满了<strong>不确定性</strong>，比如读发生在了写之前，可能就会读到错误的值；如果一个线程程序能够正确同步，那么就不存在数据竞争。</p> <p>Java 内存模型（JMM）对于正确同步多线程程序的内存一致性做了以下保证：</p> <blockquote><p><strong>如果程序是正确同步的，程序的执行将具有顺序一致性</strong>。 即程序的执行结果和该程序在顺序一致性模型中执行的结果相同。</p></blockquote> <p>这里的同步包括了使用 <code>volatile</code>、<code>final</code>、<code>synchronized</code> 等关键字来实现<strong>多线程下的同步</strong>。</p> <p>如果程序员没有正确使用 <code>volatile</code>、<code>final</code>、<code>synchronized</code>，那么即便是使用了同步（单线程下的同步），JMM 也不会有内存可见性的保证，可能会导致你的程序出错，并且具有不可重现性，很难排查。</p> <p>所以如何正确使用<code>volatile</code>、<code>final</code>、<code>synchronized</code>，是程序员应该去了解的。</p> <h3 id="_2-2-顺序一致性模型"><a href="#_2-2-顺序一致性模型" class="header-anchor">#</a> 2.2 顺序一致性模型</h3> <p><a href="/java/concurrent/def/sequential-consistency/">顺序一致性的理解</a></p> <p>顺序一致性内存模型是一个<strong>理想化的理论参考模型</strong>，它为程序员提供了极强的内存可见性保证。</p> <div class="custom-block info"><p class="custom-block-title">顺序一致性模型 两大特性</p> <ul><li>一个线程中的所有操作必须按照程序的顺序（即Java代码的顺序）来执行。</li> <li>不管程序是否同步，所有线程都只能看到一个单一的操作执行顺序。即在顺序一致性模型中，每个操作必须是<strong>原子性的，且立刻对所有线程可见</strong>。</li></ul></div> <p>为了理解这两个特性，我们举个例子，假设有两个线程A和B并发执行，线程A有3个操作，他们在程序中的顺序是<code>A1-&gt;A2-&gt;A3</code>，线程B也有3个操作，<code>B1-&gt;B2-&gt;B3</code>。</p> <p>假设<strong>正确使用了同步</strong>，A 线程的 3 个操作执行后释放锁，B 线程获取同一个锁。那么在 <strong>顺序一致性模型</strong> 中的执行效果如下所示：</p> <p><img src="data:image/png;base64,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" alt="正确同步" loading="lazy"></p> <p>操作的执行整体上有序，并且两个线程都只能看到这个执行顺序。</p> <p>假设 <strong>没有使用同步</strong>，那么在 <strong>顺序一致性模型</strong> 中的执行效果如下所示：</p> <p><img src="data:image/png;base64,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" alt="没有正确同步" loading="lazy"></p> <p>操作的执行整体上无序，但是两个线程都只能看到这个执行顺序。之所以可以得到这个保证，是因为顺序一致性模型中的 <strong>每个操作必须立即对任意线程可见</strong>。</p> <p><strong>但是JMM没有这样的保证。</strong></p> <p>比如，在当前线程把写过的数据缓存在本地内存中，在没有刷新到主内存之前，这个写操作仅对当前线程可见；从其他线程的角度来观察，这个写操作根本没有被当前线程所执行。只有当前线程把本地内存中写过的数据刷新到主内存之后，这个写操作才对其他线程可见。在这种情况下，当前线程和其他线程看到的执行顺序是不一样的。</p> <h3 id="_2-3-jmm中同步程序的顺序一致性效果"><a href="#_2-3-jmm中同步程序的顺序一致性效果" class="header-anchor">#</a> 2.3 JMM中同步程序的顺序一致性效果</h3> <p>在顺序一致性模型中，所有操作完全按照程序的顺序串行执行。但是JMM中，<mark>临界区内（同步块或同步方法中）</mark> 的代码可以发生重排序（但不允许临界区内的代码【逃逸】到临界区之外，因为会破坏锁的内存语义）。</p> <p><strong>虽然线程 A 在临界区做了重排序，但是因为锁的特性，线程 B 无法观察到线程 A 在临界区的重排序。这种重排序既提高了执行效率，又没有改变程序的执行结果。</strong></p> <p>同时，JMM会在退出临界区和进入临界区做特殊的处理，使得在临界区内程序获得与顺序一致性模型相同的内存视图。</p> <p><strong>由此可见，JMM的具体实现方针是：在不改变（正确同步的）程序执行结果的前提下，尽量为编译期和处理器的优化打开方便之门</strong>。</p> <h3 id="_2-4-jmm中未同步程序的顺序一致性效果"><a href="#_2-4-jmm中未同步程序的顺序一致性效果" class="header-anchor">#</a> 2.4 JMM中未同步程序的顺序一致性效果</h3> <p>对于未同步的多线程程序，JMM只提供<strong>最小安全性</strong>：线程读取到的值，要么是之前某个线程写入的值，要么是默认值，不会无中生有。</p> <p>为了实现这个安全性，JVM在堆上分配对象时，首先会对内存空间清零，然后才会在上面分配对象（这两个操作是同步的）。</p> <p><strong>JMM没有保证未同步程序的执行结果与该程序在顺序一致性中执行结果一致。因为如果要保证执行结果一致，那么JMM需要禁止大量的优化，对程序的执行性能会产生很大的影响。</strong></p> <div class="custom-block tip"><p class="custom-block-title">未同步程序在JMM和顺序一致性内存模型中的执行特性有如下差异：</p> <ol><li>顺序一致性保证单线程内的操作会按程序的顺序执行；JMM不保证单线程内的操作会按程序的顺序执行。（因为重排序，但是JMM保证单线程下的重排序不影响执行结果）</li> <li>顺序一致性模型保证所有线程只能看到一致的操作执行顺序，而JMM不保证所有线程能看到一致的操作执行顺序。（因为JMM不保证所有操作立即可见）</li> <li>顺序一致性模型保证对所有的内存读写操作都具有原子性，而JMM不保证对64位的long型和double型变量的写操作具有原子性。</li></ol></div> <h2 id="三、happens-before"><a href="#三、happens-before" class="header-anchor">#</a> 三、happens-before</h2> <h3 id="_3-1-什么是-happens-before"><a href="#_3-1-什么是-happens-before" class="header-anchor">#</a> 3.1 什么是 happens-before</h3> <blockquote><p>一方面，程序员需要JMM提供一个强的内存模型来编写代码；另一方面，编译器和处理器希望JMM对它们的束缚越少越好，这样它们就可以最可能多的做优化来提高性能，希望的是一个弱的内存模型。</p></blockquote> <p>JMM考虑了这两种需求，并且找到了平衡点，对编译器和处理器来说，<strong>只要不改变程序的执行结果（单线程程序和正确同步了的多线程程序），编译器和处理器怎么优化都行。</strong></p> <p>而对于程序员，JMM 提供了 <mark>happens-before规则（JSR-133规范）</mark> ，满足了程序员的需求 —— <mark>简单易懂，并且提供了足够强的内存可见性保证</mark>。 换言之，程序员只要遵循 happens-before 规则，那他写的程序就能保证在 JMM 中具有强的内存可见性。</p> <p>JMM 使用 happens-before 的概念来定制两个操作之间的执行顺序。这两个操作可以在一个线程以内，也可以是不同的线程之间。因此，JMM 可以通过 happens-before 关系向程序员提供跨线程的内存可见性保证。</p> <div class="custom-block info"><p class="custom-block-title">happens-before 关系定义</p> <ol><li>如果一个操作 happens-before 另一个操作，那么第一个操作的执行结果将对第二个操作可见，而且第一个操作的执行顺序排在第二个操作之前。</li> <li><strong>两个操作之间存在 happens-before 关系，并不意味着 Java 平台的具体实现必须要按照 happens-before 关系指定的顺序来执行。如果重排序之后的执行结果，与按 happens-before 关系来执行的结果一致，那么 JMM 也允许这样的重排序。</strong></li></ol></div> <div class="custom-block info"><p class="custom-block-title">as-if-serial</p> <p>happens-before 关系本质上和 as-if-serial 语义是一回事。</p> <p><mark>不管怎么重排序（编译器和处理器为了提高并行度），（单线程）程序的执行结果不能被改变</mark></p> <p>happens-before 关系保证正确同步的多线程程序的执行结果不被重排序改变。</p></div> <p>总之，<strong>如果操作A happens-before操作B，那么操作A在内存上所做的操作对操作B都是可见的，不管它们在不在一个线程。</strong></p> <h3 id="_3-2-天然的happens-before关系"><a href="#_3-2-天然的happens-before关系" class="header-anchor">#</a> 3.2 天然的happens-before关系</h3> <p>在Java中，有以下天然的happens-before关系：</p> <ul><li>程序顺序规则：一个线程中的每一个操作，happens-before于该线程中的任意后续操作。</li> <li>监视器锁规则：对一个锁的解锁，happens-before于随后对这个锁的加锁。</li> <li>volatile变量规则：对一个volatile域的写，happens-before于任意后续对这个volatile域的读。</li> <li>传递性：如果A happens-before B，且B happens-before C，那么A happens-before C。</li> <li>start规则：如果线程A执行操作ThreadB.start()启动线程B，那么A线程的ThreadB.start（）操作happens-before于线程B中的任意操作、</li> <li>join规则：如果线程A执行操作ThreadB.join（）并成功返回，那么线程B中的任意操作happens-before于线程A从ThreadB.join()操作成功返回。</li></ul> <p>举例：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>int a = 1; // A操作
int b = 2; // B操作
int sum = a + b;// C 操作
System.out.println(sum);
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>根据以上介绍的happens-before规则，假如只有一个线程，那么不难得出：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>1&gt; A happens-before B 
2&gt; B happens-before C 
3&gt; A happens-before C
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>注意，真正在执行指令的时候，其实JVM有可能对操作A &amp; B进行重排序，因为无论先执行A还是B，他们都对对方是可见的，并且不影响执行结果。</p> <p>如果这里发生了重排序，这在视觉上违背了 happens-before 原则，但是JMM是允许这样的重排序的。</p> <p>所以，我们只关心 happens-before 规则，不用关心JVM到底是怎样执行的。只要确定操作A happens-before操作B就行了。</p> <p>重排序有两类，JMM对这两类重排序有不同的策略：</p> <ul><li>会改变程序执行结果的重排序，比如 A -&gt; C，JMM要求编译器和处理器都禁止这种重排序。</li> <li>不会改变程序执行结果的重排序，比如 A -&gt; B，JMM对编译器和处理器不做要求，允许这种重排序。</li></ul></div> <!----> <div class="content__content-bottom"></div> <footer class="page-meta"><div class="edit-link"><svg viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" class="icon edit-icon"><path d="M117.953 696.992 64.306 959.696l265.931-49.336 450.204-452.505-212.284-213.376-450.204 452.513zm496.384-296.326L219.039 797.993l-46.108-46.34L568.233 354.33l46.104 46.335zm345.357-122.99-114.45 115.04-212.288-213.377 114.45-115.035 212.288 213.371zm0 0" fill="currentColor"></path></svg> <a href="https://github.com/lllllan-fv/notes/edit/main/java/concurrent/2/7/README.md" target="_blank" rel="noopener noreferrer">Edit this page</a></div> <div class="meta-item update-time"><span class="label">Last update:</span> <span class="info">2022年4月18日 16:34</span></div> <div class="meta-item contributors"><span class="label">Contributors: </span> <span class="info"><span title="email: 342310798@qq.com" class="contributor">
          lllllan
        </span> <!----></span></div></footer> <div class="page-nav"><p class="inner"><span class="prev"><a href="/java/concurrent/2/6/" class="prev"><svg viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" class="icon prev-icon"><path d="M906.783 588.79c-.02 8.499-6.882 15.36-15.38 15.37l-443.7-.01 75.704 191.682c2.52 6.42.482 13.763-5.038 17.91-5.52 4.168-13.138 4.147-18.616-.092L123.228 524.175a15.362 15.362 0 0 1-6-12.165c0-4.782 2.222-9.277 6-12.185L499.753 210.35a15.388 15.388 0 0 1 9.38-3.195c3.236 0 6.502 1.034 9.236 3.103 5.52 4.147 7.578 11.49 5.038 17.91L447.683 419.84l443.72-.01c8.498.01 15.36 6.881 15.36 15.36l.02 153.6z" fill="currentColor"></path></svg>
        第六章、Java内存模型基础知识
      </a></span> <span class="next"><a href="/java/concurrent/2/8/">
        第八章、volatile
        <svg viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" class="icon next-icon"><path d="M906.772 512c0 4.772-2.211 9.267-5.99 12.175L524.257 813.66a15.37 15.37 0 0 1-18.616.092 15.368 15.368 0 0 1-5.038-17.91l75.714-191.672h-443.73c-8.488 0-15.36-6.881-15.36-15.36v-153.6c0-8.489 6.872-15.36 15.36-15.36h443.73l-75.714-191.682a15.358 15.358 0 0 1 5.048-17.91c5.51-4.158 13.128-4.137 18.606.092l376.525 289.485a15.323 15.323 0 0 1 5.99 12.165z" fill="currentColor"></path></svg></a></span></p></div> <!----> <!----> <div class="content__page-bottom"></div></main> <footer class="footer-wrapper"><!----> <div class="footer"><a href="https://beian.miit.gov.cn/" target="_blank">粤ICP备2021095794号</a></div> <div class="copyright">Copyright © 2022 lllllan</div></footer></div><div class="global-ui"><!----><!----><div id="pwa-install"><!----> <div id="install-modal-wrapper" style="display:none;"><div class="background"></div> <div class="install-modal"><div class="header"><button aria-label="Close" class="close-button"><svg width="23" height="22" xmlns="http://www.w3.org/2000/svg" class="icon close-icon"><path fill-rule="evenodd" clip-rule="evenodd" d="M1.12.358a1.224 1.224 0 011.729 0l8.92 8.914L20.686.358a1.224 1.224 0 011.73 1.728L13.497 11l8.92 8.913a1.222 1.222 0 11-1.73 1.729l-8.919-8.913-8.92 8.913a1.224 1.224 0 01-1.729-1.729L10.04 11l-8.92-8.914a1.222 1.222 0 010-1.728z" fill="currentColor"></path></svg></button> <div class="logo"><!----> <div class="title"><h1></h1> <p class="desc">This app can be installed on your PC or mobile device.  This will allow this web app to look and behave like any other installed app.  You will find it in your app lists and be able to pin it to your home screen, start menus or task bars.  This installed web app will also be able to safely interact with other apps and your operating system. </p></div></div></div> <div class="content"><div class="highlight"><!----> <!----></div> <div class="description"><h3>Description</h3> <p></p></div></div> <div class="button-wrapper"><button class="install-button">
        Install <span></span></button> <button class="cancel-button">
        Cancel
      </button></div></div></div></div><div tabindex="-1" role="dialog" aria-hidden="true" class="pswp"><div class="pswp__bg"></div> <div class="pswp__scroll-wrap"><div class="pswp__container"><div class="pswp__item"></div> <div class="pswp__item"></div> <div class="pswp__item"></div></div> <div class="pswp__ui pswp__ui--hidden"><div class="pswp__top-bar"><div class="pswp__counter"></div> <button title="Close" aria-label="Close" class="pswp__button pswp__button--close"></button> <button title="Share" aria-label="Share" class="pswp__button pswp__button--share"></button> <button title="Switch to full screen" aria-label="Switch to full screen" class="pswp__button pswp__button--fs"></button> <button title="Zoom in/out" aria-label="Zoom in/out" class="pswp__button pswp__button--zoom"></button> <div class="pswp__preloader"><div class="pswp__preloader__icn"><div class="pswp__preloader__cut"><div class="pswp__preloader__donut"></div></div></div></div></div> <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap"><div class="pswp__share-tooltip"></div></div> <button title="Prev (Arrow Left)" aria-label="Prev (Arrow Left)" class="pswp__button pswp__button--arrow--left"></button> <button title="Next (Arrow Right)" aria-label="Next (Arrow Right)" class="pswp__button pswp__button--arrow--right"></button> <div class="pswp__caption"><div class="pswp__caption__center"></div></div></div></div></div></div></div>
    <script src="/assets/js/app.3cfaf037.js" defer></script><script src="/assets/js/vendors~layout-Layout.57f7cf63.js" defer></script><script src="/assets/js/vendors~layout-Blog~layout-Layout~layout-NotFound.b5e5e957.js" defer></script><script src="/assets/js/page-第七章、重排序与happens-before.f397aa11.js" defer></script><script src="/assets/js/vendors~layout-Blog~layout-Layout.3d94df6c.js" defer></script>
  </body>
</html>
