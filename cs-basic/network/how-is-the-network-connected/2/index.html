<!DOCTYPE html>
<html lang="zh">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>第二章、用电信号传输 TCP/IP 数据 | lllllan</title>
    <meta name="generator" content="VuePress 1.9.7">
    <script src="https://cdn.jsdelivr.net/npm/react/umd/react.production.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/react-dom/umd/react-dom.production.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/vue/dist/vue.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@babel/standalone/babel.min.js"></script>
    <link rel="alternate" type="application/atom+xml" href="https://notes.lllllan.cn/atom.xml" title="lllllan Atom Feed">
    <link rel="alternate" type="application/json" href="https://notes.lllllan.cn/feed.json" title="lllllan JSON Feed">
    <link rel="alternate" type="application/rss+xml" href="https://notes.lllllan.cn/rss.xml" title="lllllan RSS Feed">
    <link rel="icon" href="/logo.png">
    <link rel="icon" href="/logo.png" type="image/png" sizes="512x512">
    <link rel="icon" href="/logo.png" type="image/png" sizes="192x192">
    <link rel="icon" href="/logo.png" type="image/png" sizes="512x512">
    <link rel="icon" href="/logo.png" type="image/png" sizes="192x192">
    <link rel="manifest" href="/manifest.webmanifest" crossorigin="use-credentials">
    <link rel="apple-touch-icon" href="/logo.png">
    <meta name="description" content="">
    <meta property="og:url" content="/cs-basic/network/how-is-the-network-connected/2/">
    <meta property="og:site_name" content="lllllan">
    <meta property="og:title" content="第二章、用电信号传输 TCP/IP 数据">
    <meta property="og:description" content="转载声明《网络是怎样连接的》; TCP 、UDP、IP包的最大长度 - 江召伟; 零、前情提要 1. 创建套接字。 2. 连接服务器。 3. 收发数据。 4. 断开连接并删除套接字。 5. IP与以太网的包收发操作。 6. 用UDP协议收发数据的操作。 一、创建套接字 1.1 协议栈的内部结构&quot; 浏览器、邮件等一般应用程序收发数据时用TCP；&quot;&quot;&quot;">
    <meta property="og:type" content="article">
    <meta property="og:locale" content="zh">
    <meta property="og:locale:alternate" content="en-US">
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:image:alt" content="lllllan">
    <meta property="article:author" content="lllllan">
    <meta property="article:tag" content="计算机网络">
    <meta name="theme-color" content="#46bd87">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="msapplication-TileImage" content="/logo.png">
    <meta name="msapplication-TileColor" content="#ffffff">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
    
    <link rel="preload" href="/assets/css/0.styles.8357e793.css" as="style"><link rel="preload" href="/assets/js/app.3cfaf037.js" as="script"><link rel="preload" href="/assets/js/vendors~layout-Layout.57f7cf63.js" as="script"><link rel="preload" href="/assets/js/vendors~layout-Blog~layout-Layout~layout-NotFound.b5e5e957.js" as="script"><link rel="preload" href="/assets/js/page-第二章、用电信号传输TCPIP数据.6ca26d3f.js" as="script"><link rel="preload" href="/assets/js/vendors~layout-Blog~layout-Layout.3d94df6c.js" as="script"><link rel="prefetch" href="/assets/js/146.8ecf0fcc.js"><link rel="prefetch" href="/assets/js/147.7277abfe.js"><link rel="prefetch" href="/assets/js/148.72b87788.js"><link rel="prefetch" href="/assets/js/149.5b1c78b5.js"><link rel="prefetch" href="/assets/js/150.9f3c442c.js"><link rel="prefetch" href="/assets/js/151.397eb6c6.js"><link rel="prefetch" href="/assets/js/152.946d1bed.js"><link rel="prefetch" href="/assets/js/layout-Blog.f99d2bb8.js"><link rel="prefetch" href="/assets/js/layout-Layout.54f62305.js"><link rel="prefetch" href="/assets/js/layout-NotFound.d261f6b6.js"><link rel="prefetch" href="/assets/js/layout-Slide.ea59fbea.js"><link rel="prefetch" href="/assets/js/page--07c97f1e.9682816c.js"><link rel="prefetch" href="/assets/js/page-ArrayList源码解读.ac617910.js"><link rel="prefetch" href="/assets/js/page-CPU缓存.b1450893.js"><link rel="prefetch" href="/assets/js/page-Class类文件的结构.fff783c4.js"><link rel="prefetch" href="/assets/js/page-ConcurrentHashMap源码解读.7d274ff4.js"><link rel="prefetch" href="/assets/js/page-HTTP传输大文件.d069f78c.js"><link rel="prefetch" href="/assets/js/page-HTTP各版本.0f54efa8.js"><link rel="prefetch" href="/assets/js/page-HTTP和HTTPS.a307440d.js"><link rel="prefetch" href="/assets/js/page-HTTP常见面试题.02cfb7ad.js"><link rel="prefetch" href="/assets/js/page-HashMap源码解读.e4b0b293.js"><link rel="prefetch" href="/assets/js/page-HashTable源码解读.8dfd411b.js"><link rel="prefetch" href="/assets/js/page-HotSpot的算法实现细节.b3692516.js"><link rel="prefetch" href="/assets/js/page-HotSpot虚拟机中的对象.d8064812.js"><link rel="prefetch" href="/assets/js/page-IO多路复用.ea148810.js"><link rel="prefetch" href="/assets/js/page-IO管理概述.db862336.js"><link rel="prefetch" href="/assets/js/page-JVM常见问题.e2418f44.js"><link rel="prefetch" href="/assets/js/page-Java-IO.6369db6e.js"><link rel="prefetch" href="/assets/js/page-Java-反射.67f807aa.js"><link rel="prefetch" href="/assets/js/page-Java-基本概念与常识.ee6063ec.js"><link rel="prefetch" href="/assets/js/page-Java-基础语法.bdad3a89.js"><link rel="prefetch" href="/assets/js/page-Java-异常.9839f810.js"><link rel="prefetch" href="/assets/js/page-Java-数据类型.94028146.js"><link rel="prefetch" href="/assets/js/page-Java-注解.e0de1c52.js"><link rel="prefetch" href="/assets/js/page-Java-面向对象.0cb9a8a8.js"><link rel="prefetch" href="/assets/js/page-Java集合框架基础知识.5041ae0e.js"><link rel="prefetch" href="/assets/js/page-MVCC.d3753661.js"><link rel="prefetch" href="/assets/js/page-MySQL基础架构.9323b9b1.js"><link rel="prefetch" href="/assets/js/page-MySQL日志系统.8c5ad6eb.js"><link rel="prefetch" href="/assets/js/page-MySQL面试题合集.79f4bdf0.js"><link rel="prefetch" href="/assets/js/page-OSI和TCPIP网络分层模型详解.9a83baa3.js"><link rel="prefetch" href="/assets/js/page-TCP可靠传输.dbf4f132.js"><link rel="prefetch" href="/assets/js/page-TCP常见面试题.17d88d75.js"><link rel="prefetch" href="/assets/js/page-Vector源码解读.1f7882ef.js"><link rel="prefetch" href="/assets/js/page-keep-alive.660d6377.js"><link rel="prefetch" href="/assets/js/page-next-key锁.1c1605b7.js"><link rel="prefetch" href="/assets/js/page-三次握手.eeca79bd.js"><link rel="prefetch" href="/assets/js/page-不稳定的快速排序.847b1f67.js"><link rel="prefetch" href="/assets/js/page-事务.7fd522ac.js"><link rel="prefetch" href="/assets/js/page-二叉搜索树代码实现.ba59d2ea.js"><link rel="prefetch" href="/assets/js/page-代理模式.33e7d015.js"><link rel="prefetch" href="/assets/js/page-低延迟垃圾收集器.5957b38b.js"><link rel="prefetch" href="/assets/js/page-内存分配与回收策略.fa1beb18.js"><link rel="prefetch" href="/assets/js/page-内存管理.21c2b061.js"><link rel="prefetch" href="/assets/js/page-内存管理概念.fd14d2bf.js"><link rel="prefetch" href="/assets/js/page-动态类型语言支持.cc325dab.js"><link rel="prefetch" href="/assets/js/page-同步与互斥.e0216efd.js"><link rel="prefetch" href="/assets/js/page-四次挥手.5f9bf01e.js"><link rel="prefetch" href="/assets/js/page-垃圾收集算法.4ffb0014.js"><link rel="prefetch" href="/assets/js/page-处理机调度.206354d1.js"><link rel="prefetch" href="/assets/js/page-字节后端实习.5f806ee8.js"><link rel="prefetch" href="/assets/js/page-字节后端日常实习.682f997d.js"><link rel="prefetch" href="/assets/js/page-字节客户端春招.5da03438.js"><link rel="prefetch" href="/assets/js/page-字节抖音直播支付日常实习.70b08b50.js"><link rel="prefetch" href="/assets/js/page-字节番茄后端实习.d08dd9b5.js"><link rel="prefetch" href="/assets/js/page-字节码指令简介.28f93755.js"><link rel="prefetch" href="/assets/js/page-字节码解释执行引擎.2e2e8d2c.js"><link rel="prefetch" href="/assets/js/page-字节飞书后端春招.a8861f6e.js"><link rel="prefetch" href="/assets/js/page-对象已死.81214d58.js"><link rel="prefetch" href="/assets/js/page-常见面试题.d9eb79ea.js"><link rel="prefetch" href="/assets/js/page-平衡搜索树.01472381.js"><link rel="prefetch" href="/assets/js/page-排序算法.0fc7cd5e.js"><link rel="prefetch" href="/assets/js/page-操作系统.bcbaa656.js"><link rel="prefetch" href="/assets/js/page-操作系统发展历程.1643b450.js"><link rel="prefetch" href="/assets/js/page-操作系统的基本概念.0d693799.js"><link rel="prefetch" href="/assets/js/page-操作系统结构.e665da9b.js"><link rel="prefetch" href="/assets/js/page-操作系统运行环境.fd564f64.js"><link rel="prefetch" href="/assets/js/page-数据结构.7bcfc44f.js"><link rel="prefetch" href="/assets/js/page-数据结构和算法.fd8d96d6.js"><link rel="prefetch" href="/assets/js/page-文件管理.17c3170b.js"><link rel="prefetch" href="/assets/js/page-文件系统.2119f002.js"><link rel="prefetch" href="/assets/js/page-方法调用.7c89d00f.js"><link rel="prefetch" href="/assets/js/page-无关性的基石.f9392463.js"><link rel="prefetch" href="/assets/js/page-框架技术概览.040752f8.js"><link rel="prefetch" href="/assets/js/page-概述.83749280.js"><link rel="prefetch" href="/assets/js/page-死锁.02c94d20.js"><link rel="prefetch" href="/assets/js/page-目录.18627bc0.js"><link rel="prefetch" href="/assets/js/page-磁盘和固态硬盘.ae5b6830.js"><link rel="prefetch" href="/assets/js/page-第一章、Web及网络基础.bd9f2488.js"><link rel="prefetch" href="/assets/js/page-第一章、浏览器生成消息.8487d4c1.js"><link rel="prefetch" href="/assets/js/page-第一章、进程与线程的基本概念.61ff5e39.js"><link rel="prefetch" href="/assets/js/page-第七章、HTTPS.705f7cf3.js"><link rel="prefetch" href="/assets/js/page-第七章、重排序与happens-before.f397aa11.js"><link rel="prefetch" href="/assets/js/page-第三章、HTTP报文.cd78f9a3.js"><link rel="prefetch" href="/assets/js/page-第三章、从网线到网络设备.ee12068c.js"><link rel="prefetch" href="/assets/js/page-第三章、线程组和线程优先级.eb5780ec.js"><link rel="prefetch" href="/assets/js/page-第九章、synchronized与锁.545db104.js"><link rel="prefetch" href="/assets/js/page-第九章、追加协议.4c3565e9.js"><link rel="prefetch" href="/assets/js/page-第二十章、计划任务.db158ba5.js"><link rel="prefetch" href="/assets/js/page-第二章、Java多线程入门类和接口.d67fade0.js"><link rel="prefetch" href="/assets/js/page-第二章、简单的HTTP协议.482c12da.js"><link rel="prefetch" href="/assets/js/page-第五章、Java线程间的通信.87783899.js"><link rel="prefetch" href="/assets/js/page-第五章、Web服务器.a3458c74.js"><link rel="prefetch" href="/assets/js/page-第八章、volatile.79caedc9.js"><link rel="prefetch" href="/assets/js/page-第八章、确认用户身份.d1254733.js"><link rel="prefetch" href="/assets/js/page-第六章、Http首部.4e518637.js"><link rel="prefetch" href="/assets/js/page-第六章、Java内存模型基础知识.c6da8868.js"><link rel="prefetch" href="/assets/js/page-第十一章、AQS（不懂）.511d4d29.js"><link rel="prefetch" href="/assets/js/page-第十一章、Web的攻击技术.fbf36423.js"><link rel="prefetch" href="/assets/js/page-第十七章、通信工具类.0fb368b3.js"><link rel="prefetch" href="/assets/js/page-第十三章、阻塞队列.208bddeb.js"><link rel="prefetch" href="/assets/js/page-第十九章、Stream并行计算原理（不懂）.e5a43d6c.js"><link rel="prefetch" href="/assets/js/page-第十二章、线程池原理.3278632a.js"><link rel="prefetch" href="/assets/js/page-第十五章、并发容器集合.41631d72.js"><link rel="prefetch" href="/assets/js/page-第十八章、ForkJoin框架.1b5c300c.js"><link rel="prefetch" href="/assets/js/page-第十六章、CopyOnWrite容器.704da6e8.js"><link rel="prefetch" href="/assets/js/page-第十四章、锁接口和类.193cf6db.js"><link rel="prefetch" href="/assets/js/page-第十章、CAS与原子操作.c70c1f56.js"><link rel="prefetch" href="/assets/js/page-第十章、构建Web内容的技术.0700ec3d.js"><link rel="prefetch" href="/assets/js/page-第四章、Http状态码.bf7c2706.js"><link rel="prefetch" href="/assets/js/page-第四章、Java线程的状态及主要转化方法.fac7b947.js"><link rel="prefetch" href="/assets/js/page-算法.87f91ecc.js"><link rel="prefetch" href="/assets/js/page-类加载器.0e8812ee.js"><link rel="prefetch" href="/assets/js/page-类加载的时机.8807ba03.js"><link rel="prefetch" href="/assets/js/page-类加载的过程.775f3dea.js"><link rel="prefetch" href="/assets/js/page-索引.efcf3576.js"><link rel="prefetch" href="/assets/js/page-经典垃圾收集器.58be1e98.js"><link rel="prefetch" href="/assets/js/page-虚拟内存管理.544e96eb.js"><link rel="prefetch" href="/assets/js/page-虚拟机.6023f0a9.js"><link rel="prefetch" href="/assets/js/page-计算机基础.61f3ffaa.js"><link rel="prefetch" href="/assets/js/page-计算机网络-常见面试题.9082da64.js"><link rel="prefetch" href="/assets/js/page-设备独立性软件.7a800410.js"><link rel="prefetch" href="/assets/js/page-设计模式.e243f235.js"><link rel="prefetch" href="/assets/js/page-路由器和交换机.378394d6.js"><link rel="prefetch" href="/assets/js/page-输入url网址到页面显示.43f78fb6.js"><link rel="prefetch" href="/assets/js/page-运行时数据区域.4455e38d.js"><link rel="prefetch" href="/assets/js/page-运行时栈帧结构.e6b9f372.js"><link rel="prefetch" href="/assets/js/page-进程与线程.912285b0.js"><link rel="prefetch" href="/assets/js/page-进程和线程.2f7d4f3c.js"><link rel="prefetch" href="/assets/js/page-进程间通信.1fec56ad.js"><link rel="prefetch" href="/assets/js/page-选择合适的垃圾收集器.d5134ff8.js"><link rel="prefetch" href="/assets/js/page-项目主页.efb34bec.js"><link rel="prefetch" href="/assets/js/page-顺序一致性.ff3e582e.js"><link rel="prefetch" href="/assets/js/vendors~flowchart.8857f3dd.js"><link rel="prefetch" href="/assets/js/vendors~mermaid.20000af9.js"><link rel="prefetch" href="/assets/js/vendors~photo-swipe.e38cb1a8.js"><link rel="prefetch" href="/assets/js/vendors~reveal.bec24043.js">
    <link rel="stylesheet" href="/assets/css/0.styles.8357e793.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container has-navbar has-sidebar has-anchor"><header class="navbar"><!----> <div class="content__navbar-start"></div> <button title="Sidebar Button" class="sidebar-button"><span class="icon"></span></button> <a href="/" class="home-link router-link-active"><img src="/logo.png" alt="lllllan" class="logo"> <!----> <span class="site-name can-hide">lllllan</span></a> <!----> <div class="content__navbar-center"></div> <div class="links"><button tabindex="-1" aria-hidden="true" class="color-button"><svg viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" class="skin-icon"><path d="M224 800c0 9.6 3.2 44.8 6.4 54.4 6.4 48-48 76.8-48 76.8s80 41.6 147.2 0 134.4-134.4
        38.4-195.2c-22.4-12.8-41.6-19.2-57.6-19.2C259.2 716.8 227.2 761.6 224 800zM560 675.2l-32
        51.2c-51.2 51.2-83.2 32-83.2 32 25.6 67.2 0 112-12.8 128 25.6 6.4 51.2 9.6 80 9.6 54.4 0
        102.4-9.6 150.4-32l0 0c3.2 0 3.2-3.2 3.2-3.2 22.4-16 12.8-35.2
        6.4-44.8-9.6-12.8-12.8-25.6-12.8-41.6 0-54.4 60.8-99.2 137.6-99.2 6.4 0 12.8 0 22.4
        0 12.8 0 38.4 9.6 48-25.6 0-3.2 0-3.2 3.2-6.4 0-3.2 3.2-6.4 3.2-6.4 6.4-16 6.4-16 6.4-19.2
        9.6-35.2 16-73.6 16-115.2 0-105.6-41.6-198.4-108.8-268.8C704 396.8 560 675.2 560 675.2zM224
        419.2c0-28.8 22.4-51.2 51.2-51.2 28.8 0 51.2 22.4 51.2 51.2 0 28.8-22.4 51.2-51.2 51.2C246.4
        470.4 224 448 224 419.2zM320 284.8c0-22.4 19.2-41.6 41.6-41.6 22.4 0 41.6 19.2 41.6 41.6 0
        22.4-19.2 41.6-41.6 41.6C339.2 326.4 320 307.2 320 284.8zM457.6 208c0-12.8 12.8-25.6 25.6-25.6
        12.8 0 25.6 12.8 25.6 25.6 0 12.8-12.8 25.6-25.6 25.6C470.4 233.6 457.6 220.8 457.6 208zM128
        505.6C128 592 153.6 672 201.6 736c28.8-60.8 112-60.8 124.8-60.8-16-51.2 16-99.2
        16-99.2l316.8-422.4c-48-19.2-99.2-32-150.4-32C297.6 118.4 128 291.2 128 505.6zM764.8
        86.4c-22.4 19.2-390.4 518.4-390.4 518.4-22.4 28.8-12.8 76.8 22.4 99.2l9.6 6.4c35.2 22.4
        80 12.8 99.2-25.6 0 0 6.4-12.8 9.6-19.2 54.4-105.6 275.2-524.8 288-553.6
        6.4-19.2-3.2-32-19.2-32C777.6 76.8 771.2 80 764.8 86.4z"></path></svg> <div class="color-picker-menu" style="display:none;"><div class="theme-options"><ul class="themecolor-select"><label for="themecolor-select">Theme Color:</label> <li><span class="default-theme"></span></li> </ul> <div class="darkmode-toggle"><label for="darkmode-toggle" class="desc">Theme Mode:</label> <div class="darkmode-switch"><div class="item day"><svg viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" class="icon light-icon"><path d="M512 256a42.667 42.667 0 0 0 42.667-42.667V128a42.667 42.667 0 0 0-85.334 0v85.333A42.667 42.667 0 0 0 512 256zm384 213.333h-85.333a42.667 42.667 0 0 0 0 85.334H896a42.667 42.667 0 0 0 0-85.334zM256 512a42.667 42.667 0 0 0-42.667-42.667H128a42.667 42.667 0 0 0 0 85.334h85.333A42.667 42.667 0 0 0 256 512zm9.387-298.667a42.667 42.667 0 0 0-59.307 62.72l61.44 59.307a42.667 42.667 0 0 0 31.147 11.947 42.667 42.667 0 0 0 30.72-13.227 42.667 42.667 0 0 0 0-60.16zm459.946 133.974a42.667 42.667 0 0 0 29.44-11.947l61.44-59.307a42.667 42.667 0 0 0-57.6-62.72l-61.44 60.587a42.667 42.667 0 0 0 0 60.16 42.667 42.667 0 0 0 28.16 13.227zM512 768a42.667 42.667 0 0 0-42.667 42.667V896a42.667 42.667 0 0 0 85.334 0v-85.333A42.667 42.667 0 0 0 512 768zm244.48-79.36a42.667 42.667 0 0 0-59.307 61.44l61.44 60.587a42.667 42.667 0 0 0 29.44 11.946 42.667 42.667 0 0 0 30.72-12.8 42.667 42.667 0 0 0 0-60.586zm-488.96 0-61.44 59.307a42.667 42.667 0 0 0 0 60.586 42.667 42.667 0 0 0 30.72 12.8 42.667 42.667 0 0 0 28.587-10.666l61.44-59.307a42.667 42.667 0 0 0-59.307-61.44zM512 341.333A170.667 170.667 0 1 0 682.667 512 170.667 170.667 0 0 0 512 341.333z" fill="currentColor"></path></svg></div> <div class="item auto active"><svg viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" class="icon auto-icon"><path d="M460.864 539.072H564.8L510.592 376l-49.728 163.072zM872 362.368V149.504H659.648L510.528 0l-149.12 149.504H149.12v212.928L0 511.872l149.12 149.504v212.928h212.352l149.12 149.504 149.12-149.504h212.352V661.376l149.12-149.504L872 362.368zM614.464 693.12l-31.616-90.624H438.272l-31.616 90.624h-85.888l144.576-407.68h90.368l144.576 407.68h-85.824zm0 0" fill="currentColor"></path></svg></div> <div class="item night"><svg viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" class="icon dark-icon"><path d="M935.539 630.402c-11.43-11.432-28.674-14.739-43.531-8.354-46.734 20.103-96.363 30.297-147.508 30.297-99.59 0-193.221-38.784-263.64-109.203-108.637-108.637-139.61-270.022-78.908-411.148a39.497 39.497 0 0 0-51.886-51.887c-52.637 22.64-100.017 54.81-140.826 95.616-85.346 85.346-132.346 198.821-132.346 319.52 0 120.7 47.001 234.172 132.347 319.519S408.063 947.11 528.76 947.11c120.7 0 234.172-47.003 319.52-132.351 40.809-40.81 72.978-88.19 95.616-140.826a39.497 39.497 0 0 0-8.356-43.532z" fill="currentColor"></path></svg></div></div> <!----></div></div></div></button> <div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link router-link-active"><i class="iconfont icon-home"></i>
  Blog Home
</a></div><div class="nav-item"><a href="/java/basic/" class="nav-link"><!---->
  Java
</a></div><div class="nav-item"><a href="/cs-basic/network/" class="nav-link router-link-active active"><!---->
  计算机网络
</a></div><div class="nav-item"><a href="/cs-basic/os/" class="nav-link"><!---->
  操作系统
</a></div><div class="nav-item"><a href="/mysql/" class="nav-link"><!---->
  MySQL
</a></div></nav> <!----> <a rel="noopener noreferrer" href="https://github.com/lllllan-fv/notes" target="_blank" class="repo-link can-hide">
  GitHub
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> <!----> <div class="content__navbar-end"></div></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><!----> <!----> <div class="content__sidebar-top"></div> <nav class="sidebar-nav-links"><div class="nav-item"><a href="/" class="nav-link router-link-active"><i class="iconfont icon-home"></i>
  Blog Home
</a></div><div class="nav-item"><a href="/java/basic/" class="nav-link"><!---->
  Java
</a></div><div class="nav-item"><a href="/cs-basic/network/" class="nav-link router-link-active active"><!---->
  计算机网络
</a></div><div class="nav-item"><a href="/cs-basic/os/" class="nav-link"><!---->
  操作系统
</a></div><div class="nav-item"><a href="/mysql/" class="nav-link"><!---->
  MySQL
</a></div> <a rel="noopener noreferrer" href="https://github.com/lllllan-fv/notes" target="_blank" class="repo-link">
  GitHub
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav> <!----> <div class="content__sidebar-center"></div> <ul class="sidebar-links"><li><a href="/cs-basic/network/" aria-current="page" class="sidebar-link"><i class="iconfont icon-page"></i>计算机网络-常见面试题</a></li><li><a href="/cs-basic/network/osi&amp;tcp/" class="sidebar-link"><i class="iconfont icon-page"></i>OSI 和 TCP/IP 网络分层模型详解</a></li><li><a href="/cs-basic/network/url-to-page/" class="sidebar-link"><i class="iconfont icon-page"></i>输入url网址到页面显示</a></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading clickable"><!----> <span class="title">HTTP</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading clickable"><!----> <span class="title">TCP</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading clickable"><!----> <span class="title">补充</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading clickable open"><!----> <span class="title">网络是怎样连接的</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/cs-basic/network/how-is-the-network-connected/1/" class="sidebar-link"><i class="iconfont icon-page"></i>第一章、浏览器生成消息</a></li><li><a href="/cs-basic/network/how-is-the-network-connected/2/" aria-current="page" class="active sidebar-link"><i class="iconfont icon-page"></i>第二章、用电信号传输 TCP/IP 数据</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/cs-basic/network/how-is-the-network-connected/2/#零、前情提要" class="sidebar-link">零、前情提要</a></li><li class="sidebar-sub-header"><a href="/cs-basic/network/how-is-the-network-connected/2/#一、创建套接字" class="sidebar-link">一、创建套接字</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/cs-basic/network/how-is-the-network-connected/2/#_1-1-协议栈的内部结构" class="sidebar-link heading3">1.1 协议栈的内部结构</a></li><li class="sidebar-sub-header"><a href="/cs-basic/network/how-is-the-network-connected/2/#_1-2-套接字的实体就是通信控制信息" class="sidebar-link heading3">1.2 套接字的实体就是通信控制信息</a></li><li class="sidebar-sub-header"><a href="/cs-basic/network/how-is-the-network-connected/2/#_1-3-调用-socket-时的操作" class="sidebar-link heading3">1.3 调用 socket 时的操作</a></li></ul></li><li class="sidebar-sub-header"><a href="/cs-basic/network/how-is-the-network-connected/2/#二、连接服务器" class="sidebar-link">二、连接服务器</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/cs-basic/network/how-is-the-network-connected/2/#_2-1-连接" class="sidebar-link heading3">2.1 连接</a></li><li class="sidebar-sub-header"><a href="/cs-basic/network/how-is-the-network-connected/2/#_2-2-负责保存控制信息的头部" class="sidebar-link heading3">2.2 负责保存控制信息的头部</a></li><li class="sidebar-sub-header"><a href="/cs-basic/network/how-is-the-network-connected/2/#_2-3-连接操作的实际过程" class="sidebar-link heading3">2.3 连接操作的实际过程</a></li></ul></li><li class="sidebar-sub-header"><a href="/cs-basic/network/how-is-the-network-connected/2/#三、收发数据" class="sidebar-link">三、收发数据</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/cs-basic/network/how-is-the-network-connected/2/#_3-1-将-http-请求交给协议栈" class="sidebar-link heading3">3.1 将 HTTP 请求交给协议栈</a></li><li class="sidebar-sub-header"><a href="/cs-basic/network/how-is-the-network-connected/2/#_3-2-对较大数据进行拆分" class="sidebar-link heading3">3.2 对较大数据进行拆分</a></li><li class="sidebar-sub-header"><a href="/cs-basic/network/how-is-the-network-connected/2/#_3-3-使用ack号确认网络包收到" class="sidebar-link heading3">3.3 使用ACK号确认网络包收到</a></li><li class="sidebar-sub-header"><a href="/cs-basic/network/how-is-the-network-connected/2/#_3-4-根据网络包平均往返时间调整ack号等待时间" class="sidebar-link heading3">3.4 根据网络包平均往返时间调整ACK号等待时间</a></li><li class="sidebar-sub-header"><a href="/cs-basic/network/how-is-the-network-connected/2/#_3-5-使用窗口有效管理ack号" class="sidebar-link heading3">3.5 使用窗口有效管理ACK号</a></li><li class="sidebar-sub-header"><a href="/cs-basic/network/how-is-the-network-connected/2/#_3-6-ack与窗口的合并" class="sidebar-link heading3">3.6 ACK与窗口的合并</a></li><li class="sidebar-sub-header"><a href="/cs-basic/network/how-is-the-network-connected/2/#_3-7-接收http响应消息" class="sidebar-link heading3">3.7 接收HTTP响应消息</a></li></ul></li><li class="sidebar-sub-header"><a href="/cs-basic/network/how-is-the-network-connected/2/#四、从服务器断开并删除套接字" class="sidebar-link">四、从服务器断开并删除套接字</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/cs-basic/network/how-is-the-network-connected/2/#_4-1-断开连接" class="sidebar-link heading3">4.1 断开连接</a></li><li class="sidebar-sub-header"><a href="/cs-basic/network/how-is-the-network-connected/2/#_4-2-删除套接字" class="sidebar-link heading3">4.2 删除套接字</a></li><li class="sidebar-sub-header"><a href="/cs-basic/network/how-is-the-network-connected/2/#_4-3-数据收发小结" class="sidebar-link heading3">4.3 数据收发小结</a></li></ul></li><li class="sidebar-sub-header"><a href="/cs-basic/network/how-is-the-network-connected/2/#五、ip-与以太网的包的收发操作" class="sidebar-link">五、IP 与以太网的包的收发操作</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/cs-basic/network/how-is-the-network-connected/2/#_5-1-包的基本知识" class="sidebar-link heading3">5.1 包的基本知识</a></li><li class="sidebar-sub-header"><a href="/cs-basic/network/how-is-the-network-connected/2/#_5-2-包收发操作概览" class="sidebar-link heading3">5.2 包收发操作概览</a></li><li class="sidebar-sub-header"><a href="/cs-basic/network/how-is-the-network-connected/2/#_5-3-ip头部" class="sidebar-link heading3">5.3 IP头部</a></li><li class="sidebar-sub-header"><a href="/cs-basic/network/how-is-the-network-connected/2/#_5-4-mac头部" class="sidebar-link heading3">5.4 MAC头部</a></li><li class="sidebar-sub-header"><a href="/cs-basic/network/how-is-the-network-connected/2/#_5-5-arp查询目标路由器的mac地址" class="sidebar-link heading3">5.5 ARP查询目标路由器的MAC地址</a></li><li class="sidebar-sub-header"><a href="/cs-basic/network/how-is-the-network-connected/2/#_5-6-以太网基本知识" class="sidebar-link heading3">5.6 以太网基本知识</a></li><li class="sidebar-sub-header"><a href="/cs-basic/network/how-is-the-network-connected/2/#_5-7-发送光电信号" class="sidebar-link heading3">5.7 发送光电信号</a></li><li class="sidebar-sub-header"><a href="/cs-basic/network/how-is-the-network-connected/2/#_5-8-给网络包添加控制数据" class="sidebar-link heading3">5.8 给网络包添加控制数据</a></li><li class="sidebar-sub-header"><a href="/cs-basic/network/how-is-the-network-connected/2/#_5-9-向集线器发送网络包" class="sidebar-link heading3">5.9 向集线器发送网络包</a></li><li class="sidebar-sub-header"><a href="/cs-basic/network/how-is-the-network-connected/2/#_5-10-接受返回包" class="sidebar-link heading3">5.10 接受返回包</a></li><li class="sidebar-sub-header"><a href="/cs-basic/network/how-is-the-network-connected/2/#_5-11-将服务器的响应包从ip传递给tcp" class="sidebar-link heading3">5.11 将服务器的响应包从IP传递给TCP</a></li></ul></li><li class="sidebar-sub-header"><a href="/cs-basic/network/how-is-the-network-connected/2/#六、udp-协议的收发操作" class="sidebar-link">六、UDP 协议的收发操作</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/cs-basic/network/how-is-the-network-connected/2/#_6-1-不需要重发的数据用-udp-更高效" class="sidebar-link heading3">6.1 不需要重发的数据用 UDP 更高效</a></li><li class="sidebar-sub-header"><a href="/cs-basic/network/how-is-the-network-connected/2/#_6-2-控制用的短数据" class="sidebar-link heading3">6.2 控制用的短数据</a></li><li class="sidebar-sub-header"><a href="/cs-basic/network/how-is-the-network-connected/2/#_6-3-音频和视频数据" class="sidebar-link heading3">6.3 音频和视频数据</a></li></ul></li><li class="sidebar-sub-header"><a href="/cs-basic/network/how-is-the-network-connected/2/#七、本章回顾" class="sidebar-link">七、本章回顾</a></li></ul></li><li><a href="/cs-basic/network/how-is-the-network-connected/3/" class="sidebar-link"><i class="iconfont icon-page"></i>第三章、从网线到网络设备</a></li><li><!----></li><li><!----></li><li><!----></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading clickable"><!----> <span class="title">图解HTTP</span> <span class="arrow right"></span></p> <!----></section></li></ul> <!----> <div class="content__sidebar-bottom"></div> <!----></aside> <main class="page"><nav class="breadcrumb"><ol vocab="https://schema.org/" typeof="BreadcrumbList"><li property="itemListElement" typeof="ListItem"><a href="/cs-basic/" property="item" typeof="WebPage" class="router-link-active"><i class="iconfont icon-info"></i> <span property="name">计算机基础</span></a> <meta property="position" content="1"></li><li property="itemListElement" typeof="ListItem"><a href="/cs-basic/network/" property="item" typeof="WebPage" class="router-link-active"><i class="iconfont icon-page"></i> <span property="name">计算机网络-常见面试题</span></a> <meta property="position" content="2"></li><li property="itemListElement" typeof="ListItem" class="is-active"><a href="/cs-basic/network/how-is-the-network-connected/2/" aria-current="page" property="item" typeof="WebPage" class="router-link-exact-active router-link-active"><i class="iconfont icon-page"></i> <span property="name">第二章、用电信号传输 TCP/IP 数据</span></a> <meta property="position" content="3"></li></ol></nav> <!----> <div class="content__page-top"></div> <div vocab="https://schema.org/" typeof="Article" class="page-title"><h1><i class="iconfont icon-page"></i> <span property="headline">第二章、用电信号传输 TCP/IP 数据</span></h1> <div class="page-info"><!----> <span aria-label="Author🖊" data-balloon-pos="down" categoryPath="/category/$category/" tagPath="/tag/$tag/"><svg viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" class="icon author-icon"><path d="M649.6 633.6c86.4-48 147.2-144 147.2-249.6 0-160-128-288-288-288s-288 128-288 288c0 108.8 57.6 201.6 147.2 249.6-121.6 48-214.4 153.6-240 288-3.2 9.6 0 19.2 6.4 25.6 3.2 9.6 12.8 12.8 22.4 12.8h704c9.6 0 19.2-3.2 25.6-12.8 6.4-6.4 9.6-16 6.4-25.6-25.6-134.4-121.6-240-243.2-288z" fill="currentColor"></path></svg> <span property="author">lllllan</span></span><span aria-label="Page views🔢" data-balloon-pos="down" defaultAuthor="lllllan" categoryPath="/category/$category/" tagPath="/tag/$tag/" class="visitor-info"><svg viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" class="icon eye-icon"><path d="M992 512.096c0-5.76-.992-10.592-1.28-11.136-.192-2.88-1.152-8.064-2.08-10.816-.256-.672-.544-1.376-.832-2.08-.48-1.568-1.024-3.104-1.6-4.32C897.664 290.112 707.104 160 512 160c-195.072 0-385.632 130.016-473.76 322.592-1.056 2.112-1.792 4.096-2.272 5.856a55.512 55.512 0 0 0-.64 1.6c-1.76 5.088-1.792 8.64-1.632 7.744-.832 3.744-1.568 11.168-1.568 11.168-.224 2.272-.224 4.032.032 6.304 0 0 .736 6.464 1.088 7.808.128 1.824.576 4.512 1.12 6.976h-.032c.448 2.08 1.12 4.096 1.984 6.08.48 1.536.992 2.976 1.472 4.032C126.432 733.856 316.992 864 512 864c195.136 0 385.696-130.048 473.216-321.696 1.376-2.496 2.24-4.832 2.848-6.912.256-.608.48-1.184.672-1.728 1.536-4.48 1.856-8.32 1.728-8.32l-.032.032c.608-3.104 1.568-7.744 1.568-13.28zM512 672c-88.224 0-160-71.776-160-160s71.776-160 160-160 160 71.776 160 160-71.776 160-160 160z" fill="currentColor"></path></svg> <span id="/cs-basic/network/how-is-the-network-connected/2/" data-flag-title="第二章、用电信号传输 TCP/IP 数据" class="leancloud_visitors waline-visitor-count"><span class="leancloud-visitors-count">...</span></span></span><span aria-label="Writing Date📅" data-balloon-pos="down" defaultAuthor="lllllan" categoryPath="/category/$category/" tagPath="/tag/$tag/" class="time-info"><svg viewBox="0 0 1030 1024" xmlns="http://www.w3.org/2000/svg" class="icon calendar-icon"><path d="M716.4 110.137c0-18.753-14.72-33.473-33.472-33.473-18.753 0-33.473 14.72-33.473 33.473v33.473h66.993v-33.473zm-334.87 0c0-18.753-14.72-33.473-33.473-33.473s-33.52 14.72-33.52 33.473v33.473h66.993v-33.473zm468.81 33.52H716.4v100.465c0 18.753-14.72 33.473-33.472 33.473a33.145 33.145 0 0 1-33.473-33.473V143.657H381.53v100.465c0 18.753-14.72 33.473-33.473 33.473a33.145 33.145 0 0 1-33.473-33.473V143.657H180.6A134.314 134.314 0 0 0 46.66 277.595v535.756A134.314 134.314 0 0 0 180.6 947.289h669.74a134.36 134.36 0 0 0 133.94-133.938V277.595a134.314 134.314 0 0 0-133.94-133.938zm33.473 267.877H147.126a33.145 33.145 0 0 1-33.473-33.473c0-18.752 14.72-33.473 33.473-33.473h736.687c18.752 0 33.472 14.72 33.472 33.473a33.145 33.145 0 0 1-33.472 33.473z" fill="currentColor"></path></svg> <span property="datePublished">2022-3-16</span></span><span role="navigation" aria-label="Category🌈" data-balloon-pos="down" defaultAuthor="lllllan" tagPath="/tag/$tag/" class="category-info enable"><svg viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" class="icon category-icon"><path d="M148.41 106.992h282.176c22.263 0 40.31 18.048 40.31 40.31V429.48c0 22.263-18.047 40.31-40.31 40.31H148.41c-22.263 0-40.311-18.047-40.311-40.31V147.302c0-22.263 18.048-40.31 40.311-40.31zm-.854 446.486H429.73c22.263 0 40.311 18.048 40.311 40.31v282.176c0 22.263-18.048 40.312-40.31 40.312H147.555c-22.263 0-40.311-18.049-40.311-40.312V593.79c0-22.263 18.048-40.311 40.31-40.311zm446.371-446.486h282.176c22.263 0 40.31 18.048 40.31 40.31V429.48c0 22.263-18.047 40.31-40.31 40.31H593.927c-22.263 0-40.311-18.047-40.311-40.31V147.302c0-22.263 18.048-40.31 40.31-40.31zm136.293 813.51H623.926c-40.925 0-74.22-33.388-74.22-74.425V623.992c0-41.038 33.387-74.424 74.425-74.424h222.085c41.038 0 74.424 33.226 74.424 74.067v114.233c0 10.244-8.304 18.548-18.547 18.548s-18.548-8.304-18.548-18.548V623.635c0-20.388-16.746-36.974-37.33-36.974H624.13c-20.585 0-37.331 16.747-37.331 37.33v222.086c0 20.585 16.654 37.331 37.126 37.331H730.22c10.243 0 18.547 8.304 18.547 18.547 0 10.244-8.304 18.547-18.547 18.547z" fill="currentColor"></path></svg> <span property="articleSection">计算机基础</span></span><span aria-label="Tags🏷" data-balloon-pos="down" defaultAuthor="lllllan" categoryPath="/category/$category/"><svg viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" class="icon tag-icon"><path d="M939.902 458.563 910.17 144.567c-1.507-16.272-14.465-29.13-30.737-30.737L565.438 84.098h-.402c-3.215 0-5.726 1.005-7.634 2.913l-470.39 470.39a10.004 10.004 0 0 0 0 14.164l365.423 365.424c1.909 1.908 4.42 2.913 7.132 2.913s5.223-1.005 7.132-2.913l470.39-470.39c2.01-2.11 3.014-5.023 2.813-8.036zm-240.067-72.121c-35.458 0-64.286-28.828-64.286-64.286s28.828-64.285 64.286-64.285 64.286 28.828 64.286 64.285-28.829 64.286-64.286 64.286z" fill="currentColor"></path></svg> <ul class="tags-wrapper"><li class="tag clickable tag0"><span role="navigation">计算机网络</span></li><li class="tag clickable tag1"><span role="navigation">网络是怎样连接的</span></li></ul> <meta property="keywords" content="计算机网络,网络是怎样连接的"></span><span aria-label="Reading Time⌛" data-balloon-pos="down" defaultAuthor="lllllan" categoryPath="/category/$category/" tagPath="/tag/$tag/" class="reading-time-info"><svg viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" class="icon timer-icon"><path d="M799.387 122.15c4.402-2.978 7.38-7.897 7.38-13.463v-1.165c0-8.933-7.38-16.312-16.312-16.312H256.33c-8.933 0-16.311 7.38-16.311 16.312v1.165c0 5.825 2.977 10.874 7.637 13.592 4.143 194.44 97.22 354.963 220.201 392.763-122.204 37.542-214.893 196.511-220.2 389.397-4.661 5.049-7.638 11.651-7.638 19.03v5.825h566.49v-5.825c0-7.379-2.849-13.981-7.509-18.9-5.049-193.016-97.867-351.985-220.2-389.527 123.24-37.67 216.446-198.453 220.588-392.892zM531.16 450.445v352.632c117.674 1.553 211.787 40.778 211.787 88.676H304.097c0-48.286 95.149-87.382 213.728-88.676V450.445c-93.077-3.107-167.901-81.297-167.901-177.093 0-8.803 6.99-15.793 15.793-15.793 8.803 0 15.794 6.99 15.794 15.793 0 80.261 63.69 145.635 142.01 145.635s142.011-65.374 142.011-145.635c0-8.803 6.99-15.793 15.794-15.793s15.793 6.99 15.793 15.793c0 95.019-73.789 172.82-165.96 177.093z" fill="currentColor"></path></svg> <span>About 15 min</span> <meta property="timeRequired" content="PT15M"></span></div> <!----> <hr></div> <div class="anchor-place-holder"><aside id="anchor"><div class="anchor-wrapper"><ul class="anchor-list"><li class="anchor"><a href="/cs-basic/network/how-is-the-network-connected/2/#零、前情提要" class="anchor-link heading2"><div>零、前情提要</div></a></li><li class="anchor"><a href="/cs-basic/network/how-is-the-network-connected/2/#一、创建套接字" class="anchor-link heading2"><div>一、创建套接字</div></a></li><li class="anchor"><a href="/cs-basic/network/how-is-the-network-connected/2/#_1-1-协议栈的内部结构" class="anchor-link heading3"><div>1.1 协议栈的内部结构</div></a></li><li class="anchor"><a href="/cs-basic/network/how-is-the-network-connected/2/#_1-2-套接字的实体就是通信控制信息" class="anchor-link heading3"><div>1.2 套接字的实体就是通信控制信息</div></a></li><li class="anchor"><a href="/cs-basic/network/how-is-the-network-connected/2/#_1-3-调用-socket-时的操作" class="anchor-link heading3"><div>1.3 调用 socket 时的操作</div></a></li><li class="anchor"><a href="/cs-basic/network/how-is-the-network-connected/2/#二、连接服务器" class="anchor-link heading2"><div>二、连接服务器</div></a></li><li class="anchor"><a href="/cs-basic/network/how-is-the-network-connected/2/#_2-1-连接" class="anchor-link heading3"><div>2.1 连接</div></a></li><li class="anchor"><a href="/cs-basic/network/how-is-the-network-connected/2/#_2-2-负责保存控制信息的头部" class="anchor-link heading3"><div>2.2 负责保存控制信息的头部</div></a></li><li class="anchor"><a href="/cs-basic/network/how-is-the-network-connected/2/#_2-3-连接操作的实际过程" class="anchor-link heading3"><div>2.3 连接操作的实际过程</div></a></li><li class="anchor"><a href="/cs-basic/network/how-is-the-network-connected/2/#三、收发数据" class="anchor-link heading2"><div>三、收发数据</div></a></li><li class="anchor"><a href="/cs-basic/network/how-is-the-network-connected/2/#_3-1-将-http-请求交给协议栈" class="anchor-link heading3"><div>3.1 将 HTTP 请求交给协议栈</div></a></li><li class="anchor"><a href="/cs-basic/network/how-is-the-network-connected/2/#_3-2-对较大数据进行拆分" class="anchor-link heading3"><div>3.2 对较大数据进行拆分</div></a></li><li class="anchor"><a href="/cs-basic/network/how-is-the-network-connected/2/#_3-3-使用ack号确认网络包收到" class="anchor-link heading3"><div>3.3 使用ACK号确认网络包收到</div></a></li><li class="anchor"><a href="/cs-basic/network/how-is-the-network-connected/2/#_3-4-根据网络包平均往返时间调整ack号等待时间" class="anchor-link heading3"><div>3.4 根据网络包平均往返时间调整ACK号等待时间</div></a></li><li class="anchor"><a href="/cs-basic/network/how-is-the-network-connected/2/#_3-5-使用窗口有效管理ack号" class="anchor-link heading3"><div>3.5 使用窗口有效管理ACK号</div></a></li><li class="anchor"><a href="/cs-basic/network/how-is-the-network-connected/2/#_3-6-ack与窗口的合并" class="anchor-link heading3"><div>3.6 ACK与窗口的合并</div></a></li><li class="anchor"><a href="/cs-basic/network/how-is-the-network-connected/2/#_3-7-接收http响应消息" class="anchor-link heading3"><div>3.7 接收HTTP响应消息</div></a></li><li class="anchor"><a href="/cs-basic/network/how-is-the-network-connected/2/#四、从服务器断开并删除套接字" class="anchor-link heading2"><div>四、从服务器断开并删除套接字</div></a></li><li class="anchor"><a href="/cs-basic/network/how-is-the-network-connected/2/#_4-1-断开连接" class="anchor-link heading3"><div>4.1 断开连接</div></a></li><li class="anchor"><a href="/cs-basic/network/how-is-the-network-connected/2/#_4-2-删除套接字" class="anchor-link heading3"><div>4.2 删除套接字</div></a></li><li class="anchor"><a href="/cs-basic/network/how-is-the-network-connected/2/#_4-3-数据收发小结" class="anchor-link heading3"><div>4.3 数据收发小结</div></a></li><li class="anchor"><a href="/cs-basic/network/how-is-the-network-connected/2/#五、ip-与以太网的包的收发操作" class="anchor-link heading2"><div>五、IP 与以太网的包的收发操作</div></a></li><li class="anchor"><a href="/cs-basic/network/how-is-the-network-connected/2/#_5-1-包的基本知识" class="anchor-link heading3"><div>5.1 包的基本知识</div></a></li><li class="anchor"><a href="/cs-basic/network/how-is-the-network-connected/2/#_5-2-包收发操作概览" class="anchor-link heading3"><div>5.2 包收发操作概览</div></a></li><li class="anchor"><a href="/cs-basic/network/how-is-the-network-connected/2/#_5-3-ip头部" class="anchor-link heading3"><div>5.3 IP头部</div></a></li><li class="anchor"><a href="/cs-basic/network/how-is-the-network-connected/2/#_5-4-mac头部" class="anchor-link heading3"><div>5.4 MAC头部</div></a></li><li class="anchor"><a href="/cs-basic/network/how-is-the-network-connected/2/#_5-5-arp查询目标路由器的mac地址" class="anchor-link heading3"><div>5.5 ARP查询目标路由器的MAC地址</div></a></li><li class="anchor"><a href="/cs-basic/network/how-is-the-network-connected/2/#_5-6-以太网基本知识" class="anchor-link heading3"><div>5.6 以太网基本知识</div></a></li><li class="anchor"><a href="/cs-basic/network/how-is-the-network-connected/2/#_5-7-发送光电信号" class="anchor-link heading3"><div>5.7 发送光电信号</div></a></li><li class="anchor"><a href="/cs-basic/network/how-is-the-network-connected/2/#_5-8-给网络包添加控制数据" class="anchor-link heading3"><div>5.8 给网络包添加控制数据</div></a></li><li class="anchor"><a href="/cs-basic/network/how-is-the-network-connected/2/#_5-9-向集线器发送网络包" class="anchor-link heading3"><div>5.9 向集线器发送网络包</div></a></li><li class="anchor"><a href="/cs-basic/network/how-is-the-network-connected/2/#_5-10-接受返回包" class="anchor-link heading3"><div>5.10 接受返回包</div></a></li><li class="anchor"><a href="/cs-basic/network/how-is-the-network-connected/2/#_5-11-将服务器的响应包从ip传递给tcp" class="anchor-link heading3"><div>5.11 将服务器的响应包从IP传递给TCP</div></a></li><li class="anchor"><a href="/cs-basic/network/how-is-the-network-connected/2/#六、udp-协议的收发操作" class="anchor-link heading2"><div>六、UDP 协议的收发操作</div></a></li><li class="anchor"><a href="/cs-basic/network/how-is-the-network-connected/2/#_6-1-不需要重发的数据用-udp-更高效" class="anchor-link heading3"><div>6.1 不需要重发的数据用 UDP 更高效</div></a></li><li class="anchor"><a href="/cs-basic/network/how-is-the-network-connected/2/#_6-2-控制用的短数据" class="anchor-link heading3"><div>6.2 控制用的短数据</div></a></li><li class="anchor"><a href="/cs-basic/network/how-is-the-network-connected/2/#_6-3-音频和视频数据" class="anchor-link heading3"><div>6.3 音频和视频数据</div></a></li><li class="anchor"><a href="/cs-basic/network/how-is-the-network-connected/2/#七、本章回顾" class="anchor-link heading2"><div>七、本章回顾</div></a></li></ul></div></aside></div> <!----> <div class="content__content-top"></div> <div class="theme-default-content content__default"><div class="custom-block warning"><p class="custom-block-title">转载声明</p> <ul><li>《网络是怎样连接的》</li> <li><a href="https://www.cnblogs.com/jiangzhaowei/p/9273854.html" target="_blank" rel="noopener noreferrer">TCP 、UDP、IP包的最大长度 - 江召伟<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div> <h2 id="零、前情提要"><a href="#零、前情提要" class="header-anchor">#</a> 零、前情提要</h2> <ol><li>创建套接字。</li> <li>连接服务器。</li> <li>收发数据。</li> <li>断开连接并删除套接字。</li> <li>IP与以太网的包收发操作。</li> <li>用UDP协议收发数据的操作。</li></ol> <p><img src="/assets/img/image-20211226140619512.305afd52.png" alt="image-20211226140619512" loading="lazy"></p> <h2 id="一、创建套接字"><a href="#一、创建套接字" class="header-anchor">#</a> 一、创建套接字</h2> <h3 id="_1-1-协议栈的内部结构"><a href="#_1-1-协议栈的内部结构" class="header-anchor">#</a> 1.1 协议栈的内部结构</h3> <p><img src="/assets/img/image-20211226140825219.c78a9352.png" alt="image-20211226140825219" loading="lazy"></p> <blockquote><p>浏览器、邮件等<strong>一般应用程序收发数据时用TCP</strong>；</p> <p><strong>DNS查询等收发较短的控制数据时用UDP</strong>。</p></blockquote> <blockquote><p><strong>ICMP用于告知网络包传送过程中产生的错误以及各种控制消息</strong>；</p> <p><strong>ARP用于根据IP地址查询相应的以太网MAC地址</strong>。</p></blockquote> <h3 id="_1-2-套接字的实体就是通信控制信息"><a href="#_1-2-套接字的实体就是通信控制信息" class="header-anchor">#</a> 1.2 套接字的实体就是通信控制信息</h3> <blockquote><p>协议栈是根据套接字中记录的控制信息来工作的。</p></blockquote> <p><img src="/assets/img/image-20211226141825503.01ff5e92.png" alt="image-20211226141825503" loading="lazy"></p> <p><img src="/assets/img/image-20211226141937848.54166f19.png" alt="image-20211226141937848" loading="lazy"></p> <h3 id="_1-3-调用-socket-时的操作"><a href="#_1-3-调用-socket-时的操作" class="header-anchor">#</a> 1.3 调用 socket 时的操作</h3> <blockquote><p>创建套接字时，首先分配一个套接字所需的内存空间，让后向其中写入初始状态。</p></blockquote> <p><img src="/assets/img/image-20211226142213413.4094a08c.png" alt="image-20211226142213413" loading="lazy"></p> <h2 id="二、连接服务器"><a href="#二、连接服务器" class="header-anchor">#</a> 二、连接服务器</h2> <h3 id="_2-1-连接"><a href="#_2-1-连接" class="header-anchor">#</a> 2.1 连接</h3> <blockquote><p>连接实际上是通信双方交换控制信息，在套接字中记录一些必要信息并准备数据收发的一连串操作。</p></blockquote> <ul><li>把服务器的IP地址和端口号等信息告知协议栈</li> <li>客户端向服务器传达开始通信的请求</li> <li>开辟一个空间作为缓冲区</li></ul> <h3 id="_2-2-负责保存控制信息的头部"><a href="#_2-2-负责保存控制信息的头部" class="header-anchor">#</a> 2.2 负责保存控制信息的头部</h3> <p>通信操作中使用的控制信息分为两类：</p> <ul><li>头部中记录的信息</li> <li>套接字中记录的信息</li></ul> <p><img src="/assets/img/image-20220225172706601.feef806e.png" alt="image-20220225172706601" loading="lazy"><img src="/assets/img/image-20211227214507743.b05cfbbc.png" alt="image-20211227214507743" loading="lazy"></p> <h3 id="_2-3-连接操作的实际过程"><a href="#_2-3-连接操作的实际过程" class="header-anchor">#</a> 2.3 连接操作的实际过程</h3> <ul><li>在TCP模块处创建表示连接控制信息的头部</li> <li>通过TCP头部中的发送方和接收方端口号可以找到要连接的套接字
<ul><li>TCP模块将信息发送给IP模块并委托它进行发送</li> <li>IP模块执行网络包发送到达服务器</li> <li>服务器上的IP模块将接收的信息传递给TCP模块</li> <li>服务器上的TCP模块根据TCP头部中的信息找到端口号对应的套接字</li> <li>在套接字中写入相应信息，修改状态为正在连接，并向客户端返回响应</li></ul></li> <li>客户端接收到服务器的套接字信息，向服务器再次发回消息表示接收成功</li></ul> <h2 id="三、收发数据"><a href="#三、收发数据" class="header-anchor">#</a> 三、收发数据</h2> <h3 id="_3-1-将-http-请求交给协议栈"><a href="#_3-1-将-http-请求交给协议栈" class="header-anchor">#</a> 3.1 将 HTTP 请求交给协议栈</h3> <p>协议栈接收到数据后，先将数据存到内部的发送缓冲区。根据以下两个维度的判断，再将HTTP请求发送出去：</p> <ul><li>当从应用程序收到的数据长度超过或接近MSS时再发送出去，可以避免发送大量小包的问题。
<ul><li><strong>MTU</strong>：一个网络包的最大长度，一般是1500字节</li> <li><strong>MSS</strong>：除去头部之后，一个网络包所能容纳的TCP数据的最大长度</li></ul></li> <li>协议栈内部有一个计时器，当经过一定时间以后，就会把网络包发送出去。</li></ul> <blockquote><p>应用程序在发送数据时可以指定一些选项，比如指定【不等待填满缓冲区直接发送】，协议栈就会按照要求直接发送。</p></blockquote> <div class="custom-block note"><p class="custom-block-title">Note</p> <ol><li>在链路层，由以太网的物理特性决定了数据帧的长度为(46＋18)－(1500＋18)，其中的18是数据帧的头和尾，也就是说数据帧的内容最大为1500(不包括帧头和帧尾)，即MTU(Maximum Transmission Unit)为1500；</li> <li>在网络层，因为IP包的首部要占用20字节，所以这的MTU为1500－20＝1480</li> <li>在传输层，对于UDP包的首部要占用8字节，所以这的MTU为1480－8＝1472；</li></ol> <p>UDP 包的大小就应该是 1500 - IP头(20) - UDP头(8) = 1472(Bytes)</p> <p>TCP 包的大小就应该是 1500 - IP头(20) - TCP头(20) = 1460 (Bytes)</p></div> <h3 id="_3-2-对较大数据进行拆分"><a href="#_3-2-对较大数据进行拆分" class="header-anchor">#</a> 3.2 对较大数据进行拆分</h3> <p>当一个HTTP请求的长度，超过了网络包的最大长度，就需要对该请求进行拆分。</p> <p><img src="/assets/img/image-20211228205521676.f2bfd811.png" alt="image-20211228205521676" loading="lazy"></p> <h3 id="_3-3-使用ack号确认网络包收到"><a href="#_3-3-使用ack号确认网络包收到" class="header-anchor">#</a> 3.3 使用ACK号确认网络包收到</h3> <ul><li>发送方：从第xxx字节开始，共有xxx字节</li> <li>接收方：收到到第xxx字节之前的全部数据</li></ul> <p><img src="/assets/img/image-20211229180218040.d6c1fb60.png" alt="" loading="lazy"></p> <p><img src="/assets/img/image-20211229181203165.9169537b.png" alt="image-20211229181203165" loading="lazy"><img src="/assets/img/image-20211229181227356.7bcec390.png" alt="image-20211229181227356" loading="lazy"></p> <blockquote><p>在得到对方的确认之前，发送过的包会保存在发送缓存区。如果对方一直没有返回某些包的ACK号，就会重新发送这些包。</p></blockquote> <h3 id="_3-4-根据网络包平均往返时间调整ack号等待时间"><a href="#_3-4-根据网络包平均往返时间调整ack号等待时间" class="header-anchor">#</a> 3.4 根据网络包平均往返时间调整ACK号等待时间</h3> <p>TCP会在发送数据的过程中持续测量ACK号的返回时间，如果ACK号返回变慢，则相应延长等待时间；如果ACK号马上就能返回，则相应缩短等待时间。</p> <h3 id="_3-5-使用窗口有效管理ack号"><a href="#_3-5-使用窗口有效管理ack号" class="header-anchor">#</a> 3.5 使用窗口有效管理ACK号</h3> <blockquote><p>滑动窗口：在发送一个包之后，不等待ACK号返回，直接发送后续的一系列包。</p> <p>接收方需要告诉发送方自己最多能接收多少数据，然后发送方根据这个值对数据发送操作进行控制，这就是滑动窗口的基本思路。</p></blockquote> <p><img src="/assets/img/image-20211229190220706.916cae8c.png" alt="image-20211229190220706" loading="lazy"></p> <p>如果不等待ACK号返回一直自顾自地持续发送，就可能出现发送包的频率超过接收方的处理能力的情况。</p> <p>接收方收到包之后会保存在接收缓冲区中，计算ACK号并返回给发送方，还要将数据传递给应用程序。如果这些操作还未完成，就有新的数据包到达，都会暂存早接收缓冲区中。但是当接收缓冲区中已经存满，再发送数据包也不可能存的下，这时候发送方的发送频率就超出了接收方的处理能力。</p> <p>因此接收方会实现告知发送方自己的处理能力（接收缓冲区的大小），发送方会根据已发送的数据包、接收方的缓冲区计算，判断是否还可以继续发送数据。</p> <p><img src="/assets/img/image-20211229190610804.8129f88b.png" alt="image-20211229190610804" loading="lazy"></p> <h3 id="_3-6-ack与窗口的合并"><a href="#_3-6-ack与窗口的合并" class="header-anchor">#</a> 3.6 ACK与窗口的合并</h3> <p><strong>问题描述：</strong></p> <p>当接收方接收到一个数据包，计算好ACK号返回给发送方。假设接收方的接收缓冲区中就只够保存一个数据包，返回了ACK号并不代表他可以继续接收新的数据包。因为还需要将这个数据传递给应用程序，到这个时候才可以从缓冲区将数据包删除，腾出空间来接收新的数据包。</p> <p>从这个角度出发，接收方收到一个数据包，分别要返回一个ACK号和更新窗口的信息。如果是这样的话，要返回的包就太多了，会导致网络效率的下降。</p> <p><strong>解决：</strong></p> <p>接收方计算好ACK号时、窗口更新时，不会马上把包发送出去。</p> <p>而是等ACK号和窗口更新，或者多个ACK号一起合并发送，以此来减少包的数量。</p> <h3 id="_3-7-接收http响应消息"><a href="#_3-7-接收http响应消息" class="header-anchor">#</a> 3.7 接收HTTP响应消息</h3> <p><img src="/assets/img/image-20211229200045483.cc0d2e82.png" alt="image-20211229200045483" loading="lazy"></p> <h2 id="四、从服务器断开并删除套接字"><a href="#四、从服务器断开并删除套接字" class="header-anchor">#</a> 四、从服务器断开并删除套接字</h2> <h3 id="_4-1-断开连接"><a href="#_4-1-断开连接" class="header-anchor">#</a> 4.1 断开连接</h3> <blockquote><ul><li>协议栈在设计上允许<strong>任何一方</strong>（客户端/服务器端）先发起断开过程</li> <li>无论哪种，完成数据发送的一方都会发起断开过程。（无非谁先谁后而已）</li></ul></blockquote> <p>eg：</p> <ul><li>服务器端先断开连接：
<ul><li>调用 Socket 库中的 close</li> <li>生成一个包含断开信息的 TCP 头部，控制位中 <strong>FIN</strong> 比特位为1</li> <li>协议栈委托 IP 模块向客户端发送数据</li> <li>套接字中记录断开操作的信息</li></ul></li> <li>客户端接收断开信息：
<ul><li>收到服务器发来的 <strong>FIN</strong> 为1的 TCP 头部</li> <li>协议栈将套接字标记为断开操作状态</li> <li>向服务器返回一个 <strong>ACK</strong> 号</li></ul></li> <li>客户端断开连接：
<ul><li>执行和服务器相同的操作</li> <li>服务器也向客户端返回一个 <strong>ACK</strong> 号</li></ul></li></ul> <p><img src="/assets/img/image-20220107205801563.8f9dd923.png" alt="image-20220107205801563" loading="lazy"></p> <h3 id="_4-2-删除套接字"><a href="#_4-2-删除套接字" class="header-anchor">#</a> 4.2 删除套接字</h3> <div class="custom-block tip"><p class="custom-block-title">通信结束以后，会等待一段时间再删除套接字</p></div> <p>服务器完成数据发送，向客户端发送 <code>FIN</code>，客户端向服务器返回 <code>ACK</code> 号。但这时如果 <code>ACK</code> 号丢失了，那么服务器将重新发送一次 <code>FIN</code>。而客户端没有等待就套接字删除了。</p> <p>再假设，这个时候客户端中的应用程序需要创建套接字，新套接字碰巧被分配到了同一个端口号，而这个时候服务器发送的 <code>FIN</code> 正好到达，那这个新的套接字就会被误删。</p> <h3 id="_4-3-数据收发小结"><a href="#_4-3-数据收发小结" class="header-anchor">#</a> 4.3 数据收发小结</h3> <p><img src="/assets/img/image-20220107214550624.1f1680c8.png" alt="image-20220107214550624" loading="lazy"></p> <h2 id="五、ip-与以太网的包的收发操作"><a href="#五、ip-与以太网的包的收发操作" class="header-anchor">#</a> 五、IP 与以太网的包的收发操作</h2> <h3 id="_5-1-包的基本知识"><a href="#_5-1-包的基本知识" class="header-anchor">#</a> 5.1 包的基本知识</h3> <p><img src="/assets/img/image-20220108091227641.3b9b3019.png" alt="image-20220108091227641" loading="lazy"></p> <p>数据收发过程中的双方，在不同时刻可能互为接收方和发送方，因此统称为 <strong>终端节点</strong></p> <p>数据包会经过一个个的网络转发设备，最后到达接收方。</p> <ul><li>发送方将接收方的IP地址写入IP头部</li> <li>IP协议根据这一IP地址查找包的传输方向，从而确定下一个路由器的位置</li> <li><strong>IP协议查出下一个路由器的以太网地址（MAC地址）</strong>，并将地址写入MAC头部</li> <li>IP协议委托以太网协议将包传输</li></ul> <blockquote><ul><li>路由器根据目标地址判断下一个路由器的位置 —— IP协议</li> <li>集线器在子网中将网络包传输到下一个路由 —— 以太网协议</li></ul></blockquote> <p><img src="/assets/img/image-20220108093602850.1b37e383.png" alt="image-20220108093602850" loading="lazy"></p> <h3 id="_5-2-包收发操作概览"><a href="#_5-2-包收发操作概览" class="header-anchor">#</a> 5.2 包收发操作概览</h3> <ol><li>TCP模块委托IP模块发送包：
<ul><li>TCP模块在数据块前面加上TCP头部</li> <li><strong>指定通信对象的IP地址</strong></li> <li>整个传递给IP模块</li></ul></li> <li>IP模块封装数据包：
<ul><li><strong>IP模块会添加IP头部和MAC头部</strong></li> <li>转交给网络硬件</li></ul></li> <li>网络包在网卡间传递</li> <li>接收方接收网络包：
<ul><li>网卡将包转化为数字信息传递给IP模块</li> <li>IP模块解除IP头部和MAC头部，将TCP头部和数据块传递给TCP模块</li> <li>TCP模块处理数据</li></ul></li></ol> <p><img src="/assets/img/image-20220108105125589.9e848d6d.png" alt="image-20220108105125589" loading="lazy"></p> <blockquote><p><strong>IP模块的职责就是将委托的东西打包送到对方手里。不关心TCP头部和数据内容，也不关心TCP的操作。</strong></p></blockquote> <h3 id="_5-3-ip头部"><a href="#_5-3-ip头部" class="header-anchor">#</a> 5.3 IP头部</h3> <p><img src="/assets/img/image-20220108124243007.ad847b50.png" alt="" loading="lazy"></p> <p><img src="/assets/img/image-20220108124706189.2f88d680.png" alt="image-20220108124706189" loading="lazy"></p> <h3 id="_5-4-mac头部"><a href="#_5-4-mac头部" class="header-anchor">#</a> 5.4 MAC头部</h3> <p>IP模块根据路由表 Gateway 栏的内容判断应该把包发送给谁。</p> <p>再根据IP地址查询MAC地址</p> <p><img src="/assets/img/image-20220108161553247.7ba5f307.png" alt="image-20220108161553247" loading="lazy"></p> <h3 id="_5-5-arp查询目标路由器的mac地址"><a href="#_5-5-arp查询目标路由器的mac地址" class="header-anchor">#</a> 5.5 ARP查询目标路由器的MAC地址</h3> <ul><li>ARP利用广播对所有设备问 <code>XX这个IP地址是谁的，请把你的MAC地址告诉我</code>，然后等待目标路由器将MAC地址返回</li></ul> <p><img src="/assets/img/image-20220108162056855.40597e99.png" alt="image-20220108162056855" loading="lazy"></p> <ul><li>ARP缓存</li></ul> <p><img src="/assets/img/image-20220108163905777.bf01747d.png" alt="image-20220108163905777" loading="lazy"></p> <ul><li>MAC地址</li></ul> <p><img src="/assets/img/image-20220108163921704.17a43b18.png" alt="image-20220108163921704" loading="lazy"></p> <ul><li>ARP缓存过几分钟就会将原记录删除，以防因为IP地址的改变而导致通信异常</li></ul> <h3 id="_5-6-以太网基本知识"><a href="#_5-6-以太网基本知识" class="header-anchor">#</a> 5.6 以太网基本知识</h3> <p><img src="/assets/img/image-20220108164652863.04477f4c.png" alt="" loading="lazy"></p> <h3 id="_5-7-发送光电信号"><a href="#_5-7-发送光电信号" class="header-anchor">#</a> 5.7 发送光电信号</h3> <blockquote><p>网卡的ROM中保存着全世界唯一的MAC地址，这是在生产网卡时写入的</p> <p>网卡中保存的MAC地址会由网卡驱动程序读取并分配给MAC模块</p></blockquote> <p><img src="/assets/img/image-20220108165951786.640c02f3.png" alt="image-20220108165951786" loading="lazy"></p> <h3 id="_5-8-给网络包添加控制数据"><a href="#_5-8-给网络包添加控制数据" class="header-anchor">#</a> 5.8 给网络包添加控制数据</h3> <blockquote><p>MAC模块将网络包从缓存中取出，并在开头加上 <strong>报头</strong> 和 <strong>起始帧分节符</strong>，在末尾加上 <strong>帧校验序列(FCS)</strong></p></blockquote> <p><img src="/assets/img/image-20220109091031789.b0c60761.png" alt="image-20220109091031789" loading="lazy"></p> <ul><li>用电信号来表达数字信息，让0和1分别对应特定的电压和电流
<ul><li><strong>数据信号如果出现连续的1或0，由于电流和电压没有变化，我们没办法判断其中每个比特从哪里切分</strong></li></ul></li> <li>再发送一组用来区分比特间隔的时钟信号
<ul><li><strong>当距离较远、网线较长时，两条线路的长度可能会发生差异，数据信号和时钟信号的传输会产生时间差，时钟就会偏移</strong></li></ul></li> <li>将数据信号和时钟信号叠加在一起
<ul><li><strong>由于时钟信号是按固定频率变化的，只要找到这个变化的周期就能从中提取出时钟信号，进而计算出数据信号</strong></li></ul></li></ul> <p><img src="/assets/img/image-20220109091740442.9bc7a39b.png" alt="image-20220109091740442" loading="lazy"></p> <h3 id="_5-9-向集线器发送网络包"><a href="#_5-9-向集线器发送网络包" class="header-anchor">#</a> 5.9 向集线器发送网络包</h3> <blockquote><p>发送信号的两种操作：使用集线器的<strong>半双工模式</strong>、使用交换机的<strong>全双工模式</strong></p></blockquote> <p>​	半双工模式中，需要先判断网线中是否存在其他设备发送的信号。如果有，需要等待信号传输完毕才能发送，否则两组信号会发生碰撞。</p> <ol><li><p><strong>MAC 模块将数字信号按每个比特转换成电信号</strong></p></li> <li><p><strong>PHY（MAU）模块将该信号进行格式转换</strong>并通过网线发送出去、监控接受线路中有无信号进来</p></li></ol> <blockquote><p>协议栈的TCP会负责搞定可能发生的错误，因此发送信号是没有必要检查错误</p></blockquote> <h3 id="_5-10-接受返回包"><a href="#_5-10-接受返回包" class="header-anchor">#</a> 5.10 接受返回包</h3> <p><strong>接受步骤：</strong></p> <ol><li>把通过接受线路的所有信号都接收进来</li> <li>PHY（MAU）模块将信号转换成通用格式并发送给 MAC 模块</li> <li>MAC 模块从头开始将信号转换成数字信息，并存放到缓冲区</li> <li>检查 FCS 和 MAC 地址，将数据受污染和地址不一致的包直接丢弃</li> <li>网卡通过 <strong>中断机制</strong> 通知计算机收到一个包
<ol><li>网卡向扩展总线中的中断信号发送信号</li> <li>该信号通过中断控制器连接到CPU</li> <li>CPU暂时挂起正在处理的任务，切换到中断处理程序</li> <li>中断处理程序调用网卡驱动</li> <li>网卡执行接收操作</li></ol></li> <li>网卡根据包中不同协议类型，将包发送给不同的栈</li></ol> <h3 id="_5-11-将服务器的响应包从ip传递给tcp"><a href="#_5-11-将服务器的响应包从ip传递给tcp" class="header-anchor">#</a> 5.11 将服务器的响应包从IP传递给TCP</h3> <p><strong>IP模块的任务：</strong></p> <ol><li>检查IP头部，确认格式是否正确</li> <li>查看接收方IP地址，如果有误通过ICMP消息告知对方</li> <li>分片重组：如果原始的包被分成了多个小包，需要将他们还原成原始的包</li></ol> <p><img src="/assets/img/image-20220111144946393.713a2366.png" alt="image-20220111144946393" loading="lazy"></p> <p><strong>TCP模块的任务：</strong></p> <ol><li>找到对应套接字，根据通信记录执行操作：
<ul><li>如果包的内容是应用程序数据，则返回确认接收的包，并将数据放入缓冲区，等待应用程序来读取</li> <li>如果是建立或断开连接的控制包，则返回相应的响应控制包，并告知应用程序建立或断开连接的操作状态</li></ul></li></ol> <h2 id="六、udp-协议的收发操作"><a href="#六、udp-协议的收发操作" class="header-anchor">#</a> 六、UDP 协议的收发操作</h2> <h3 id="_6-1-不需要重发的数据用-udp-更高效"><a href="#_6-1-不需要重发的数据用-udp-更高效" class="header-anchor">#</a> 6.1 不需要重发的数据用 UDP 更高效</h3> <blockquote><p>TCP为了实现可靠性和高效传输，需要将数据分片发送，并将对方未接收的数据包重新发送。</p></blockquote> <h3 id="_6-2-控制用的短数据"><a href="#_6-2-控制用的短数据" class="header-anchor">#</a> 6.2 控制用的短数据</h3> <p>像DNS查询等交换控制信息的操作基本上都可以在一个包的大小范围内解决，这种场景既可以用UDP来代替TCP</p> <blockquote><p>UDP只负责发送包，不管任何可能出现的错误</p></blockquote> <p><img src="/assets/img/image-20220111153930637.438d4e4b.png" alt="image-20220111153930637" loading="lazy"></p> <h3 id="_6-3-音频和视频数据"><a href="#_6-3-音频和视频数据" class="header-anchor">#</a> 6.3 音频和视频数据</h3> <p>音频和视频数据必须在规定时间内送达，（一旦错过播放时间，重发数据也没用）因此无需重发数据。这种情况下使用UDP发送数据的效率更高</p> <h2 id="七、本章回顾"><a href="#七、本章回顾" class="header-anchor">#</a> 七、本章回顾</h2> <ul><li>表示网络包收件人的接收方IP地址是位于IP头部还是TCP头部？</li></ul> <blockquote><p>**IP头部。**接收方IP地址最初从应用程序获得， 经由TCP模块告知IP模块</p></blockquote> <ul><li>端口号所用来指定服务器程序的种类，那么他位于TCP头部还是IP头部？</li></ul> <blockquote><p>**TCP头部。**连接操作的第一步是在TCP模块处创建表示连接控制信息的头部。通过TCP头部中的发送方和接收方端口号可以找到要连接的套接字。</p></blockquote> <ul><li>会对包是否正确送达进行确认的是TCP还是IP呢？</li></ul> <blockquote><p>TCP</p></blockquote> <ul><li>根据IP地址查询MAC地址的机制叫什么？</li></ul> <blockquote><p>ARP</p> <p>在以太网中，有一种叫作广播的方法，可以把包发给连接在同一以太网中的所有设备。ARP就是利用广播对所有设备提问：“××这个IP地址是谁的？请把你的MAC地址告诉我。”然后就会有人回答：“这个IP地址是我的，我的MAC地址是××××。”</p></blockquote> <ul><li>在收到ACK号之前继续发送下一个包的方式叫什么？</li></ul> <blockquote><p>滑动窗口方式</p></blockquote></div> <!----> <div class="content__content-bottom"></div> <footer class="page-meta"><div class="edit-link"><svg viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" class="icon edit-icon"><path d="M117.953 696.992 64.306 959.696l265.931-49.336 450.204-452.505-212.284-213.376-450.204 452.513zm496.384-296.326L219.039 797.993l-46.108-46.34L568.233 354.33l46.104 46.335zm345.357-122.99-114.45 115.04-212.288-213.377 114.45-115.035 212.288 213.371zm0 0" fill="currentColor"></path></svg> <a href="https://github.com/lllllan-fv/notes/edit/main/cs-basic/network/how-is-the-network-connected/2/README.md" target="_blank" rel="noopener noreferrer">Edit this page</a></div> <div class="meta-item update-time"><span class="label">Last update:</span> <span class="info">2022年4月7日 13:59</span></div> <div class="meta-item contributors"><span class="label">Contributors: </span> <span class="info"><span title="email: 342310798@qq.com" class="contributor">
          lllllan
        </span> <!----></span></div></footer> <div class="page-nav"><p class="inner"><span class="prev"><a href="/cs-basic/network/how-is-the-network-connected/1/" class="prev"><svg viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" class="icon prev-icon"><path d="M906.783 588.79c-.02 8.499-6.882 15.36-15.38 15.37l-443.7-.01 75.704 191.682c2.52 6.42.482 13.763-5.038 17.91-5.52 4.168-13.138 4.147-18.616-.092L123.228 524.175a15.362 15.362 0 0 1-6-12.165c0-4.782 2.222-9.277 6-12.185L499.753 210.35a15.388 15.388 0 0 1 9.38-3.195c3.236 0 6.502 1.034 9.236 3.103 5.52 4.147 7.578 11.49 5.038 17.91L447.683 419.84l443.72-.01c8.498.01 15.36 6.881 15.36 15.36l.02 153.6z" fill="currentColor"></path></svg>
        第一章、浏览器生成消息
      </a></span> <span class="next"><a href="/cs-basic/network/how-is-the-network-connected/3/">
        第三章、从网线到网络设备
        <svg viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" class="icon next-icon"><path d="M906.772 512c0 4.772-2.211 9.267-5.99 12.175L524.257 813.66a15.37 15.37 0 0 1-18.616.092 15.368 15.368 0 0 1-5.038-17.91l75.714-191.672h-443.73c-8.488 0-15.36-6.881-15.36-15.36v-153.6c0-8.489 6.872-15.36 15.36-15.36h443.73l-75.714-191.682a15.358 15.358 0 0 1 5.048-17.91c5.51-4.158 13.128-4.137 18.606.092l376.525 289.485a15.323 15.323 0 0 1 5.99 12.165z" fill="currentColor"></path></svg></a></span></p></div> <!----> <!----> <div class="content__page-bottom"></div></main> <footer class="footer-wrapper"><!----> <div class="footer"><a href="https://beian.miit.gov.cn/" target="_blank">粤ICP备2021095794号</a></div> <div class="copyright">Copyright © 2022 lllllan</div></footer></div><div class="global-ui"><!----><!----><div id="pwa-install"><!----> <div id="install-modal-wrapper" style="display:none;"><div class="background"></div> <div class="install-modal"><div class="header"><button aria-label="Close" class="close-button"><svg width="23" height="22" xmlns="http://www.w3.org/2000/svg" class="icon close-icon"><path fill-rule="evenodd" clip-rule="evenodd" d="M1.12.358a1.224 1.224 0 011.729 0l8.92 8.914L20.686.358a1.224 1.224 0 011.73 1.728L13.497 11l8.92 8.913a1.222 1.222 0 11-1.73 1.729l-8.919-8.913-8.92 8.913a1.224 1.224 0 01-1.729-1.729L10.04 11l-8.92-8.914a1.222 1.222 0 010-1.728z" fill="currentColor"></path></svg></button> <div class="logo"><!----> <div class="title"><h1></h1> <p class="desc">This app can be installed on your PC or mobile device.  This will allow this web app to look and behave like any other installed app.  You will find it in your app lists and be able to pin it to your home screen, start menus or task bars.  This installed web app will also be able to safely interact with other apps and your operating system. </p></div></div></div> <div class="content"><div class="highlight"><!----> <!----></div> <div class="description"><h3>Description</h3> <p></p></div></div> <div class="button-wrapper"><button class="install-button">
        Install <span></span></button> <button class="cancel-button">
        Cancel
      </button></div></div></div></div><div tabindex="-1" role="dialog" aria-hidden="true" class="pswp"><div class="pswp__bg"></div> <div class="pswp__scroll-wrap"><div class="pswp__container"><div class="pswp__item"></div> <div class="pswp__item"></div> <div class="pswp__item"></div></div> <div class="pswp__ui pswp__ui--hidden"><div class="pswp__top-bar"><div class="pswp__counter"></div> <button title="Close" aria-label="Close" class="pswp__button pswp__button--close"></button> <button title="Share" aria-label="Share" class="pswp__button pswp__button--share"></button> <button title="Switch to full screen" aria-label="Switch to full screen" class="pswp__button pswp__button--fs"></button> <button title="Zoom in/out" aria-label="Zoom in/out" class="pswp__button pswp__button--zoom"></button> <div class="pswp__preloader"><div class="pswp__preloader__icn"><div class="pswp__preloader__cut"><div class="pswp__preloader__donut"></div></div></div></div></div> <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap"><div class="pswp__share-tooltip"></div></div> <button title="Prev (Arrow Left)" aria-label="Prev (Arrow Left)" class="pswp__button pswp__button--arrow--left"></button> <button title="Next (Arrow Right)" aria-label="Next (Arrow Right)" class="pswp__button pswp__button--arrow--right"></button> <div class="pswp__caption"><div class="pswp__caption__center"></div></div></div></div></div></div></div>
    <script src="/assets/js/app.3cfaf037.js" defer></script><script src="/assets/js/vendors~layout-Layout.57f7cf63.js" defer></script><script src="/assets/js/vendors~layout-Blog~layout-Layout~layout-NotFound.b5e5e957.js" defer></script><script src="/assets/js/page-第二章、用电信号传输TCPIP数据.6ca26d3f.js" defer></script><script src="/assets/js/vendors~layout-Blog~layout-Layout.3d94df6c.js" defer></script>
  </body>
</html>
