<!DOCTYPE html>
<html lang="zh">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>java 内存区域详解 | lllllan</title>
    <meta name="generator" content="VuePress 1.9.7">
    <script src="https://cdn.jsdelivr.net/npm/react/umd/react.production.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/react-dom/umd/react-dom.production.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/vue/dist/vue.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@babel/standalone/babel.min.js"></script>
    <link rel="alternate" type="application/atom+xml" href="https://vue-blog.lllllan.cn/atom.xml" title="lllllan Atom Feed">
    <link rel="alternate" type="application/json" href="https://vue-blog.lllllan.cn/feed.json" title="lllllan JSON Feed">
    <link rel="alternate" type="application/rss+xml" href="https://vue-blog.lllllan.cn/rss.xml" title="lllllan RSS Feed">
    <link rel="icon" href="/logo.png">
    <link rel="icon" href="/logo.png" type="image/png" sizes="512x512">
    <link rel="icon" href="/logo.png" type="image/png" sizes="192x192">
    <link rel="icon" href="/logo.png" type="image/png" sizes="512x512">
    <link rel="icon" href="/logo.png" type="image/png" sizes="192x192">
    <link rel="manifest" href="/manifest.webmanifest" crossorigin="use-credentials">
    <link rel="apple-touch-icon" href="/logo.png">
    <meta name="description" content="">
    <meta property="og:url" content="/1-java/2-jvm/1-memory-area-details/">
    <meta property="og:site_name" content="lllllan">
    <meta property="og:title" content="java 内存区域详解">
    <meta property="og:description" content="本文转载自 Java 内存区域详解 | JavaGuide Java 内存区域详解 这部分内容未免有些太过抽象，这次作为 泛读，大概看一眼有一个印象， 一 概述 对于 Java 程序员来说，在虚拟机自动内存管理机制下，不再需要像 C/C++程序开发程序员这样为每一个 new 操作去写对应的 delete/free 操作，不容易出现内存泄漏和内存溢出问题。正是">
    <meta property="og:type" content="article">
    <meta property="og:locale" content="zh">
    <meta property="og:locale:alternate" content="en-US">
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:image:alt" content="lllllan">
    <meta property="article:author" content="lllllan">
    <meta property="article:tag" content="JVM">
    <meta name="theme-color" content="#46bd87">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="msapplication-TileImage" content="/logo.png">
    <meta name="msapplication-TileColor" content="#ffffff">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
    
    <link rel="preload" href="/assets/css/0.styles.fe5e2315.css" as="style"><link rel="preload" href="/assets/js/app.566bcdb2.js" as="script"><link rel="preload" href="/assets/js/vendors~layout-Layout.b7034363.js" as="script"><link rel="preload" href="/assets/js/vendors~layout-Blog~layout-Layout~layout-NotFound.e3241214.js" as="script"><link rel="preload" href="/assets/js/page-java内存区域详解.4067318d.js" as="script"><link rel="prefetch" href="/assets/js/34.9e403830.js"><link rel="prefetch" href="/assets/js/35.34fe3b13.js"><link rel="prefetch" href="/assets/js/36.48ba4a80.js"><link rel="prefetch" href="/assets/js/37.ace73e26.js"><link rel="prefetch" href="/assets/js/38.98d68e96.js"><link rel="prefetch" href="/assets/js/39.47aa2530.js"><link rel="prefetch" href="/assets/js/layout-Blog.a09f0d27.js"><link rel="prefetch" href="/assets/js/layout-Layout.28148f81.js"><link rel="prefetch" href="/assets/js/layout-NotFound.12bb8c6a.js"><link rel="prefetch" href="/assets/js/layout-Slide.5a063677.js"><link rel="prefetch" href="/assets/js/page-ArrayList源码解读.e59c5b16.js"><link rel="prefetch" href="/assets/js/page-JavaGuide-Java基础知识.ad40a81f.js"><link rel="prefetch" href="/assets/js/page-Java垃圾回收.4f92d28e.js"><link rel="prefetch" href="/assets/js/page-Java基础面试题.693f0f55.js"><link rel="prefetch" href="/assets/js/page-Java笔记.34f7bbe4.js"><link rel="prefetch" href="/assets/js/page-Java集合框架基础知识.1ac824c4.js"><link rel="prefetch" href="/assets/js/page-MySQL笔记.0ae89103.js"><link rel="prefetch" href="/assets/js/page-R2Coding-Java基础知识.cf2ae1dc.js"><link rel="prefetch" href="/assets/js/page-java是值传递.19eaaf1d.js"><link rel="prefetch" href="/assets/js/page-代理详解.bba7826b.js"><link rel="prefetch" href="/assets/js/page-刷题笔记.0403bb93.js"><link rel="prefetch" href="/assets/js/page-反射机制.6225e081.js"><link rel="prefetch" href="/assets/js/page-操作系统-常见面试题.b76e452b.js"><link rel="prefetch" href="/assets/js/page-数组练习.b6445262.js"><link rel="prefetch" href="/assets/js/page-第一章、浏览器生成消息.ce4eb7e8.js"><link rel="prefetch" href="/assets/js/page-第三章、从网线到网络设备.ce6de6b0.js"><link rel="prefetch" href="/assets/js/page-第二章、用电信号传输TCPIP数据.d6d29ea6.js"><link rel="prefetch" href="/assets/js/page-计算机基础.59e882db.js"><link rel="prefetch" href="/assets/js/page-计算机网络-常见面试题.ac05f919.js"><link rel="prefetch" href="/assets/js/page-认识JVM.000c5927.js"><link rel="prefetch" href="/assets/js/page-项目主页.355b45d9.js"><link rel="prefetch" href="/assets/js/vendors~flowchart.874b7c55.js"><link rel="prefetch" href="/assets/js/vendors~mermaid.e4365cdb.js"><link rel="prefetch" href="/assets/js/vendors~photo-swipe.99f6c6a2.js"><link rel="prefetch" href="/assets/js/vendors~reveal.f00fc94c.js">
    <link rel="stylesheet" href="/assets/css/0.styles.fe5e2315.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container has-navbar has-sidebar has-anchor"><header class="navbar"><!----> <div class="content__navbar-start"></div> <button title="Sidebar Button" class="sidebar-button"><span class="icon"></span></button> <a href="/" class="home-link router-link-active"><img src="/logo.png" alt="lllllan" class="logo"> <!----> <span class="site-name can-hide">lllllan</span></a> <!----> <div class="content__navbar-center"></div> <div class="links"><button tabindex="-1" aria-hidden="true" class="color-button"><svg viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" class="skin-icon"><path d="M224 800c0 9.6 3.2 44.8 6.4 54.4 6.4 48-48 76.8-48 76.8s80 41.6 147.2 0 134.4-134.4
        38.4-195.2c-22.4-12.8-41.6-19.2-57.6-19.2C259.2 716.8 227.2 761.6 224 800zM560 675.2l-32
        51.2c-51.2 51.2-83.2 32-83.2 32 25.6 67.2 0 112-12.8 128 25.6 6.4 51.2 9.6 80 9.6 54.4 0
        102.4-9.6 150.4-32l0 0c3.2 0 3.2-3.2 3.2-3.2 22.4-16 12.8-35.2
        6.4-44.8-9.6-12.8-12.8-25.6-12.8-41.6 0-54.4 60.8-99.2 137.6-99.2 6.4 0 12.8 0 22.4
        0 12.8 0 38.4 9.6 48-25.6 0-3.2 0-3.2 3.2-6.4 0-3.2 3.2-6.4 3.2-6.4 6.4-16 6.4-16 6.4-19.2
        9.6-35.2 16-73.6 16-115.2 0-105.6-41.6-198.4-108.8-268.8C704 396.8 560 675.2 560 675.2zM224
        419.2c0-28.8 22.4-51.2 51.2-51.2 28.8 0 51.2 22.4 51.2 51.2 0 28.8-22.4 51.2-51.2 51.2C246.4
        470.4 224 448 224 419.2zM320 284.8c0-22.4 19.2-41.6 41.6-41.6 22.4 0 41.6 19.2 41.6 41.6 0
        22.4-19.2 41.6-41.6 41.6C339.2 326.4 320 307.2 320 284.8zM457.6 208c0-12.8 12.8-25.6 25.6-25.6
        12.8 0 25.6 12.8 25.6 25.6 0 12.8-12.8 25.6-25.6 25.6C470.4 233.6 457.6 220.8 457.6 208zM128
        505.6C128 592 153.6 672 201.6 736c28.8-60.8 112-60.8 124.8-60.8-16-51.2 16-99.2
        16-99.2l316.8-422.4c-48-19.2-99.2-32-150.4-32C297.6 118.4 128 291.2 128 505.6zM764.8
        86.4c-22.4 19.2-390.4 518.4-390.4 518.4-22.4 28.8-12.8 76.8 22.4 99.2l9.6 6.4c35.2 22.4
        80 12.8 99.2-25.6 0 0 6.4-12.8 9.6-19.2 54.4-105.6 275.2-524.8 288-553.6
        6.4-19.2-3.2-32-19.2-32C777.6 76.8 771.2 80 764.8 86.4z"></path></svg> <div class="color-picker-menu" style="display:none;"><div class="theme-options"><ul class="themecolor-select"><label for="themecolor-select">Theme Color:</label> <li><span class="default-theme"></span></li> </ul> <div class="darkmode-toggle"><label for="darkmode-toggle" class="desc">Theme Mode:</label> <div class="darkmode-switch"><div class="item day"><svg viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" class="icon light-icon"><path d="M512 256a42.667 42.667 0 0 0 42.667-42.667V128a42.667 42.667 0 0 0-85.334 0v85.333A42.667 42.667 0 0 0 512 256zm384 213.333h-85.333a42.667 42.667 0 0 0 0 85.334H896a42.667 42.667 0 0 0 0-85.334zM256 512a42.667 42.667 0 0 0-42.667-42.667H128a42.667 42.667 0 0 0 0 85.334h85.333A42.667 42.667 0 0 0 256 512zm9.387-298.667a42.667 42.667 0 0 0-59.307 62.72l61.44 59.307a42.667 42.667 0 0 0 31.147 11.947 42.667 42.667 0 0 0 30.72-13.227 42.667 42.667 0 0 0 0-60.16zm459.946 133.974a42.667 42.667 0 0 0 29.44-11.947l61.44-59.307a42.667 42.667 0 0 0-57.6-62.72l-61.44 60.587a42.667 42.667 0 0 0 0 60.16 42.667 42.667 0 0 0 28.16 13.227zM512 768a42.667 42.667 0 0 0-42.667 42.667V896a42.667 42.667 0 0 0 85.334 0v-85.333A42.667 42.667 0 0 0 512 768zm244.48-79.36a42.667 42.667 0 0 0-59.307 61.44l61.44 60.587a42.667 42.667 0 0 0 29.44 11.946 42.667 42.667 0 0 0 30.72-12.8 42.667 42.667 0 0 0 0-60.586zm-488.96 0-61.44 59.307a42.667 42.667 0 0 0 0 60.586 42.667 42.667 0 0 0 30.72 12.8 42.667 42.667 0 0 0 28.587-10.666l61.44-59.307a42.667 42.667 0 0 0-59.307-61.44zM512 341.333A170.667 170.667 0 1 0 682.667 512 170.667 170.667 0 0 0 512 341.333z" fill="currentColor"></path></svg></div> <div class="item auto active"><svg viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" class="icon auto-icon"><path d="M460.864 539.072H564.8L510.592 376l-49.728 163.072zM872 362.368V149.504H659.648L510.528 0l-149.12 149.504H149.12v212.928L0 511.872l149.12 149.504v212.928h212.352l149.12 149.504 149.12-149.504h212.352V661.376l149.12-149.504L872 362.368zM614.464 693.12l-31.616-90.624H438.272l-31.616 90.624h-85.888l144.576-407.68h90.368l144.576 407.68h-85.824zm0 0" fill="currentColor"></path></svg></div> <div class="item night"><svg viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" class="icon dark-icon"><path d="M935.539 630.402c-11.43-11.432-28.674-14.739-43.531-8.354-46.734 20.103-96.363 30.297-147.508 30.297-99.59 0-193.221-38.784-263.64-109.203-108.637-108.637-139.61-270.022-78.908-411.148a39.497 39.497 0 0 0-51.886-51.887c-52.637 22.64-100.017 54.81-140.826 95.616-85.346 85.346-132.346 198.821-132.346 319.52 0 120.7 47.001 234.172 132.347 319.519S408.063 947.11 528.76 947.11c120.7 0 234.172-47.003 319.52-132.351 40.809-40.81 72.978-88.19 95.616-140.826a39.497 39.497 0 0 0-8.356-43.532z" fill="currentColor"></path></svg></div></div> <!----></div></div></div></button> <div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link router-link-active"><i class="iconfont icon-home"></i>
  Blog Home
</a></div></nav> <!----> <a rel="noopener noreferrer" href="https://github.com/lllllan-fv/blog" target="_blank" class="repo-link can-hide">
  GitHub
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> <!----> <div class="content__navbar-end"></div></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><!----> <!----> <div class="content__sidebar-top"></div> <nav class="sidebar-nav-links"><div class="nav-item"><a href="/" class="nav-link router-link-active"><i class="iconfont icon-home"></i>
  Blog Home
</a></div> <a rel="noopener noreferrer" href="https://github.com/lllllan-fv/blog" target="_blank" class="repo-link">
  GitHub
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav> <!----> <div class="content__sidebar-center"></div> <ul class="sidebar-links"><li><a href="/1-java/" aria-current="page" class="sidebar-link"><i class="iconfont icon-info"></i>Java 笔记</a></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading clickable"><!----> <span class="title">java 基础</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading clickable open"><!----> <span class="title">JVM</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/1-java/2-jvm/1-memory-area-details/" aria-current="page" class="active sidebar-link"><i class="iconfont icon-page"></i>java 内存区域详解</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/1-java/2-jvm/1-memory-area-details/#_2-1-程序计数器" class="sidebar-link">2.1 程序计数器</a></li><li class="sidebar-sub-header"><a href="/1-java/2-jvm/1-memory-area-details/#_2-2-java-虚拟机栈" class="sidebar-link">2.2 Java 虚拟机栈</a></li><li class="sidebar-sub-header"><a href="/1-java/2-jvm/1-memory-area-details/#_2-3-本地方法栈" class="sidebar-link">2.3 本地方法栈</a></li><li class="sidebar-sub-header"><a href="/1-java/2-jvm/1-memory-area-details/#_2-4-堆" class="sidebar-link">2.4 堆</a></li><li class="sidebar-sub-header"><a href="/1-java/2-jvm/1-memory-area-details/#_2-5-方法区" class="sidebar-link">2.5 方法区</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/1-java/2-jvm/1-memory-area-details/#_2-5-1-方法区和永久代的关系" class="sidebar-link heading3">2.5.1 方法区和永久代的关系</a></li><li class="sidebar-sub-header"><a href="/1-java/2-jvm/1-memory-area-details/#_2-5-2-常用参数" class="sidebar-link heading3">2.5.2 常用参数</a></li><li class="sidebar-sub-header"><a href="/1-java/2-jvm/1-memory-area-details/#_2-5-3-为什么要将永久代-permgen-替换为元空间-metaspace-呢" class="sidebar-link heading3">2.5.3 为什么要将永久代 (PermGen) 替换为元空间 (MetaSpace) 呢?</a></li></ul></li><li class="sidebar-sub-header"><a href="/1-java/2-jvm/1-memory-area-details/#_2-6-运行时常量池" class="sidebar-link">2.6 运行时常量池</a></li><li class="sidebar-sub-header"><a href="/1-java/2-jvm/1-memory-area-details/#_2-7-直接内存" class="sidebar-link">2.7 直接内存</a></li><li class="sidebar-sub-header"><a href="/1-java/2-jvm/1-memory-area-details/#_3-1-对象的创建" class="sidebar-link">3.1 对象的创建</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/1-java/2-jvm/1-memory-area-details/#_3-1-1-类加载检查" class="sidebar-link heading3">3.1.1 类加载检查</a></li><li class="sidebar-sub-header"><a href="/1-java/2-jvm/1-memory-area-details/#_3-1-2-分配内存" class="sidebar-link heading3">3.1.2 分配内存</a></li><li class="sidebar-sub-header"><a href="/1-java/2-jvm/1-memory-area-details/#_3-1-3-初始化零值" class="sidebar-link heading3">3.1.3 初始化零值</a></li><li class="sidebar-sub-header"><a href="/1-java/2-jvm/1-memory-area-details/#_3-1-4-设置对象头" class="sidebar-link heading3">3.1.4 设置对象头</a></li><li class="sidebar-sub-header"><a href="/1-java/2-jvm/1-memory-area-details/#_3-1-5-执行-init-方法" class="sidebar-link heading3">3.1.5 执行 init 方法</a></li></ul></li><li class="sidebar-sub-header"><a href="/1-java/2-jvm/1-memory-area-details/#_3-2-对象的内存布局" class="sidebar-link">3.2 对象的内存布局</a></li><li class="sidebar-sub-header"><a href="/1-java/2-jvm/1-memory-area-details/#_3-3-对象的访问定位" class="sidebar-link">3.3 对象的访问定位</a></li><li class="sidebar-sub-header"><a href="/1-java/2-jvm/1-memory-area-details/#_4-1-字符串常量池常见问题" class="sidebar-link">4.1 字符串常量池常见问题</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/1-java/2-jvm/1-memory-area-details/#_4-1-1-和-equals" class="sidebar-link heading3">4.1.1 == 和 equals</a></li><li class="sidebar-sub-header"><a href="/1-java/2-jvm/1-memory-area-details/#_4-1-2-存入常量池" class="sidebar-link heading3">4.1.2 存入常量池</a></li><li class="sidebar-sub-header"><a href="/1-java/2-jvm/1-memory-area-details/#_4-1-3-字符串拼接" class="sidebar-link heading3">4.1.3 字符串拼接</a></li><li class="sidebar-sub-header"><a href="/1-java/2-jvm/1-memory-area-details/#_4-1-4-创建字符串对象的方式" class="sidebar-link heading3">4.1.4 创建字符串对象的方式</a></li><li class="sidebar-sub-header"><a href="/1-java/2-jvm/1-memory-area-details/#_4-1-5-总结" class="sidebar-link heading3">4.1.5 总结</a></li></ul></li><li class="sidebar-sub-header"><a href="/1-java/2-jvm/1-memory-area-details/#_4-2-string-s1-new-string-abc-这句话创建了几个字符串对象" class="sidebar-link">4.2 String s1 = new String(&quot;abc&quot;);这句话创建了几个字符串对象？</a></li><li class="sidebar-sub-header"><a href="/1-java/2-jvm/1-memory-area-details/#_4-3-8-种基本类型的包装类和常量池" class="sidebar-link">4.3 8 种基本类型的包装类和常量池</a></li><li class="sidebar-sub-header"><a href="/1-java/2-jvm/1-memory-area-details/#常量池技术的作用" class="sidebar-link">常量池技术的作用</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/1-java/2-jvm/1-memory-area-details/#_4-3-0-整型包装类对象之间的比较" class="sidebar-link heading3">4.3.0 整型包装类对象之间的比较</a></li><li class="sidebar-sub-header"><a href="/1-java/2-jvm/1-memory-area-details/#_4-3-1-integer-缓存源代码" class="sidebar-link heading3">4.3.1 Integer 缓存源代码</a></li><li class="sidebar-sub-header"><a href="/1-java/2-jvm/1-memory-area-details/#_4-3-2-character-缓存源码" class="sidebar-link heading3">4.3.2 Character 缓存源码</a></li><li class="sidebar-sub-header"><a href="/1-java/2-jvm/1-memory-area-details/#_4-3-3-boolean-缓存源码" class="sidebar-link heading3">4.3.3 Boolean 缓存源码</a></li></ul></li></ul></li><li><a href="/1-java/2-jvm/2-garbage-collection/" class="sidebar-link"><i class="iconfont icon-page"></i>Java 垃圾回收</a></li><li><a href="/1-java/2-jvm/3-know-the-jvm/" class="sidebar-link"><i class="iconfont icon-page"></i>认识 JVM</a></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading clickable"><!----> <span class="title">容器</span> <span class="arrow right"></span></p> <!----></section></li></ul> <!----> <div class="content__sidebar-bottom"></div> <!----></aside> <main class="page"><nav class="breadcrumb"><ol vocab="https://schema.org/" typeof="BreadcrumbList"><li property="itemListElement" typeof="ListItem"><a href="/1-java/" property="item" typeof="WebPage" class="router-link-active"><i class="iconfont icon-info"></i> <span property="name">Java 笔记</span></a> <meta property="position" content="1"></li><li property="itemListElement" typeof="ListItem" class="is-active"><a href="/1-java/2-jvm/1-memory-area-details/" aria-current="page" property="item" typeof="WebPage" class="router-link-exact-active router-link-active"><i class="iconfont icon-page"></i> <span property="name">java 内存区域详解</span></a> <meta property="position" content="2"></li></ol></nav> <!----> <div class="content__page-top"></div> <div vocab="https://schema.org/" typeof="Article" class="page-title"><h1><i class="iconfont icon-page"></i> <span property="headline">java 内存区域详解</span></h1> <div class="page-info"><!----> <span aria-label="Author🖊" data-balloon-pos="down"><svg viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" class="icon author-icon"><path d="M649.6 633.6c86.4-48 147.2-144 147.2-249.6 0-160-128-288-288-288s-288 128-288 288c0 108.8 57.6 201.6 147.2 249.6-121.6 48-214.4 153.6-240 288-3.2 9.6 0 19.2 6.4 25.6 3.2 9.6 12.8 12.8 22.4 12.8h704c9.6 0 19.2-3.2 25.6-12.8 6.4-6.4 9.6-16 6.4-25.6-25.6-134.4-121.6-240-243.2-288z" fill="currentColor"></path></svg> <span property="author">lllllan</span></span><!----><span aria-label="Writing Date📅" data-balloon-pos="down" class="time-info"><svg viewBox="0 0 1030 1024" xmlns="http://www.w3.org/2000/svg" class="icon calendar-icon"><path d="M716.4 110.137c0-18.753-14.72-33.473-33.472-33.473-18.753 0-33.473 14.72-33.473 33.473v33.473h66.993v-33.473zm-334.87 0c0-18.753-14.72-33.473-33.473-33.473s-33.52 14.72-33.52 33.473v33.473h66.993v-33.473zm468.81 33.52H716.4v100.465c0 18.753-14.72 33.473-33.472 33.473a33.145 33.145 0 0 1-33.473-33.473V143.657H381.53v100.465c0 18.753-14.72 33.473-33.473 33.473a33.145 33.145 0 0 1-33.473-33.473V143.657H180.6A134.314 134.314 0 0 0 46.66 277.595v535.756A134.314 134.314 0 0 0 180.6 947.289h669.74a134.36 134.36 0 0 0 133.94-133.938V277.595a134.314 134.314 0 0 0-133.94-133.938zm33.473 267.877H147.126a33.145 33.145 0 0 1-33.473-33.473c0-18.752 14.72-33.473 33.473-33.473h736.687c18.752 0 33.472 14.72 33.472 33.473a33.145 33.145 0 0 1-33.472 33.473z" fill="currentColor"></path></svg> <span property="datePublished">2022-1-20</span></span><span role="navigation" aria-label="Category🌈" data-balloon-pos="down" class="category-info enable"><svg viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" class="icon category-icon"><path d="M148.41 106.992h282.176c22.263 0 40.31 18.048 40.31 40.31V429.48c0 22.263-18.047 40.31-40.31 40.31H148.41c-22.263 0-40.311-18.047-40.311-40.31V147.302c0-22.263 18.048-40.31 40.311-40.31zm-.854 446.486H429.73c22.263 0 40.311 18.048 40.311 40.31v282.176c0 22.263-18.048 40.312-40.31 40.312H147.555c-22.263 0-40.311-18.049-40.311-40.312V593.79c0-22.263 18.048-40.311 40.31-40.311zm446.371-446.486h282.176c22.263 0 40.31 18.048 40.31 40.31V429.48c0 22.263-18.047 40.31-40.31 40.31H593.927c-22.263 0-40.311-18.047-40.311-40.31V147.302c0-22.263 18.048-40.31 40.31-40.31zm136.293 813.51H623.926c-40.925 0-74.22-33.388-74.22-74.425V623.992c0-41.038 33.387-74.424 74.425-74.424h222.085c41.038 0 74.424 33.226 74.424 74.067v114.233c0 10.244-8.304 18.548-18.547 18.548s-18.548-8.304-18.548-18.548V623.635c0-20.388-16.746-36.974-37.33-36.974H624.13c-20.585 0-37.331 16.747-37.331 37.33v222.086c0 20.585 16.654 37.331 37.126 37.331H730.22c10.243 0 18.547 8.304 18.547 18.547 0 10.244-8.304 18.547-18.547 18.547z" fill="currentColor"></path></svg> <span property="articleSection">Java</span></span><span aria-label="Tags🏷" data-balloon-pos="down"><svg viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" class="icon tag-icon"><path d="M939.902 458.563 910.17 144.567c-1.507-16.272-14.465-29.13-30.737-30.737L565.438 84.098h-.402c-3.215 0-5.726 1.005-7.634 2.913l-470.39 470.39a10.004 10.004 0 0 0 0 14.164l365.423 365.424c1.909 1.908 4.42 2.913 7.132 2.913s5.223-1.005 7.132-2.913l470.39-470.39c2.01-2.11 3.014-5.023 2.813-8.036zm-240.067-72.121c-35.458 0-64.286-28.828-64.286-64.286s28.828-64.285 64.286-64.285 64.286 28.828 64.286 64.285-28.829 64.286-64.286 64.286z" fill="currentColor"></path></svg> <ul class="tags-wrapper"><li class="tag clickable tag0"><span role="navigation">JVM</span></li></ul> <meta property="keywords" content="JVM"></span><span aria-label="Reading Time⌛" data-balloon-pos="down" class="reading-time-info"><svg viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" class="icon timer-icon"><path d="M799.387 122.15c4.402-2.978 7.38-7.897 7.38-13.463v-1.165c0-8.933-7.38-16.312-16.312-16.312H256.33c-8.933 0-16.311 7.38-16.311 16.312v1.165c0 5.825 2.977 10.874 7.637 13.592 4.143 194.44 97.22 354.963 220.201 392.763-122.204 37.542-214.893 196.511-220.2 389.397-4.661 5.049-7.638 11.651-7.638 19.03v5.825h566.49v-5.825c0-7.379-2.849-13.981-7.509-18.9-5.049-193.016-97.867-351.985-220.2-389.527 123.24-37.67 216.446-198.453 220.588-392.892zM531.16 450.445v352.632c117.674 1.553 211.787 40.778 211.787 88.676H304.097c0-48.286 95.149-87.382 213.728-88.676V450.445c-93.077-3.107-167.901-81.297-167.901-177.093 0-8.803 6.99-15.793 15.793-15.793 8.803 0 15.794 6.99 15.794 15.793 0 80.261 63.69 145.635 142.01 145.635s142.011-65.374 142.011-145.635c0-8.803 6.99-15.793 15.794-15.793s15.793 6.99 15.793 15.793c0 95.019-73.789 172.82-165.96 177.093z" fill="currentColor"></path></svg> <span>About 23 min</span> <meta property="timeRequired" content="PT23M"></span></div> <!----> <hr></div> <div class="anchor-place-holder"><aside id="anchor"><div class="anchor-wrapper"><ul class="anchor-list"><li class="anchor"><a href="/1-java/2-jvm/1-memory-area-details/#_2-1-程序计数器" class="anchor-link heading2"><div>2.1 程序计数器</div></a></li><li class="anchor"><a href="/1-java/2-jvm/1-memory-area-details/#_2-2-java-虚拟机栈" class="anchor-link heading2"><div>2.2 Java 虚拟机栈</div></a></li><li class="anchor"><a href="/1-java/2-jvm/1-memory-area-details/#_2-3-本地方法栈" class="anchor-link heading2"><div>2.3 本地方法栈</div></a></li><li class="anchor"><a href="/1-java/2-jvm/1-memory-area-details/#_2-4-堆" class="anchor-link heading2"><div>2.4 堆</div></a></li><li class="anchor"><a href="/1-java/2-jvm/1-memory-area-details/#_2-5-方法区" class="anchor-link heading2"><div>2.5 方法区</div></a></li><li class="anchor"><a href="/1-java/2-jvm/1-memory-area-details/#_2-5-1-方法区和永久代的关系" class="anchor-link heading3"><div>2.5.1 方法区和永久代的关系</div></a></li><li class="anchor"><a href="/1-java/2-jvm/1-memory-area-details/#_2-5-2-常用参数" class="anchor-link heading3"><div>2.5.2 常用参数</div></a></li><li class="anchor"><a href="/1-java/2-jvm/1-memory-area-details/#_2-5-3-为什么要将永久代-permgen-替换为元空间-metaspace-呢" class="anchor-link heading3"><div>2.5.3 为什么要将永久代 (PermGen) 替换为元空间 (MetaSpace) 呢?</div></a></li><li class="anchor"><a href="/1-java/2-jvm/1-memory-area-details/#_2-6-运行时常量池" class="anchor-link heading2"><div>2.6 运行时常量池</div></a></li><li class="anchor"><a href="/1-java/2-jvm/1-memory-area-details/#_2-7-直接内存" class="anchor-link heading2"><div>2.7 直接内存</div></a></li><li class="anchor"><a href="/1-java/2-jvm/1-memory-area-details/#_3-1-对象的创建" class="anchor-link heading2"><div>3.1 对象的创建</div></a></li><li class="anchor"><a href="/1-java/2-jvm/1-memory-area-details/#_3-1-1-类加载检查" class="anchor-link heading3"><div>3.1.1 类加载检查</div></a></li><li class="anchor"><a href="/1-java/2-jvm/1-memory-area-details/#_3-1-2-分配内存" class="anchor-link heading3"><div>3.1.2 分配内存</div></a></li><li class="anchor"><a href="/1-java/2-jvm/1-memory-area-details/#_3-1-3-初始化零值" class="anchor-link heading3"><div>3.1.3 初始化零值</div></a></li><li class="anchor"><a href="/1-java/2-jvm/1-memory-area-details/#_3-1-4-设置对象头" class="anchor-link heading3"><div>3.1.4 设置对象头</div></a></li><li class="anchor"><a href="/1-java/2-jvm/1-memory-area-details/#_3-1-5-执行-init-方法" class="anchor-link heading3"><div>3.1.5 执行 init 方法</div></a></li><li class="anchor"><a href="/1-java/2-jvm/1-memory-area-details/#_3-2-对象的内存布局" class="anchor-link heading2"><div>3.2 对象的内存布局</div></a></li><li class="anchor"><a href="/1-java/2-jvm/1-memory-area-details/#_3-3-对象的访问定位" class="anchor-link heading2"><div>3.3 对象的访问定位</div></a></li><li class="anchor"><a href="/1-java/2-jvm/1-memory-area-details/#_4-1-字符串常量池常见问题" class="anchor-link heading2"><div>4.1 字符串常量池常见问题</div></a></li><li class="anchor"><a href="/1-java/2-jvm/1-memory-area-details/#_4-1-1-和-equals" class="anchor-link heading3"><div>4.1.1 == 和 equals</div></a></li><li class="anchor"><a href="/1-java/2-jvm/1-memory-area-details/#_4-1-2-存入常量池" class="anchor-link heading3"><div>4.1.2 存入常量池</div></a></li><li class="anchor"><a href="/1-java/2-jvm/1-memory-area-details/#_4-1-3-字符串拼接" class="anchor-link heading3"><div>4.1.3 字符串拼接</div></a></li><li class="anchor"><a href="/1-java/2-jvm/1-memory-area-details/#_4-1-4-创建字符串对象的方式" class="anchor-link heading3"><div>4.1.4 创建字符串对象的方式</div></a></li><li class="anchor"><a href="/1-java/2-jvm/1-memory-area-details/#_4-1-5-总结" class="anchor-link heading3"><div>4.1.5 总结</div></a></li><li class="anchor"><a href="/1-java/2-jvm/1-memory-area-details/#_4-2-string-s1-new-string-abc-这句话创建了几个字符串对象" class="anchor-link heading2"><div>4.2 String s1 = new String(&quot;abc&quot;);这句话创建了几个字符串对象？</div></a></li><li class="anchor"><a href="/1-java/2-jvm/1-memory-area-details/#_4-3-8-种基本类型的包装类和常量池" class="anchor-link heading2"><div>4.3 8 种基本类型的包装类和常量池</div></a></li><li class="anchor"><a href="/1-java/2-jvm/1-memory-area-details/#常量池技术的作用" class="anchor-link heading2"><div>常量池技术的作用</div></a></li><li class="anchor"><a href="/1-java/2-jvm/1-memory-area-details/#_4-3-0-整型包装类对象之间的比较" class="anchor-link heading3"><div>4.3.0 整型包装类对象之间的比较</div></a></li><li class="anchor"><a href="/1-java/2-jvm/1-memory-area-details/#_4-3-1-integer-缓存源代码" class="anchor-link heading3"><div>4.3.1 Integer 缓存源代码</div></a></li><li class="anchor"><a href="/1-java/2-jvm/1-memory-area-details/#_4-3-2-character-缓存源码" class="anchor-link heading3"><div>4.3.2 Character 缓存源码</div></a></li><li class="anchor"><a href="/1-java/2-jvm/1-memory-area-details/#_4-3-3-boolean-缓存源码" class="anchor-link heading3"><div>4.3.3 Boolean 缓存源码</div></a></li></ul></div></aside></div> <!----> <div class="content__content-top"></div> <div class="theme-default-content content__default"><div class="custom-block warning"><p class="custom-block-title">Note</p> <p>本文转载自 <a href="https://javaguide.cn/java/jvm/memory-area/" target="_blank" rel="noopener noreferrer">Java 内存区域详解 | JavaGuide Java 内存区域详解<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p>这部分内容未免有些太过抽象，这次作为 <strong>泛读</strong>，大概看一眼有一个印象，<s>（因为实在是看不懂）</s></p></div> <h1 id="一-概述"><a href="#一-概述" class="header-anchor">#</a> 一 概述</h1> <p>对于 Java 程序员来说，在虚拟机自动内存管理机制下，不再需要像 C/C++程序开发程序员这样为每一个 new 操作去写对应的 delete/free 操作，不容易出现内存泄漏和内存溢出问题。正是因为 Java 程序员把内存控制权利交给 Java 虚拟机，一旦出现内存泄漏和溢出方面的问题，如果不了解虚拟机是怎样使用内存的，那么排查错误将会是一个非常艰巨的任务</p> <h1 id="二-运行时数据区域"><a href="#二-运行时数据区域" class="header-anchor">#</a> 二 运行时数据区域</h1> <p><strong>JDK 1.8 之前：</strong></p> <p><img src="/assets/img/JVM运行时数据区域.150c33e1.150c33e1.png" alt="img"></p> <p><strong>JDK 1.8 ：</strong></p> <p><img src="/assets/img/Java运行时数据区域JDK1.8.37016205.37016205.png" alt="img"></p> <p><strong>线程私有的：</strong></p> <ul><li>程序计数器</li> <li>虚拟机栈</li> <li>本地方法栈</li></ul> <p><strong>线程共享的：</strong></p> <ul><li>堆</li> <li>方法区</li> <li>直接内存 (非运行时数据区的一部分)</li></ul> <h2 id="_2-1-程序计数器"><a href="#_2-1-程序计数器" class="header-anchor">#</a> 2.1 程序计数器</h2> <p>程序计数器是一块较小的内存空间，可以看作是当前线程所执行的字节码的行号指示器。<strong>字节码解释器工作时通过改变这个计数器的值来选取下一条需要执行的字节码指令，分支、循环、跳转、异常处理、线程恢复等功能都需要依赖这个计数器来完成。</strong></p> <p>另外，<strong>为了线程切换后能恢复到正确的执行位置，每条线程都需要有一个独立的程序计数器，各线程之间计数器互不影响，独立存储，我们称这类内存区域为“线程私有”的内存。</strong></p> <p><strong>从上面的介绍中我们知道程序计数器主要有两个作用：</strong></p> <ol><li>字节码解释器通过改变程序计数器来依次读取指令，从而实现代码的流程控制，如：顺序执行、选择、循环、异常处理。</li> <li>在多线程的情况下，程序计数器用于记录当前线程执行的位置，从而当线程被切换回来的时候能够知道该线程上次运行到哪儿了。</li></ol> <p><strong>注意：程序计数器是唯一一个不会出现 <code>OutOfMemoryError</code> 的内存区域，它的生命周期随着线程的创建而创建，随着线程的结束而死亡</strong></p> <h2 id="_2-2-java-虚拟机栈"><a href="#_2-2-java-虚拟机栈" class="header-anchor">#</a> 2.2 Java 虚拟机栈</h2> <p><strong>与程序计数器一样，<u>Java 虚拟机栈也是线程私有的</u>，它的生命周期和线程相同，描述的是 Java 方法执行的内存模型，每次方法调用的数据都是通过栈传递的。</strong></p> <p><strong>Java 内存可以粗糙的区分为堆内存（Heap）和栈内存 (Stack)，其中栈就是现在说的虚拟机栈，或者说是虚拟机栈中局部变量表部分。</strong> （实际上，Java 虚拟机栈是由一个个栈帧组成，而每个栈帧中都拥有：局部变量表、操作数栈、动态链接、方法出口信息。）</p> <p><strong>局部变量表主要存放了编译期可知的各种数据类型</strong>（boolean、byte、char、short、int、float、long、double）、<strong>对象引用</strong>（reference 类型，它不同于对象本身，可能是一个指向对象起始地址的引用指针，也可能是指向一个代表对象的句柄或其他与此对象相关的位置）。</p> <p><strong>Java 虚拟机栈会出现两种错误：<code>StackOverFlowError</code> 和 <code>OutOfMemoryError</code>。</strong></p> <ul><li><strong><code>StackOverFlowError</code>：</strong> 若 Java 虚拟机栈的内存大小不允许动态扩展，那么当线程请求栈的深度超过当前 Java 虚拟机栈的最大深度的时候，就抛出 StackOverFlowError 错误。</li> <li><strong><code>OutOfMemoryError</code>：</strong> Java 虚拟机栈的内存大小可以动态扩展， 如果虚拟机在动态扩展栈时无法申请到足够的内存空间，则抛出<code>OutOfMemoryError</code>异常。</li></ul> <p><img src="/assets/img/《深入理解虚拟机》第三版的第2章-虚拟机栈.5cc9c70c.5cc9c70c.png" alt="img"></p> <p>Java 虚拟机栈也是线程私有的，每个线程都有各自的 Java 虚拟机栈，而且随着线程的创建而创建，随着线程的死亡而死亡。</p> <p><strong>扩展：那么方法/函数如何调用？</strong></p> <p>Java 栈可以类比数据结构中栈，Java 栈中保存的主要内容是栈帧，每一次函数调用都会有一个对应的栈帧被压入 Java 栈，每一个函数调用结束后，都会有一个栈帧被弹出。</p> <p>Java 方法有两种返回方式：</p> <ol><li>return 语句。</li> <li>抛出异常。</li></ol> <p>不管哪种返回方式都会导致栈帧被弹出。</p> <h2 id="_2-3-本地方法栈"><a href="#_2-3-本地方法栈" class="header-anchor">#</a> 2.3 本地方法栈</h2> <p>和虚拟机栈所发挥的作用非常相似，区别是： <strong>虚拟机栈为虚拟机执行 Java 方法 （也就是字节码）服务，而本地方法栈则为虚拟机使用到的 Native 方法服务。</strong> 在 HotSpot 虚拟机中和 Java 虚拟机栈合二为一。</p> <p>本地方法被执行的时候，在本地方法栈也会创建一个栈帧，用于存放该本地方法的局部变量表、操作数栈、动态链接、出口信息。</p> <p>方法执行完毕后相应的栈帧也会出栈并释放内存空间，也会出现 <code>StackOverFlowError</code> 和 <code>OutOfMemoryError</code> 两种错误</p> <h2 id="_2-4-堆"><a href="#_2-4-堆" class="header-anchor">#</a> 2.4 堆</h2> <p>Java 虚拟机所管理的内存中最大的一块，Java 堆是所有线程共享的一块内存区域，在虚拟机启动时创建。<strong>此内存区域的唯一目的就是存放对象实例，几乎所有的对象实例以及数组都在这里分配内存。</strong></p> <p>Java 世界中“几乎”所有的对象都在堆中分配，但是，随着 JIT 编译器的发展与逃逸分析技术逐渐成熟，栈上分配、标量替换优化技术将会导致一些微妙的变化，所有的对象都分配到堆上也渐渐变得不那么“绝对”了。从 JDK 1.7 开始已经默认开启逃逸分析，如果某些方法中的对象引用没有被返回或者未被外面使用（也就是未逃逸出去），那么对象可以直接在栈上分配内存。</p> <p>Java 堆是垃圾收集器管理的主要区域，因此也被称作<strong>GC 堆（Garbage Collected Heap）</strong>。从垃圾回收的角度，由于现在收集器基本都采用分代垃圾收集算法，所以 Java 堆还可以细分为：新生代和老年代；再细致一点有：Eden 空间、From Survivor、To Survivor 空间等。<strong>进一步划分的目的是更好地回收内存，或者更快地分配内存。</strong></p> <p>在 JDK 7 版本及 JDK 7 版本之前，堆内存被通常分为下面三部分：</p> <ol><li>新生代内存(Young Generation)</li> <li>老生代(Old Generation)</li> <li>永生代(Permanent Generation)</li></ol> <p><img src="/assets/img/JVM堆内存结构-JDK7.7d9166eb.7d9166eb.png" alt="JVM堆内存结构-JDK7"></p> <p>JDK 8 版本之后方法区（HotSpot 的永久代）被彻底移除了（JDK1.7 就已经开始了），取而代之是元空间，元空间使用的是直接内存。</p> <p><img src="/assets/img/JVM堆内存结构-jdk8.919b9959.919b9959.png" alt="JVM堆内存结构-JDK8"></p> <p><strong>上图所示的 Eden 区、两个 Survivor 区都属于新生代（为了区分，这两个 Survivor 区域按照顺序被命名为 from 和 to），中间一层属于老年代。</strong></p> <p>大部分情况，对象都会首先在 Eden 区域分配，在一次新生代垃圾回收后，如果对象还存活，则会进入 s0 或者 s1，并且对象的年龄还会加 1(Eden 区-&gt;Survivor 区后对象的初始年龄变为 1)，当它的年龄增加到一定程度（默认为 15 岁），就会被晋升到老年代中。对象晋升到老年代的年龄阈值，可以通过参数 <code>-XX:MaxTenuringThreshold</code> 来设置。</p> <p>堆这里最容易出现的就是 OutOfMemoryError 错误，并且出现这种错误之后的表现形式还会有几种，比如：</p> <ol><li><strong><code>java.lang.OutOfMemoryError: GC Overhead Limit Exceeded</code></strong> ： 当 JVM 花太多时间执行垃圾回收并且只能回收很少的堆空间时，就会发生此错误。</li> <li><strong><code>java.lang.OutOfMemoryError: Java heap space</code></strong> :假如在创建新的对象时, 堆内存中的空间不足以存放新创建的对象, 就会引发此错误。(和配置的最大堆内存有关，且受制于物理内存大小。最大堆内存可通过<code>-Xmx</code>参数配置，若没有特别配置，将会使用默认值，详见：<a href="https://stackoverflow.com/questions/28272923/default-xmxsize-in-java-8-max-heap-size" target="_blank" rel="noopener noreferrer">Default Java 8 max heap size  (opens new window)<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>)</li> <li>......</li></ol> <h2 id="_2-5-方法区"><a href="#_2-5-方法区" class="header-anchor">#</a> 2.5 方法区</h2> <p>方法区与 Java 堆一样，是各个线程共享的内存区域，它用于存储已被虚拟机加载的类信息、常量、静态变量、即时编译器编译后的代码等数据。虽然 <strong>Java 虚拟机规范把方法区描述为堆的一个逻辑部分</strong>，但是它却有一个别名叫做 <strong>Non-Heap（非堆）</strong>，目的应该是与 Java 堆区分开来。</p> <p>方法区也被称为永久代。很多人都会分不清方法区和永久代的关系，为此我也查阅了文献。</p> <h3 id="_2-5-1-方法区和永久代的关系"><a href="#_2-5-1-方法区和永久代的关系" class="header-anchor">#</a> 2.5.1 方法区和永久代的关系</h3> <p>《Java 虚拟机规范》只是规定了有方法区这么个概念和它的作用，并没有规定如何去实现它。那么，在不同的 JVM 上方法区的实现肯定是不同的了。 <strong>方法区和永久代的关系很像 Java 中接口和类的关系，类实现了接口，而永久代就是 HotSpot 虚拟机对虚拟机规范中方法区的一种实现方式。</strong> 也就是说，永久代是 HotSpot 的概念，方法区是 Java 虚拟机规范中的定义，是一种规范，而永久代是一种实现，一个是标准一个是实现，其他的虚拟机实现并没有永久代这一说法。</p> <h3 id="_2-5-2-常用参数"><a href="#_2-5-2-常用参数" class="header-anchor">#</a> 2.5.2 常用参数</h3> <p>JDK 1.8 之前永久代还没被彻底移除的时候通常通过下面这些参数来调节方法区大小</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token operator">-</span>XX<span class="token operator">:</span><span class="token class-name">PermSize</span><span class="token operator">=</span><span class="token class-name">N</span> <span class="token comment">//方法区 (永久代) 初始大小</span>
<span class="token operator">-</span>XX<span class="token operator">:</span><span class="token class-name">MaxPermSize</span><span class="token operator">=</span><span class="token class-name">N</span> <span class="token comment">//方法区 (永久代) 最大大小,超过这个值将会抛出 OutOfMemoryError 异常:java.lang.OutOfMemoryError: PermGen</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>相对而言，垃圾收集行为在这个区域是比较少出现的，但并非数据进入方法区后就“永久存在”了。</p> <p>JDK 1.8 的时候，方法区（HotSpot 的永久代）被彻底移除了（JDK1.7 就已经开始了），取而代之是元空间，元空间使用的是直接内存。</p> <p>下面是一些常用参数：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token operator">-</span>XX<span class="token operator">:</span><span class="token class-name">MetaspaceSize</span><span class="token operator">=</span><span class="token class-name">N</span> <span class="token comment">//设置 Metaspace 的初始（和最小大小）</span>
<span class="token operator">-</span>XX<span class="token operator">:</span><span class="token class-name">MaxMetaspaceSize</span><span class="token operator">=</span><span class="token class-name">N</span> <span class="token comment">//设置 Metaspace 的最大大小</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>与永久代很大的不同就是，如果不指定大小的话，随着更多类的创建，虚拟机会耗尽所有可用的系统内存。</p> <h3 id="_2-5-3-为什么要将永久代-permgen-替换为元空间-metaspace-呢"><a href="#_2-5-3-为什么要将永久代-permgen-替换为元空间-metaspace-呢" class="header-anchor">#</a> 2.5.3 为什么要将永久代 (PermGen) 替换为元空间 (MetaSpace) 呢?</h3> <p><img src="/assets/img/20210425134508117.425a630e.png" alt="img"></p> <ol><li><p>整个永久代有一个 JVM 本身设置的固定大小上限，无法进行调整，而元空间使用的是直接内存，受本机可用内存的限制，虽然元空间仍旧可能溢出，但是比原来出现的几率会更小。</p> <blockquote><p>当元空间溢出时会得到如下错误： <code>java.lang.OutOfMemoryError: MetaSpace</code></p></blockquote> <p>你可以使用 <code>-XX：MaxMetaspaceSize</code> 标志设置最大元空间大小，默认值为 unlimited，这意味着它只受系统内存的限制。<code>-XX：MetaspaceSize</code> 调整标志定义元空间的初始大小如果未指定此标志，则 Metaspace 将根据运行时的应用程序需求动态地重新调整大小。</p></li> <li><p>元空间里面存放的是类的元数据，这样加载多少类的元数据就不由 <code>MaxPermSize</code> 控制了, 而由系统的实际可用空间来控制，这样能加载的类就更多了。</p></li> <li><p>在 JDK8，合并 HotSpot 和 JRockit 的代码时, JRockit 从来没有一个叫永久代的东西, 合并之后就没有必要额外的设置这么一个永久代的地方了。</p></li></ol> <h2 id="_2-6-运行时常量池"><a href="#_2-6-运行时常量池" class="header-anchor">#</a> 2.6 运行时常量池</h2> <p>运行时常量池是方法区的一部分。Class 文件中除了有类的版本、字段、方法、接口等描述信息外，还有常量池表（用于存放编译期生成的各种字面量和符号引用）</p> <p>既然运行时常量池是方法区的一部分，自然受到方法区内存的限制，当常量池无法再申请到内存时会抛出 OutOfMemoryError 错误。</p> <blockquote><ol><li><p><strong>JDK1.7 之前运行时常量池逻辑包含字符串常量池存放在方法区, 此时 hotspot 虚拟机对方法区的实现为永久代</strong></p></li> <li><p><strong>JDK1.7 字符串常量池被从方法区拿到了堆中, 这里没有提到运行时常量池,也就是说字符串常量池被单独拿到堆,运行时常量池剩下的东西还在方法区, 也就是 hotspot 中的永久代</strong> 。</p></li> <li><p><strong>JDK1.8 hotspot 移除了永久代用元空间(Metaspace)取而代之, 这时候字符串常量池还在堆, 运行时常量池还在方法区, 只不过方法区的实现从永久代变成了元空间(Metaspace)</strong></p></li></ol></blockquote> <h2 id="_2-7-直接内存"><a href="#_2-7-直接内存" class="header-anchor">#</a> 2.7 直接内存</h2> <p><strong>直接内存并不是虚拟机运行时数据区的一部分，也不是虚拟机规范中定义的内存区域，但是这部分内存也被频繁地使用。而且也可能导致 OutOfMemoryError 错误出现。</strong></p> <p>JDK1.4 中新加入的 <strong>NIO(New Input/Output) 类</strong>，引入了一种基于**通道（Channel）**与**缓存区（Buffer）*<em>的 I/O 方式，它可以直接使用 Native 函数库直接分配堆外内存，然后通过一个存储在 Java 堆中的 DirectByteBuffer 对象作为这块内存的引用进行操作。这样就能在一些场景中显著提高性能，因为*<em>避免了在 Java 堆和 Native 堆之间来回复制数据</em></em>。</p> <p>本机直接内存的分配不会受到 Java 堆的限制，但是，既然是内存就会受到本机总内存大小以及处理器寻址空间的限制。</p> <h1 id="三-hotspot-虚拟机对象"><a href="#三-hotspot-虚拟机对象" class="header-anchor">#</a> 三 HotSpot 虚拟机对象</h1> <h2 id="_3-1-对象的创建"><a href="#_3-1-对象的创建" class="header-anchor">#</a> 3.1 对象的创建</h2> <p><img src="/assets/img/Java创建对象的过程.dbe33c41.dbe33c41.png" alt="Java创建对象的过程"></p> <h3 id="_3-1-1-类加载检查"><a href="#_3-1-1-类加载检查" class="header-anchor">#</a> 3.1.1 类加载检查</h3> <p>虚拟机遇到一条 new 指令时，首先将去检查这个指令的参数是否能在常量池中定位到这个类的符号引用，并且检查这个符号引用代表的类是否已被加载过、解析和初始化过。如果没有，那必须先执行相应的类加载过程。</p> <h3 id="_3-1-2-分配内存"><a href="#_3-1-2-分配内存" class="header-anchor">#</a> 3.1.2 分配内存</h3> <p>在<strong>类加载检查</strong>通过后，接下来虚拟机将为新生对象<strong>分配内存</strong>。对象所需的内存大小在类加载完成后便可确定，为对象分配空间的任务等同于把一块确定大小的内存从 Java 堆中划分出来。<strong>分配方式</strong>有 <strong>“指针碰撞”</strong> 和 <strong>“空闲列表”</strong> 两种，<strong>选择哪种分配方式由 Java 堆是否规整决定，而 Java 堆是否规整又由所采用的垃圾收集器是否带有压缩整理功能决定</strong>。</p> <p><img src="/assets/img/内存分配的两种方式.9ecae4c9.9ecae4c9.png" alt=""></p> <p>在创建对象的时候有一个很重要的问题，就是线程安全，因为在实际开发过程中，创建对象是很频繁的事情，作为虚拟机来说，必须要保证线程是安全的，通常来讲，虚拟机采用两种方式来保证线程安全：</p> <ul><li><strong>CAS+失败重试：</strong> CAS 是乐观锁的一种实现方式。所谓乐观锁就是，每次不加锁而是假设没有冲突而去完成某项操作，如果因为冲突失败就重试，直到成功为止。<strong>虚拟机采用 CAS 配上失败重试的方式保证更新操作的原子性。</strong></li> <li><strong>TLAB：</strong> 为每一个线程预先在 Eden 区分配一块儿内存，JVM 在给线程中的对象分配内存时，首先在 TLAB 分配，当对象大于 TLAB 中的剩余内存或 TLAB 的内存已用尽时，再采用上述的 CAS 进行内存分配</li></ul> <h3 id="_3-1-3-初始化零值"><a href="#_3-1-3-初始化零值" class="header-anchor">#</a> 3.1.3 初始化零值</h3> <p>内存分配完成后，虚拟机需要将分配到的内存空间都初始化为零值（不包括对象头），这一步操作保证了对象的实例字段在 Java 代码中可以不赋初始值就直接使用，程序能访问到这些字段的数据类型所对应的零值。</p> <h3 id="_3-1-4-设置对象头"><a href="#_3-1-4-设置对象头" class="header-anchor">#</a> 3.1.4 设置对象头</h3> <p>初始化零值完成之后，<strong>虚拟机要对对象进行必要的设置</strong>，例如这个对象是哪个类的实例、如何才能找到类的元数据信息、对象的哈希码、对象的 GC 分代年龄等信息。 <strong>这些信息存放在对象头中。</strong> 另外，根据虚拟机当前运行状态的不同，如是否启用偏向锁等，对象头会有不同的设置方式。</p> <h3 id="_3-1-5-执行-init-方法"><a href="#_3-1-5-执行-init-方法" class="header-anchor">#</a> 3.1.5 执行 init 方法</h3> <p>在上面工作都完成之后，从虚拟机的视角来看，一个新的对象已经产生了，但从 Java 程序的视角来看，对象创建才刚开始，<code>&lt;init&gt;</code> 方法还没有执行，所有的字段都还为零。所以一般来说，执行 new 指令之后会接着执行 <code>&lt;init&gt;</code> 方法，把对象按照程序员的意愿进行初始化，这样一个真正可用的对象才算完全产生出来。</p> <h2 id="_3-2-对象的内存布局"><a href="#_3-2-对象的内存布局" class="header-anchor">#</a> 3.2 对象的内存布局</h2> <blockquote><p>在 Hotspot 虚拟机中，对象在内存中的布局可以分为 3 块区域：<strong>对象头</strong>、<strong>实例数据</strong>和<strong>对齐填充</strong>。</p></blockquote> <p><strong>Hotspot 虚拟机的对象头包括两部分信息</strong>，<strong>第一部分用于存储对象自身的运行时数据</strong>（哈希码、GC 分代年龄、锁状态标志等等），<strong>另一部分是类型指针</strong>，即对象指向它的类元数据的指针，虚拟机通过这个指针来确定这个对象是那个类的实例。</p> <p><strong>实例数据部分是对象真正存储的有效信息</strong>，也是在程序中所定义的各种类型的字段内容。</p> <p><strong>对齐填充部分不是必然存在的，也没有什么特别的含义，仅仅起占位作用。</strong> 因为 Hotspot 虚拟机的自动内存管理系统要求对象起始地址必须是 8 字节的整数倍，换句话说就是对象的大小必须是 8 字节的整数倍。而对象头部分正好是 8 字节的倍数（1 倍或 2 倍），因此，当对象实例数据部分没有对齐时，就需要通过对齐填充来补全。</p> <h2 id="_3-3-对象的访问定位"><a href="#_3-3-对象的访问定位" class="header-anchor">#</a> 3.3 对象的访问定位</h2> <p>建立对象就是为了使用对象，我们的 Java 程序通过栈上的 reference 数据来操作堆上的具体对象。对象的访问方式由虚拟机实现而定，目前主流的访问方式有<strong>① 使用句柄</strong>和<strong>② 直接指针</strong>两种：</p> <blockquote><p>使用句柄来访问的最大好处是 reference 中存储的是稳定的句柄地址，在对象被移动时只会改变句柄中的实例数据指针，而 reference 本身不需要修改。使用直接指针访问方式最大的好处就是速度快，它节省了一次指针定位的时间开销。</p></blockquote> <ol><li><strong>句柄：</strong> 如果使用句柄的话，那么 Java 堆中将会划分出一块内存来作为句柄池，reference 中存储的就是对象的句柄地址，而句柄中包含了对象实例数据与类型数据各自的具体地址信息；</li></ol> <p><img src="/assets/img/对象的访问定位-使用句柄.53859387.53859387.png" alt="对象的访问定位-使用句柄"></p> <ol start="2"><li><strong>直接指针：</strong> 如果使用直接指针访问，那么 Java 堆对象的布局中就必须考虑如何放置访问类型数据的相关信息，而 reference 中存储的直接就是对象的地址</li></ol> <p><img src="/assets/img/对象的访问定位-直接指针.c3bbe790.c3bbe790.png" alt="对象的访问定位-直接指针"></p> <h1 id="四-重点补充内容"><a href="#四-重点补充内容" class="header-anchor">#</a> 四 重点补充内容</h1> <h2 id="_4-1-字符串常量池常见问题"><a href="#_4-1-字符串常量池常见问题" class="header-anchor">#</a> 4.1 字符串常量池常见问题</h2> <h3 id="_4-1-1-和-equals"><a href="#_4-1-1-和-equals" class="header-anchor">#</a> 4.1.1 <code>==</code> 和 <code>equals</code></h3> <blockquote><p><strong>注意</strong> ：比较 String 字符串的值是否相等，可以使用 <code>equals()</code> 方法。 <code>String</code> 中的 <code>equals</code> 方法是被重写过的。 <code>Object</code> 的 <code>equals</code> 方法是比较的对象的内存地址，而 <code>String</code> 的 <code>equals</code> 方法比较的是字符串的值是否相等。如果你使用 <code>==</code> 比较两个字符串是否相等的话，IDEA 还是提示你使用 <code>equals()</code> 方法替换。</p></blockquote> <p><img src="/assets/img/image-20210817123252441.79762346.png" alt="img"></p> <blockquote><p>对于基本数据类型来说，== 比较的是值。对于引用数据类型来说，==比较的是对象的内存地址。</p></blockquote> <h3 id="_4-1-2-存入常量池"><a href="#_4-1-2-存入常量池" class="header-anchor">#</a> 4.1.2 存入常量池</h3> <p><strong>对于编译期可以确定值的字符串，也就是常量字符串 ，jvm 会将其存入字符串常量池。</strong></p> <blockquote><p><strong>字符串常量池</strong> 是 JVM 为了提升性能和减少内存消耗针为字符串（String 类）专门开辟的一块区域，主要目的是为了避免字符串的重复创建。</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token class-name">String</span> aa <span class="token operator">=</span> <span class="token string">&quot;ab&quot;</span><span class="token punctuation">;</span> <span class="token comment">// 放在常量池中</span>
<span class="token class-name">String</span> bb <span class="token operator">=</span> <span class="token string">&quot;ab&quot;</span><span class="token punctuation">;</span> <span class="token comment">// 从常量池中查找</span>
<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>aa<span class="token operator">==</span>bb<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// true</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>JDK1.7 之前运行时常量池逻辑包含字符串常量池存放在方法区。JDK1.7 的时候，字符串常量池被从方法区拿到了堆中。</p></blockquote> <p>并且，字符串常量拼接得到的字符串常量在编译阶段就已经被存放字符串常量池，这个得益于编译器的优化。</p> <p>并不是所有的常量都会进行折叠，只有编译器在程序编译期就可以确定值的常量才可以：</p> <ol><li>基本数据类型(byte、boolean、short、char、int、float、long、double)以及字符串常量</li> <li><code>final</code> 修饰的基本数据类型和字符串变量</li> <li>字符串通过 “+”拼接得到的字符串、基本数据类型之间算数运算（加减乘除）、基本数据类型的位运算（&lt;&lt;、&gt;&gt;、&gt;&gt;&gt; ）</li></ol> <h3 id="_4-1-3-字符串拼接"><a href="#_4-1-3-字符串拼接" class="header-anchor">#</a> 4.1.3 字符串拼接</h3> <p>对象引用和“+”的字符串拼接方式，实际上是通过 <code>StringBuilder</code> 调用 <code>append()</code> 方法实现的，拼接完成之后调用 <code>toString()</code> 得到一个 <code>String</code> 对象 。</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token class-name">String</span> str1 <span class="token operator">=</span> <span class="token string">&quot;str&quot;</span><span class="token punctuation">;</span>
<span class="token class-name">String</span> str2 <span class="token operator">=</span> <span class="token string">&quot;ing&quot;</span><span class="token punctuation">;</span>
<span class="token class-name">String</span> str3 <span class="token operator">=</span> <span class="token string">&quot;str&quot;</span> <span class="token operator">+</span> <span class="token string">&quot;ing&quot;</span><span class="token punctuation">;</span><span class="token comment">//常量池中的对象</span>
<span class="token class-name">String</span> str4 <span class="token operator">=</span> str1 <span class="token operator">+</span> str2<span class="token punctuation">;</span> <span class="token comment">//在堆上创建的新的对象</span>
<span class="token class-name">String</span> str5 <span class="token operator">=</span> <span class="token string">&quot;string&quot;</span><span class="token punctuation">;</span><span class="token comment">//常量池中的对象</span>

<span class="token class-name">String</span> str4 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">StringBuilder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span>str1<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span>str2<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p><img src="/assets/img/字符串拼接-常量池.17865368.png" alt="img"></p> <p>我们在平时写代码的时候，尽量避免多个字符串对象拼接，因为这样会重新创建对象。如果需要改变字符串的话，可以使用 <code>StringBuilder</code> 或者 <code>StringBuffer</code>。</p> <p>不过，字符串使用 <code>final</code> 关键字声明之后，可以让编译器当做常量来处理。</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">final</span> <span class="token class-name">String</span> str1 <span class="token operator">=</span> <span class="token string">&quot;str&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">final</span> <span class="token class-name">String</span> str2 <span class="token operator">=</span> <span class="token string">&quot;ing&quot;</span><span class="token punctuation">;</span>
<span class="token comment">// 下面两个表达式其实是等价的</span>
<span class="token class-name">String</span> c <span class="token operator">=</span> <span class="token string">&quot;str&quot;</span> <span class="token operator">+</span> <span class="token string">&quot;ing&quot;</span><span class="token punctuation">;</span><span class="token comment">// 常量池中的对象</span>
<span class="token class-name">String</span> d <span class="token operator">=</span> str1 <span class="token operator">+</span> str2<span class="token punctuation">;</span> <span class="token comment">// 常量池中的对象</span>
<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>c <span class="token operator">==</span> d<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// true</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><h3 id="_4-1-4-创建字符串对象的方式"><a href="#_4-1-4-创建字符串对象的方式" class="header-anchor">#</a> 4.1.4 创建字符串对象的方式</h3> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">// 从字符串常量池中拿对象</span>
<span class="token class-name">String</span> str1 <span class="token operator">=</span> <span class="token string">&quot;abcd&quot;</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">// 直接在堆内存空间创建一个新的对象。</span>
<span class="token class-name">String</span> str2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">(</span><span class="token string">&quot;abcd&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">String</span> str3 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">(</span><span class="token string">&quot;abcd&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p><strong>只要使用 new 的方式创建对象，便需要创建新的对象</strong> 。</p> <p>使用 new 的方式创建对象的方式如下，可以简单概括为 3 步：</p> <ol><li>在堆中创建一个字符串对象</li> <li>检查字符串常量池中是否有和 new 的字符串值相等的字符串常量</li> <li>如果没有的话需要在字符串常量池中也创建一个值相等的字符串常量，如果有的话，就直接返回堆中的字符串实例对象地址。</li></ol> <h3 id="_4-1-5-总结"><a href="#_4-1-5-总结" class="header-anchor">#</a> 4.1.5 总结</h3> <ol><li>对于基本数据类型来说，==比较的是值。对于引用数据类型来说，==比较的是对象的内存地址。</li> <li>在编译过程中，Javac 编译器（下文中统称为编译器）会进行一个叫做 <strong>常量折叠(Constant Folding)</strong> 的代码优化。常量折叠会把常量表达式的值求出来作为常量嵌在最终生成的代码中，这是 Javac 编译器会对源代码做的极少量优化措施之一(代码优化几乎都在即时编译器中进行)。</li> <li>一般来说，我们要尽量避免通过 new 的方式创建字符串。使用双引号声明的 <code>String</code> 对象（ <code>String s1 = &quot;java&quot;</code> ）更利于让编译器有机会优化我们的代码，同时也更易于阅读。</li> <li>被 <code>final</code> 关键字修改之后的 <code>String</code> 会被编译器当做常量来处理，编译器程序编译期就可以确定它的值，其效果就想到于访问常量。</li></ol> <h2 id="_4-2-string-s1-new-string-abc-这句话创建了几个字符串对象"><a href="#_4-2-string-s1-new-string-abc-这句话创建了几个字符串对象" class="header-anchor">#</a> 4.2 String s1 = new String(&quot;abc&quot;);这句话创建了几个字符串对象？</h2> <p><strong>会创建 1 或 2 个字符串：</strong></p> <ul><li>如果字符串常量池中已存在字符串常量“abc”，则只会在堆空间创建一个字符串常量“abc”。</li> <li>如果字符串常量池中没有字符串常量“abc”，<strong>那么它将首先在字符串常量池中创建</strong>，然后在堆空间中创建，因此将创建总共 2 个字符串对象。</li></ul> <h2 id="_4-3-8-种基本类型的包装类和常量池"><a href="#_4-3-8-种基本类型的包装类和常量池" class="header-anchor">#</a> 4.3 8 种基本类型的包装类和常量池</h2> <p>Java 基本类型的包装类的大部分都实现了常量池技术。</p> <p><code>Byte</code>,<code>Short</code>,<code>Integer</code>,<code>Long</code> 这 4 种包装类默认创建了数值 <strong>[-128，127]</strong> 的相应类型的缓存数据，<code>Character</code> 创建了数值在 <strong>[0,127]</strong> 范围的缓存数据，<code>Boolean</code> 直接返回 <code>True</code> Or <code>False</code>。</p> <p>两种浮点数类型的包装类 <code>Float</code>,<code>Double</code> 并没有实现常量池技术。</p> <blockquote><h2 id="常量池技术的作用"><a href="#常量池技术的作用" class="header-anchor">#</a> 常量池技术的作用</h2> <p>常量池是为了避免频繁的创建和销毁对象而影响系统性能，其实现了对象的共享。
例如字符串常量池，在编译阶段就把所有的字符串文字放到一个常量池中。</p> <ol><li>节省内存空间：常量池中所有相同的字符串常量被合并，只占用一个空间。</li> <li>节省运行时间：比较字符串时，==比equals()快。对于两个引用变量，只用==判断引用是否相等，也就可以判断实际值是否相等。</li></ol></blockquote> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token class-name">Integer</span> i1 <span class="token operator">=</span> <span class="token number">33</span><span class="token punctuation">;</span>
<span class="token class-name">Integer</span> i2 <span class="token operator">=</span> <span class="token number">33</span><span class="token punctuation">;</span>
<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>i1 <span class="token operator">==</span> i2<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 输出 true</span>
<span class="token class-name">Integer</span> i11 <span class="token operator">=</span> <span class="token number">333</span><span class="token punctuation">;</span>
<span class="token class-name">Integer</span> i22 <span class="token operator">=</span> <span class="token number">333</span><span class="token punctuation">;</span>
<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>i11 <span class="token operator">==</span> i22<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 输出 false</span>
<span class="token class-name">Double</span> i3 <span class="token operator">=</span> <span class="token number">1.2</span><span class="token punctuation">;</span>
<span class="token class-name">Double</span> i4 <span class="token operator">=</span> <span class="token number">1.2</span><span class="token punctuation">;</span>
<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>i3 <span class="token operator">==</span> i4<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 输出 false</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><h3 id="_4-3-0-整型包装类对象之间的比较"><a href="#_4-3-0-整型包装类对象之间的比较" class="header-anchor">#</a> 4.3.0 整型包装类对象之间的比较</h3> <p><img src="/assets/img/20210313164740893.a951c078.png" alt="img"></p> <h3 id="_4-3-1-integer-缓存源代码"><a href="#_4-3-1-integer-缓存源代码" class="header-anchor">#</a> 4.3.1 <code>Integer</code> 缓存源代码</h3> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">/**
*此方法将始终缓存-128 到 127（包括端点）范围内的值，并可以缓存此范围之外的其他值。
*/</span>
<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">Integer</span> <span class="token function">valueOf</span><span class="token punctuation">(</span><span class="token keyword">int</span> i<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>i <span class="token operator">&gt;=</span> <span class="token class-name">IntegerCache</span><span class="token punctuation">.</span>low <span class="token operator">&amp;&amp;</span> i <span class="token operator">&lt;=</span> <span class="token class-name">IntegerCache</span><span class="token punctuation">.</span>high<span class="token punctuation">)</span>
      <span class="token keyword">return</span> <span class="token class-name">IntegerCache</span><span class="token punctuation">.</span>cache<span class="token punctuation">[</span>i <span class="token operator">+</span> <span class="token punctuation">(</span><span class="token operator">-</span><span class="token class-name">IntegerCache</span><span class="token punctuation">.</span>low<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Integer</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">IntegerCache</span> <span class="token punctuation">{</span>
    <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token keyword">int</span> low <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">128</span><span class="token punctuation">;</span>
    <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token keyword">int</span> high<span class="token punctuation">;</span>
    <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">Integer</span> cache<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><h3 id="_4-3-2-character-缓存源码"><a href="#_4-3-2-character-缓存源码" class="header-anchor">#</a> 4.3.2 <code>Character</code> 缓存源码</h3> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">Character</span> <span class="token function">valueOf</span><span class="token punctuation">(</span><span class="token keyword">char</span> c<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>c <span class="token operator">&lt;=</span> <span class="token number">127</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// must cache</span>
      <span class="token keyword">return</span> <span class="token class-name">CharacterCache</span><span class="token punctuation">.</span>cache<span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span>c<span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Character</span><span class="token punctuation">(</span>c<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">CharacterCache</span> <span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token class-name">CharacterCache</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token punctuation">}</span>

    <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">Character</span> cache<span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Character</span><span class="token punctuation">[</span><span class="token number">127</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token keyword">static</span> <span class="token punctuation">{</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> cache<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span>
            cache<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Character</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">char</span><span class="token punctuation">)</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><h3 id="_4-3-3-boolean-缓存源码"><a href="#_4-3-3-boolean-缓存源码" class="header-anchor">#</a> 4.3.3 <code>Boolean</code> 缓存源码</h3> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">Boolean</span> <span class="token function">valueOf</span><span class="token punctuation">(</span><span class="token keyword">boolean</span> b<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span>b <span class="token operator">?</span> TRUE <span class="token operator">:</span> FALSE<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div></div> <!----> <div class="content__content-bottom"></div> <footer class="page-meta"><div class="edit-link"><svg viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" class="icon edit-icon"><path d="M117.953 696.992 64.306 959.696l265.931-49.336 450.204-452.505-212.284-213.376-450.204 452.513zm496.384-296.326L219.039 797.993l-46.108-46.34L568.233 354.33l46.104 46.335zm345.357-122.99-114.45 115.04-212.288-213.377 114.45-115.035 212.288 213.371zm0 0" fill="currentColor"></path></svg> <a href="https://github.com/lllllan-fv/blog/edit/main/1-java/2-jvm/1-memory-area-details/README.md" target="_blank" rel="noopener noreferrer">Edit this page</a></div> <div class="meta-item update-time"><span class="label">Last update:</span> <span class="info">2022年1月24日 18:20</span></div> <div class="meta-item contributors"><span class="label">Contributors: </span> <span class="info"><span title="email: 342310798@qq.com" class="contributor">
          lllllan
        </span> <!----></span></div></footer> <div class="page-nav"><p class="inner"><span class="prev"><a href="/1-java/1-basic/3-important-points/3-agent/" class="prev"><svg viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" class="icon prev-icon"><path d="M906.783 588.79c-.02 8.499-6.882 15.36-15.38 15.37l-443.7-.01 75.704 191.682c2.52 6.42.482 13.763-5.038 17.91-5.52 4.168-13.138 4.147-18.616-.092L123.228 524.175a15.362 15.362 0 0 1-6-12.165c0-4.782 2.222-9.277 6-12.185L499.753 210.35a15.388 15.388 0 0 1 9.38-3.195c3.236 0 6.502 1.034 9.236 3.103 5.52 4.147 7.578 11.49 5.038 17.91L447.683 419.84l443.72-.01c8.498.01 15.36 6.881 15.36 15.36l.02 153.6z" fill="currentColor"></path></svg>
        代理详解
      </a></span> <span class="next"><a href="/1-java/2-jvm/2-garbage-collection/">
        Java 垃圾回收
        <svg viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" class="icon next-icon"><path d="M906.772 512c0 4.772-2.211 9.267-5.99 12.175L524.257 813.66a15.37 15.37 0 0 1-18.616.092 15.368 15.368 0 0 1-5.038-17.91l75.714-191.672h-443.73c-8.488 0-15.36-6.881-15.36-15.36v-153.6c0-8.489 6.872-15.36 15.36-15.36h443.73l-75.714-191.682a15.358 15.358 0 0 1 5.048-17.91c5.51-4.158 13.128-4.137 18.606.092l376.525 289.485a15.323 15.323 0 0 1 5.99 12.165z" fill="currentColor"></path></svg></a></span></p></div> <!----> <!----> <div class="content__page-bottom"></div></main> <footer class="footer-wrapper"><!----> <div class="footer"><a href="https://beian.miit.gov.cn/" target="_blank">粤ICP备2021095794号</a></div> <div class="copyright">Copyright © 2022 lllllan</div></footer></div><div class="global-ui"><!----><!----><div id="pwa-install"><!----> <div id="install-modal-wrapper" style="display:none;"><div class="background"></div> <div class="install-modal"><div class="header"><button aria-label="Close" class="close-button"><svg width="23" height="22" xmlns="http://www.w3.org/2000/svg" class="icon close-icon"><path fill-rule="evenodd" clip-rule="evenodd" d="M1.12.358a1.224 1.224 0 011.729 0l8.92 8.914L20.686.358a1.224 1.224 0 011.73 1.728L13.497 11l8.92 8.913a1.222 1.222 0 11-1.73 1.729l-8.919-8.913-8.92 8.913a1.224 1.224 0 01-1.729-1.729L10.04 11l-8.92-8.914a1.222 1.222 0 010-1.728z" fill="currentColor"></path></svg></button> <div class="logo"><!----> <div class="title"><h1></h1> <p class="desc">This app can be installed on your PC or mobile device.  This will allow this web app to look and behave like any other installed app.  You will find it in your app lists and be able to pin it to your home screen, start menus or task bars.  This installed web app will also be able to safely interact with other apps and your operating system. </p></div></div></div> <div class="content"><div class="highlight"><!----> <!----></div> <div class="description"><h3>Description</h3> <p></p></div></div> <div class="button-wrapper"><button class="install-button">
        Install <span></span></button> <button class="cancel-button">
        Cancel
      </button></div></div></div></div><div tabindex="-1" role="dialog" aria-hidden="true" class="pswp"><div class="pswp__bg"></div> <div class="pswp__scroll-wrap"><div class="pswp__container"><div class="pswp__item"></div> <div class="pswp__item"></div> <div class="pswp__item"></div></div> <div class="pswp__ui pswp__ui--hidden"><div class="pswp__top-bar"><div class="pswp__counter"></div> <button class="pswp__button pswp__button--close"></button> <button class="pswp__button pswp__button--share"></button> <button class="pswp__button pswp__button--fs"></button> <button class="pswp__button pswp__button--zoom"></button> <div class="pswp__preloader"><div class="pswp__preloader__icn"><div class="pswp__preloader__cut"><div class="pswp__preloader__donut"></div></div></div></div></div> <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap"><div class="pswp__share-tooltip"></div></div> <button class="pswp__button pswp__button--arrow--left"></button> <button class="pswp__button pswp__button--arrow--right"></button> <div class="pswp__caption"><div class="pswp__caption__center"></div></div></div></div></div></div></div>
    <script src="/assets/js/app.566bcdb2.js" defer></script><script src="/assets/js/vendors~layout-Layout.b7034363.js" defer></script><script src="/assets/js/vendors~layout-Blog~layout-Layout~layout-NotFound.e3241214.js" defer></script><script src="/assets/js/page-java内存区域详解.4067318d.js" defer></script>
  </body>
</html>
